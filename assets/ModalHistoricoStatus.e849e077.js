import{_ as q,Y as Q,r as H,o as i,d as u,w as t,f as s,M as U,G as D,h as S,i as A,k as b,H as C,Q as E,N as T,I as N,J as V,C as h,P as B,p as _,F as x,x as w,l as M,e as v,S as I,T as k,U as y,t as c,j as L,D as F}from"./index.bc7ebc15.js";const P={components:{Avatar:Q},computed:{dadosEncontrados(){return(this.dados.status||[]).length},observacaoEstruturada(){return n=>{var o;const e=((o=n.observacao)==null?void 0:o.trim())||"",g=e.startsWith("Altera\xE7\xE3o manual realizada por:"),m=e.split(/;\s*|\n+/).map(r=>r.trim()).filter(Boolean);return{isManual:g,titulo:m[0],detalhes:m.slice(1)}}}},data(){return{dados:{status:[],contatos:{}},visivel:!1}},methods:{isAlteracaoManual(n){var e;return(e=n.observacao)==null?void 0:e.trim().startsWith("Altera\xE7\xE3o manual realizada por:")},async exibirHistorico(n){var g,m,o;let e;try{e=setTimeout(()=>{$q.loading.show({message:"Carregando informa\xE7\xF5es...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})},500);const r=await $db.documentoStatus.leHistoricoOnline(n);for(const l of r){const a=[];let d,p,f;!(l.cpfUsuario||((g=l.cpfUsuario)==null?void 0:g.replace(/\D/g,"")))||this.dados.contatos[l.cpfUsuario]||this.dados.contatos[(m=l.cpfUsuario)==null?void 0:m.replace(/\D/g,"")]||(d=l.cpfUsuario,p=await $erp().contato.where({numeroDocumentoNacional:d}).toArray(),Array.prototype.push.apply(a,p),d=(o=l.cpfUsuario)==null?void 0:o.replace(/\D/g,""),d&&d!==l.cpfUsuario&&(p=await $erp().contato.where({numeroDocumentoNacional:d}).toArray(),Array.prototype.push.apply(a,p)),f=a[0],f&&(this.dados.contatos[l.cpfUsuario]={nome:f.nome,imagem:f.imagem}))}this.dados.status=r}catch(r){this.$q.notify({type:"negative",message:r.message})}finally{clearTimeout(e),$q.loading.hide()}},async mostrar(n){const{idDocumento:e}=n;if(await this.exibirHistorico(e),!(this.dados.status||[]).length){this.$q.notify({type:"warning",message:"N\xE3o h\xE1 hist\xF3rico dispon\xEDvel."});return}this.visivel=!0},onHide(){this.dados={status:[],contatos:{}}}}},z={class:"layout-padding",container:""},O={class:"text-body1 text-weight-medium text-black q-mb-xs"},W={class:"q-mr-sm"},j={class:"q-mr-md"};function G(n,e,g,m,o,r){const l=H("avatar");return i(),u(F,{modelValue:o.visivel,"onUpdate:modelValue":e[0]||(e[0]=a=>o.visivel=a),onHide:r.onHide},{default:t(()=>[s(U,{view:"hHh LpR fFf",container:"",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:t(()=>[s(D,null,{default:t(()=>[s(S,null,{default:t(()=>[s(A,null,{default:t(()=>e[1]||(e[1]=[b("Hist\xF3rico do Status")])),_:1}),C(s(E,{dense:"",flat:"",icon:"close",round:""},null,512),[[T]])]),_:1})]),_:1}),s(N,null,{default:t(()=>[s(V,null,{default:t(()=>[h("div",z,[r.dadosEncontrados?(i(),u(B,{key:0,"no-border":"",dense:"",class:"q-my-md"},{default:t(()=>[(i(!0),_(x,null,w(o.dados.status,(a,d)=>(i(),_(x,{key:a.codigoDocumentoStatus},[d?(i(),u(M,{key:0})):v("",!0),s(I,{class:"item-center q-my-sm"},{default:t(()=>[s(k,{avatar:""},{default:t(()=>[s(l,{imagem:(o.dados.contatos[a.cpfUsuario]||{}).imagem,rotulo:(o.dados.contatos[a.cpfUsuario]||{}).nome,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),s(k,null,{default:t(()=>[r.isAlteracaoManual(a)?(i(),u(y,{key:0,class:"q-pb-sm"},{default:t(()=>[h("div",O,c(r.observacaoEstruturada(a).titulo),1),(i(!0),_(x,null,w(r.observacaoEstruturada(a).detalhes,(p,f)=>(i(),_("div",{key:f,class:"text-body2 text-grey-8 q-ml-sm q-mb-xs"}," \u2022 "+c(p),1))),128))]),_:2},1024)):(i(),u(y,{key:1,class:"text-body1 text-weight-regular text-black q-pb-sm"},{default:t(()=>[b(c(a.observacao),1)]),_:2},1024)),o.dados.contatos[a.cpfUsuario]?(i(),u(y,{key:2,caption:"",class:"q-pb-xs"},{default:t(()=>[h("strong",null,c((o.dados.contatos[a.cpfUsuario]||{}).nome),1)]),_:2},1024)):v("",!0),a.statusOriginal?(i(),u(y,{key:3,class:"text-body2 text-weight-light text-black"},{default:t(()=>[h("span",W,c(a.statusOriginal),1),h("span",null,[s(L,{name:"east",color:"primary",class:"q-mr-sm"}),b(c(a.statusFinalizado),1)])]),_:2},1024)):v("",!0),s(y,{class:"text-body2"},{default:t(()=>[h("span",j,c(n.$filters.data(a.dataHoraEmissao)),1),b(c(n.$filters.hora(a.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)],64))),128))]),_:1})):v("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])}var R=q(P,[["render",G]]);export{R as M};
