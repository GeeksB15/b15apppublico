import{_ as K,a5 as va,r as E,o as I,d as D,w as e,f as a,M as Z,G as W,h as j,i as Q,k as v,t as C,m as U,e as w,H as _,Q as S,N as A,I as Y,J as aa,p as $,b0 as ga,b1 as ea,b6 as ba,b7 as ta,W as X,b8 as sa,d6 as na,d7 as L,K as ra,aW as ca,D as oa,bj as pa,at as R,b5 as B,s as da,bg as J,P as x,S as z,T as P,j as M,U as T,A as Ia,F as O,u as H,C as q,l as la,aQ as ma,E as Ca,bs as fa,d$ as Va,e0 as Da,av as Pa,d8 as ya,aP as ua}from"./index.e4a389e3.js";import{L as wa}from"./Lista.3c228450.js";import{S as Ea}from"./SeletorCfop.6e1cf014.js";import{C as Sa}from"./Campo.8ff0af2e.js";import"./xlsx.a5e99c82.js";const Fa={components:{SeletorNcm:va,SeletorCfop:Ea,Campo:Sa},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(o,t,m){var f,l,p,g,c,V,h,u,F,s;this.compra=m,this.documentoItem=$utils.clonarV2(o),this.item=$utils.clonarV2(t),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const n=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),r=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=n.concat(r).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,b)=>Number(d.valor)-Number(b.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,b)=>Number(d.valor)-Number(b.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,b)=>Number(d.valor)-Number(b.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,b)=>Number(d.valor)-Number(b.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(d=>{var b,y,k;return{rotulo:(k=(y=(b=d==null?void 0:d.descricao)!=null?b:" - "+(d==null?void 0:d.classificacao))!=null?y:" - "+(d==null?void 0:d.caminho))!=null?k:"",valor:d.id}}).sort((d,b)=>Number(d.valor)-Number(b.valor));let i;(f=this.documentoItem)!=null&&f.idCfop&&(i=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),i===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(l=i==null?void 0:i.cfop.toString())!=null?l:"",this.documentoItem.codigoCfop=(p=i==null?void 0:i.codigoCfop)!=null?p:null,this.documentoItem.idCfop=(g=i.id)!=null?g:null,this.documentoItem.valorBaseIcms=(V=(c=this.documentoItem.valorBaseIcms)!=null?c:this.documentoItem.total)!=null?V:0,this.documentoItem.valorBaseIpi=(u=(h=this.documentoItem.valorBaseIpi)!=null?h:this.documentoItem.total)!=null?u:0,this.documentoItem.valorBaseIcmsSt=(s=(F=this.documentoItem.valorBaseIcmsSt)!=null?F:this.documentoItem.total)!=null?s:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const o=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=o[0].codigoCfop,this.documentoItem.idCfop=o[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(o){$q.notifyError("Ocorreu um erro ao salvar o produto: ",o.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(o){var V,h,u,F,s,d,b,y,k,N;let t=(V=this.documentoItem.valorBaseIcms)!=null?V:0,m=(h=this.documentoItem.valorBaseIpi)!=null?h:0,n=(u=this.documentoItem.valorBaseIcmsSt)!=null?u:0,r=(F=this.documentoItem.percentualIcms)!=null?F:0,i=(s=this.documentoItem.percentualIpi)!=null?s:0,f=(d=this.documentoItem.percentualIVA)!=null?d:0,l=(b=this.documentoItem.percentualIcmsSt)!=null?b:0,p=(y=this.documentoItem.valorIcms)!=null?y:0,g=(k=this.documentoItem.valorIpi)!=null?k:0,c=(N=this.documentoItem.valorIcmsSt)!=null?N:0;["valorBaseIcms","percentualIcms"].includes(o)&&(p=t*r/100),o==="valorIcms"&&(r=p/t*100),["valorBaseIpi","percentualIpi"].includes(o)&&(g=m*i/100),o==="valorIpi"&&(i=g/m*100),o==="valorBaseIcmsSt"&&(f=0,n>0&&t>0&&n>=t&&(f=(n-t)/t*100),c=n*l/100-p),o==="percentualIVA"&&(n=t*(1+f/100),c=n*l/100-p),o==="percentualIcmsSt"&&(c=n*l/100-p),o==="valorIcmsSt"&&(l=c/n*100),this.documentoItem.valorBaseIcmsSt=parseFloat(n.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(r.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(l.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(i.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(f.toFixed(2)),this.documentoItem.valorIcms=parseFloat(p.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(c.toFixed(2)),this.documentoItem.valorIpi=parseFloat(g.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var m,n;const o=this.documentoItem.cfop,t=await $erp().cfop.where({cfop:Number(o)}).first();t===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(m=t==null?void 0:t.id)!=null?m:null,this.documentoItem.codigoCfop=(n=t==null?void 0:t.CodigoCFOP)!=null?n:null},async consultarHistoricoItem(o){const t={};(o==null?void 0:o.atual)&&Object.keys(o.atual).length>0&&(o=o.atual);const n=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:o.id}})).filter(r=>(r.operacao==="Compra"||r.operacao==="Compra de Mercadoria")&&r.status==="Finalizado"&&r.operacaoFator===1&&r.quantidade>0);for(const r of n){const i=await $db.hibrido.le({table:"documento",id:r.idDocumento}),f=await $db.hibrido.le({table:"contato",id:i.idContato});t[r.idItem]||(t[r.idItem]={fornecedores:[]}),t[r.idItem].fornecedores.push({fornecedor:f.apelido||"",dataCompra:i.dataCompra||"",quantidade:r.quantidade||"",valorCusto:r.valorItem||"",valorTotal:r.valorItem*r.quantidade||""})}Object.keys(t).length>0?(this.historicoItem=t,this.historicoItem[o.id].fornecedores.sort((r,i)=>{const f=new Date(r.dataCompra||"1900-01-01");return new Date(i.dataCompra||"1900-01-01")-f})):this.historicoItem[o.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(o){const t={};(o==null?void 0:o.atual)&&Object.keys(o.atual).length>0&&(o=o.atual);const m=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:o.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const n of m){const r=await $db.hibrido.le({table:"contato",id:n.idEmpresa});t[n.idItem]||(t[n.idItem]={estoques:[]}),t[n.idItem].estoques.push({empresa:r.apelido||"",tipoEstoque:n.tipoEstoque||"",lote:n.lote||"-",quantidade:n.saldo||""})}Object.keys(t).length>0?(this.estoqueItem=t,this.estoqueItem[o.id].estoques.sort((n,r)=>{const i=Number(n.quantidade||0);return Number(r.quantidade||0)-i})):this.estoqueItem[o.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},ka=["src"],Na={key:0},qa={key:0};function _a(o,t,m,n,r,i){const f=E("badge"),l=E("g-col"),p=E("g-row"),g=E("campo"),c=E("SeletorNcm"),V=E("SeletorCfop"),h=E("g-label");return I(),D(oa,{modelValue:r.visivel,"onUpdate:modelValue":t[36]||(t[36]=u=>r.visivel=u),persistent:""},{default:e(()=>[a(Z,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:e(()=>[a(W,{class:"bg-primary"},{default:e(()=>[a(j,{class:"bg-primary text-white"},{default:e(()=>[a(Q,null,{default:e(()=>[v(C(r.documentoItem.descricaoItem),1)]),_:1}),r.item.referencia?(I(),D(f,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:e(()=>[v(C(r.item.referencia)+" ",1),a(U,null,{default:e(()=>[v(" Refer\xEAncia ")]),_:1})]),_:1})):w("",!0),r.item.codigoItem?(I(),D(f,{key:1,cor:"positive",class:"q-mr-sm"},{default:e(()=>[v(" #"+C(r.item.codigoItem.toString().padStart(4,"0"))+" ",1),a(U,null,{default:e(()=>[v(" C\xF3digo Item ")]),_:1})]),_:1})):w("",!0),_(a(S,{onClick:i.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[A]])]),_:1})]),_:1}),a(Y,null,{default:e(()=>[a(aa,null,{default:e(()=>[a(p,{gutter:"md"},{default:e(()=>[a(l,null,{default:e(()=>[a(p,{class:"col-12 text-center"},{default:e(()=>[a(l,null,{default:e(()=>{var u,F,s,d,b,y;return[((u=r.item)==null?void 0:u.imagem)||((s=(F=r.item)==null?void 0:F.atual)==null?void 0:s.imagem)?(I(),$("img",{key:0,src:((d=r.item)==null?void 0:d.imagem)||((y=(b=r.item)==null?void 0:b.atual)==null?void 0:y.imagem),alt:"",style:{"max-width":"33%"}},null,8,ka)):w("",!0)]}),_:1})]),_:1}),a(ga,{modelValue:r.abaSelecionada,"onUpdate:modelValue":t[0]||(t[0]=u=>r.abaSelecionada=u),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:e(()=>[a(ea,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),a(ea,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),a(ea,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),a(ba,{modelValue:r.abaSelecionada,"onUpdate:modelValue":t[35]||(t[35]=u=>r.abaSelecionada=u),animated:"",class:"text-tertiary"},{default:e(()=>[a(ta,{name:"tab1",class:"q-px-sm"},{default:e(()=>[a(p,null,{default:e(()=>[a(l,null,{default:e(()=>[a(g,{modelValue:r.documentoItem.observacao,"onUpdate:modelValue":t[1]||(t[1]=u=>r.documentoItem.observacao=u),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{mg:"lg-t"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(g,{modelValue:r.documentoItem.referenciaFornecedor,"onUpdate:modelValue":t[2]||(t[2]=u=>r.documentoItem.referenciaFornecedor=u),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{mg:"lg-t"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(c,{modelValue:r.documentoItem.ncm,"onUpdate:modelValue":t[3]||(t[3]=u=>r.documentoItem.ncm=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{mg:"lg-t"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(V,{modelValue:r.documentoItem.cfop,"onUpdate:modelValue":t[4]||(t[4]=u=>r.documentoItem.cfop=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{mg:"lg-t"},{default:e(()=>[a(l,null,{default:e(()=>[a(h,{text:"sub1 medium"},{default:e(()=>[v("Estoque")]),_:1})]),_:1})]),_:1}),a(p,{items:"center"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(g,{modelValue:r.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":t[5]||(t[5]=u=>r.documentoItem.idPlanoContaEstoque=u),opcoes:r.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),a(p,{mg:"lg-t"},{default:e(()=>[a(l,null,{default:e(()=>[a(h,{text:"sub1 medium"},{default:e(()=>[v("Impostos")]),_:1})]),_:1})]),_:1}),a(p,null,{default:e(()=>[a(X,{label:"ICMS",modelValue:r.exibirIcms,"onUpdate:modelValue":t[6]||(t[6]=u=>r.exibirIcms=u)},null,8,["modelValue"])]),_:1}),r.exibirIcms?(I(),D(p,{key:0,items:"center"},{default:e(()=>[a(l,{col:"12 sm6"},{default:e(()=>[a(g,{modelValue:r.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":t[7]||(t[7]=u=>r.documentoItem.modalidadeBaseCalculo=u),opcoes:r.impostoIcmsModalidade,"somente-leitura":r.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm6"},{default:e(()=>[a(g,{modelValue:r.documentoItem.codigoCst,"onUpdate:modelValue":t[8]||(t[8]=u=>r.documentoItem.codigoCst=u),opcoes:r.impostoCstIcms,"somente-leitura":r.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorBaseIcms,"onUpdate:modelValue":t[9]||(t[9]=u=>r.documentoItem.valorBaseIcms=u),onBlur:t[10]||(t[10]=u=>i.calcularImpostos("valorBaseIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.percentualIcms,"onUpdate:modelValue":t[11]||(t[11]=u=>r.documentoItem.percentualIcms=u),onBlur:t[12]||(t[12]=u=>i.calcularImpostos("percentualIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorIcms,"onUpdate:modelValue":t[13]||(t[13]=u=>r.documentoItem.valorIcms=u),onBlur:t[14]||(t[14]=u=>i.calcularImpostos("valorIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):w("",!0),a(p,null,{default:e(()=>[a(X,{label:"ICMS ST",modelValue:r.exibirIcmsSt,"onUpdate:modelValue":t[15]||(t[15]=u=>r.exibirIcmsSt=u)},null,8,["modelValue"])]),_:1}),r.exibirIcmsSt?(I(),D(p,{key:1,items:"center"},{default:e(()=>[a(l,{col:"12 sm6"},{default:e(()=>[a(g,{modelValue:r.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":t[16]||(t[16]=u=>r.documentoItem.modalidadeBaseCalculoST=u),opcoes:r.impostoCstIcmsSt,"somente-leitura":r.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm6"},{default:e(()=>[a(g,{modelValue:r.documentoItem.percentualIVA,"onUpdate:modelValue":t[17]||(t[17]=u=>r.documentoItem.percentualIVA=u),onBlur:t[18]||(t[18]=u=>i.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":t[19]||(t[19]=u=>r.documentoItem.valorBaseIcmsSt=u),onBlur:t[20]||(t[20]=u=>i.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.percentualIcmsSt,"onUpdate:modelValue":t[21]||(t[21]=u=>r.documentoItem.percentualIcmsSt=u),onBlur:t[22]||(t[22]=u=>i.calcularImpostos("percentualIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorIcmsSt,"onUpdate:modelValue":t[23]||(t[23]=u=>r.documentoItem.valorIcmsSt=u),onBlur:t[24]||(t[24]=u=>i.calcularImpostos("valorIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):w("",!0),a(p,null,{default:e(()=>[a(X,{label:"IPI",modelValue:r.exibirIpi,"onUpdate:modelValue":t[25]||(t[25]=u=>r.exibirIpi=u)},null,8,["modelValue"])]),_:1}),r.exibirIpi?(I(),D(p,{key:2,items:"center"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(g,{modelValue:r.documentoItem.codigoCstIpi,"onUpdate:modelValue":t[26]||(t[26]=u=>r.documentoItem.codigoCstIpi=u),opcoes:r.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorBaseIpi,"onUpdate:modelValue":t[27]||(t[27]=u=>r.documentoItem.valorBaseIpi=u),onBlur:t[28]||(t[28]=u=>i.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.percentualIpi,"onUpdate:modelValue":t[29]||(t[29]=u=>r.documentoItem.percentualIpi=u),onBlur:t[30]||(t[30]=u=>i.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:e(()=>[a(g,{modelValue:r.documentoItem.valorIpi,"onUpdate:modelValue":t[31]||(t[31]=u=>r.documentoItem.valorIpi=u),onBlur:t[32]||(t[32]=u=>i.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):w("",!0)]),_:1}),a(ta,{name:"tab2",class:"q-px-sm"},{default:e(()=>[r.exibirHistorico?(I(),D(sa,{key:0,rows:r.historicoItem[r.documentoItem.idItem].fornecedores,columns:r.tabelaHistoricoItem.colunas,pagination:r.tabelaHistoricoItem.paginacao,"onUpdate:pagination":t[33]||(t[33]=u=>r.tabelaHistoricoItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:e(u=>[a(na,{props:u},{default:e(()=>[a(L,{key:"fornecedor",props:u},{default:e(()=>[v(C(u.row.fornecedor),1)]),_:2},1032,["props"]),a(L,{key:"dataCompra",props:u},{default:e(()=>[u.row.dataCompra!==""?(I(),$("span",Na,C(o.$filters.data(u.row.dataCompra)),1)):w("",!0)]),_:2},1032,["props"]),a(L,{key:"quantidade",props:u},{default:e(()=>[v(C(u.row.quantidade),1)]),_:2},1032,["props"]),a(L,{key:"valorCusto",props:u},{default:e(()=>[v(C(o.$filters.numero(u.row.valorCusto,2)),1)]),_:2},1032,["props"]),a(L,{key:"valorTotal",props:u},{default:e(()=>[v(C(o.$filters.numero(u.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):w("",!0)]),_:1}),a(ta,{name:"tab3",class:"q-px-sm"},{default:e(()=>[r.exibirEstoque?(I(),D(sa,{key:0,rows:r.estoqueItem[r.documentoItem.idItem].estoques,columns:r.tabelaEstoqueItem.colunas,pagination:r.tabelaEstoqueItem.paginacao,"onUpdate:pagination":t[34]||(t[34]=u=>r.tabelaEstoqueItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:e(u=>[a(na,{props:u},{default:e(()=>[a(L,{key:"empresa",props:u},{default:e(()=>[v(C(u.row.empresa),1)]),_:2},1032,["props"]),a(L,{key:"tipoEstoque",props:u},{default:e(()=>[v(C(u.row.tipoEstoque),1)]),_:2},1032,["props"]),a(L,{key:"lote",props:u},{default:e(()=>[u.row.lote!==""?(I(),$("span",qa,C(u.row.lote),1)):w("",!0)]),_:2},1032,["props"]),a(L,{key:"quantidade",props:u},{default:e(()=>[v(C(u.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):w("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(ra,{class:"bg-light q-pa-sm",bordered:""},{default:e(()=>[a(j,null,{default:e(()=>[a(ca),_(a(S,{onClick:i.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[A]]),a(S,{onClick:i.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Ta=K(Fa,[["render",_a]]);const $a={components:{ModalEditarProdutoCompras:Ta,PromptItemV2:pa},data(){const o={ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const t=this.compra.condicaoPagamento;return/^[\d/]*$/.test(t)}],formaPagamentoRules:[async()=>{const t=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(t)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1};return this.limpaCampos(o),o},emits:["atualizar"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(o){const t=this.produtos[o.idItem],m=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(o,t,m)},removerItem(o){this.compraItens=this.compraItens.filter(t=>t.id!==o.id),this.calcularTotais()},fecharEdicaoProduto(o){const t=this.compraItens.findIndex(m=>m.id===o.id);this.compraItens[t]=$utils.clonar(o),this.calcularTotaisItem(t)},async atualizar(){var m,n;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((r,i)=>new Date(r.dataHoraEmissao||0)-new Date(i.dataHoraEmissao||0)),this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((r,i)=>new Date(r.dataVencimento||0)-new Date(i.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compraDocumentoXmlOriginal=await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:this.compra.id}}),this.compraDocumentoXml=$utils.clonarV2(this.compraDocumentoXmlOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(m=this.compra.calcularTributacao)!=null?m:!0,this.compra.naoGerarFinanceiro=(n=this.compra.naoGerarFinanceiro)!=null?n:!1;const o=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.carregarImagensContatos(o);const t=this.compraItens.map(({idItem:r})=>r).filter(Boolean);if(this.carregarImagensItens(t),this.valorTotalPagamento===0)for(const r of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+r.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0},async carregarContatos(o){const t=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:o}});for(const m of t)this.contatos[m.id]=m},async carregarImagensContatos(o){if(!!o.length){await $utils.dormir(200);try{await this.carregarContatos(o)}catch(t){console.error("Erro ao carregar imagens de contatos - ",t)}}},async carregarItens(o){const t=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem","valorCustoReposicao","marca","referencia","codigoItem"],whereIn:{id:o}});for(const m of t)this.produtos[m.id]=m},async carregarImagensItens(o){if(!!o.length){await $utils.dormir(200);try{await this.carregarItens(o)}catch(t){console.error("Erro ao ler imagens de itens - ",t)}}},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const o=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=R.formatDate(o)}await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.visivel=!1,this.operacao=this.compra.operacao,this.compra={},this.compraCondicoesDePagamento=[],this.compraItens=[],this.compraMovimentacoes=[],this.compraTitulos=[],this.compraDocumentoXml=[],await this.salvar(),await this.fechar(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi excluida com sucesso.":"O Pedido de Compra foi excluido com sucesso.")},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const o=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(o.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let t=o[0];if(o.length>1){const r={ativo:!0,empresas:!0};if(t=await $g.promptContato.show({filtro:r,placeholder:"Selecione a empresa"}),!t){this.ocultarModal();return}}const m=(await $db.hibrido.lista({table:"empresa",where:{idContato:t.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[t.id]||await this.carregarContatos([t.id]),this.limpaCampos(this),this.compra={id:$utils.uuid(),tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",descricaoEmpresa:m.nome,numeroDocumentoEmpresa:m.numeroDocumentoNacional,descricaoContato:"",idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:m.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0,valorOutrasDespesas:0},!await this.abrirModalFornecedor()){this.ocultarModal();return}this.documentoNovo=!0,this.exibeInfNota=!0,this.visivel=!0})},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const o=$utils.arredondar(this.compraCondicoesDePagamento.reduce((t,m)=>t+m.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==o,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(o){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",o),!1}},async finalizar_click(){if(!await this.validaCampos())return;let o=!1;this.compra.naoGerarFinanceiro||(o=await $q.dialogSimNao({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?"})),await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=o?1:void 0,await this.finalizarItens(),o&&await this.gerarFinanceiro(),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),o&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{mensagem:"Finalizando Compra..."})},finalizarItens(){var i,f;let o=1,t=0,m=0,n=!1;const r=this.compra;if(r.subTotalProduto>0&&(r.tipoFrete==="FOB"&&r.freteSeparado===0&&(t=(r.valorFrete||0)+(r.valorSeguro||0)),o=((r.subTotalProduto||0)+(r.valorOutrasDespesas||0)-(r.totalDesconto||0)+(t||0))/(r.subTotalProduto||1)),m=this.compraItens.reduce((l,p)=>l+p.valorIcmsSt,m),m!==r.valorIcmsSt&&(n=!0),r.operacao==="Nota de Entrada")for(const l of this.compraItens)l.dataCompra=$utils.dataAtual(),n&&(l.valorIcmsSt=r.valorIcmsSt*((l==null?void 0:l.total)||0)/(r.subTotalProduto>0?r.subTotalProduto:1)),l.valorFreteRateado=r.valorFrete*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.valorSeguroRateado=r.valorSeguro*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.valorOutrasDespesasRateado=(r.valorOutrasDespesas||0)*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.descontoTotalRateado=(r.totalDesconto||0)*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),(l==null?void 0:l.valorIcmsSt)-(l==null?void 0:l.valorIcms)>0&&((l==null?void 0:l.valorIcmsSt)||0)-((l==null?void 0:l.valorIcms)||0),l.valorRealTotal=((l==null?void 0:l.total)||0)*o+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcms)||0),l.valorRealTotalImpostos=((l==null?void 0:l.total)||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcmsSt)||0),l.valorReal=l.valorRealTotalImpostos/((l==null?void 0:l.quantidade)||1),l.valorCustoReposicao=((i=this.produtos[l.idItem])==null?void 0:i.valorCustoReposicao)||0;if(r.operacao==="Pedido de Compra")for(const l of this.compraItens){n&&(l.valorIcmsSt=$utils.arredondar(r.valorIcmsSt*(l.total||0)/(r.subTotalProduto>0?r.subTotalProduto:1))),l.valorFreteRateado=$utils.arredondar((r.valorFrete||0)*(l.total||0)/(r.subTotalProduto||1),4),l.valorSeguroRateado=$utils.arredondar((r.valorSeguro||0)*(l.total||0)/(r.subTotalProduto||1),4),l.valorOutrasDespesasRateado=$utils.arredondar((r.valorOutrasDespesas||0)*(l.total||0)/(r.subTotalProduto||1),4),l.descontoTotalRateado=$utils.arredondar((r.totalDesconto||0)*(l.total||0)/(r.subTotalProduto||1),4);let p=0;l.valorIcmsSt-l.valorIcms>0&&(p=$utils.arredondar((l.valorIcmsSt||0)-(l.valorIcms||0),2)),l.valorRealTotal=$utils.arredondar((l.total||0)*o+(l.valorIpi||0)+(p>0?p:0),2),l.valorRealTotalImpostos=$utils.arredondar((l.total||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+(l.valorIpi||0)+(l.valorIcmsSt||0),4),l.valorReal=$utils.arredondar(l.valorRealTotalImpostos/(l.quantidade||1),4),l.valorCustoReposicao=$utils.arredondar(((f=this.produtos[l.idItem])==null?void 0:f.valorCustoReposicao)||0,2)}},async transformarEmNotaDeEntrada_click(){this.compra.operacao==="Pedido de Compra"&&await $tryLoading(async()=>{var m;const o=this.compraItens.map(({idItem:n})=>n).filter(Boolean),t=await $db.hibrido.lista({table:"itemFornecedor",whereIn:{idItem:o},whereFilter:{idContato:this.compra.idContato}});for(const n of this.compraItens)if(!t.some(({idItem:r})=>r===n.idItem)){const r={id:$utils.uuid(),idItem:n.idItem,idContato:this.compra.idContato,referencia:"",descricao:n.descricaoItem};await $db.hibrido.grava("itemFornecedor",{atual:r,original:{}})}for(const n of this.compraTitulos)n.formaDePagamento=(m=this.compra.formaDePagamento)!=null?m:"";this.compra.operacao="Nota de Entrada",this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.salvar(),this.$emit("atualizar",{aba2:"Nota de Entrada",aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive("Nota de Entrada gerada com sucesso!")},{mensagem:"Processando..."})},async mostrar({id:o}){this.visivel=!0;const t=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=o,await this.atualizar()}),$utils.logarFim(t,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.produtos=[],this.limpaCampos(this),this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const o={ativo:!0,empresas:!0},t=await $g.promptContato.show({filtro:o,placeholder:"Selecione"});if(!t)return;let m=(await $db.hibrido.lista({table:"empresa",where:{idContato:t.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[t.id]||await this.carregarContatos([t.id]),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=m.InscricaoMunicipalEmpresa},async abrirModalComprador(){const o=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});o.id&&(this.compra.idContatoComprador=o.id),this.contatos[o.id]||await this.carregarContatos([o.id])},async abrirModalFornecedor(){const o={ativo:!0},t=await $g.promptContato.show({filtro:o,placeholder:"Selecione o fornecedor"});if(!t)return t;const m=await $db.contatoTelefone.le({idContato:t.id}),n=await $db.contatoEndereco.le({idContato:t.id}),r=m.find(l=>l.tipoTelefone==="Principal"||l.tipoTelefone==="WhatsApp")||m[0]||null,i=n.find(l=>l.grupo==="Principal")||n[0]||null;let f;return i&&Object.keys(i).length>0&&(f=`${i.logradouro}, ${i.numero} ${i.complemento} - ${i.bairro} - ${i.municipio}/${i.uf}`),t.id&&(this.compra.idContato=t.id,this.compra.descricaoContato=t.nome,this.compra.numeroDocumentoContato=t.numeroDocumentoNacional,this.compra.emailContato=(t==null?void 0:t.email)||null,this.compra.regimeContato=(t==null?void 0:t.regime)||null,this.compra.telefoneContato=(r==null?void 0:r.telefone)||null,this.compra.descricaoContatoEndereco=f||null),this.contatos[t.id]||await this.carregarContatos([t.id]),t},async abrirModalVendedor(){const o=(await $db.contato.leFilhos(this.compra.idContato)).map(m=>m.id),t=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:o}});t.id&&(this.compra.idContatoVendedor=t.id),this.contatos[t.id]||await this.carregarContatos([t.id])},async abrirModalTransportador(){const o=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});o.id&&(this.compra.idContatoTransportadora=o.id),this.contatos[o.id]||await this.carregarContatos([o.id])},async selecionarContato(o){const{placeholder:t,filtro:m}={placeholder:"Selecione o contato",filtro:{ativo:!0},...o},n=await $g.promptContato.show({filtro:m,placeholder:t});if(!n)throw new Error("Contato n\xE3o selecionado");return n},async adicionarItem(){let o={},t=[];for(const m of t)o[m.idItem]={item:await $db.hibrido.le({table:"item",id:m.idItem}),quantidade:m.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(o){var t,m;for(const n in o){let r=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:n}});r=r[0];const i=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((t=i.find(u=>u.id))==null?void 0:t.valor);const f=o[n].item||{},l=((m=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:f.id}}))[0])==null?void 0:m.referencia)||null,p=o[n].quantidade||0,g=(f==null?void 0:f.valorCustoReposicao)||(r==null?void 0:r.valorCustoMedio)||0;let c=this.compraItens.find(u=>u.idItem===n);const V=(await $erp().cfop.where({cfop:5102}).toArray())[0],h=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(c)c.quantidade=$utils.arredondar(p,4),c.quantidadeRealizado=$utils.arredondar(p,4),c.subTotal=$utils.arredondar(g,2),c.total=$utils.arredondar(p*g,2);else{const u={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:f.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:f.id,referencia:f.referencia,referenciaFornecedor:l,ncm:f.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:V==null?void 0:V.id,idPlanoContaEstoque:h==null?void 0:h.id,quantidade:$utils.arredondar(p,4),quantidadeRealizado:$utils.arredondar(p,4),status:"Digita\xE7\xE3o",tipoItem:f.tipo,subTotal:$utils.arredondar(g,2),total:$utils.arredondar(p*g,2),unidade:f.unidade,valorCustoMedio:(r==null?void 0:r.valorCustoMedio)||0,valorItem:g,valorOriginal:g,observacao:""};this.compraItens.push(u),await this.carregarItens([f.id])}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let u in this.compraItens)this.compra.subTotal+=this.compraItens[u].total,this.compra.subTotalProduto+=this.compraItens[u].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},formatXml(o,t="  "){let m="",n="";return o.split(/>\s*</).forEach(r=>{r.match(/^\/\w/)&&(n=n.substring(t.length)),m+=n+"<"+r+`>
`,r.match(/^<?\w[^>]*[^\/]$/)&&(n+=t)}),m.substring(1,m.length-3)},calcularTotaisItem(o,t){const m=$utils.clonar(this.compraItens[o]),n=m.valorOriginal||0,r=m.quantidade||0;let i=m.valorItem||0,f=m.descontoPercentualItem||0,l=m.descontoItem||0,p=m.subTotal||0,g=m.total||0;t==="descontoPercentualItem"&&((f<0||f>100)&&(f=0),l=i*f/100,p=i-l),t==="descontoItem"&&((l<0||l>i)&&(l=0),f=l/i*100,p=i-l),t==="valorItem"&&(i<n&&(i=n),l>i&&(l=0,f=0),f=l/i*100,p=i-l),t==="subTotal"&&((p<0||p>i)&&(p=i),l=i-p,f=l/i*100),g=r*p,m.valorItem=i,m.descontoItem=l,m.descontoPercentualItem=f,m.subTotal=p,m.total=g,this.compraItens[o]=m,this.calcularTotais("totalDesconto")},calcularTotais(o){const t=$utils.clonar(this.compra);let m=0,n=0,r=0,i=t.totalDesconto||0,f=t.totalPercentualDesconto||0,l=t.valorFrete||0,p=t.valorSeguro||0,g=t.valorOutrasDespesas||0,c=0,V=0,h=0,u=0,F=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const s of this.compraItens)m+=s.total,c+=s.valorBaseIcms||0,V+=s.valorIcms||0,h+=s.valorBaseIcmsSt||0,u+=s.valorIcmsSt||0,F+=s.valorIpi||0;o==="totalPercentualDesconto"&&(this.erroDesconto=!1,(f<0||f>100)&&(this.erroDesconto=!0),i=m*f/100),o==="totalDesconto"&&(this.erroDesconto=!1,(i<0||i>m)&&(this.erroDesconto=!0),f=i/m*100),l<0&&(this.erroFrete=!0),l=t.tipoFrete==="FOB"?l:0,p<0&&(this.erroSeguro=!0),p=t.tipoFrete==="FOB"?p:0,g<0&&(this.erroOutrasDespesas=!0),t.calcularTributacao||(c=0,V=0,h=0,u=0),t.totalComImposto||(F=0),n=m-i+l+p+g,r=n+F,t.valorBaseIcms=$utils.arredondar(c,2),t.valorIcms=$utils.arredondar(V),t.valorBaseIcmsSt=$utils.arredondar(h),t.valorIcmsSt=$utils.arredondar(u),t.valorIpi=$utils.arredondar(F),t.totalDesconto=$utils.arredondar(i),t.totalPercentualDesconto=$utils.arredondar(f),t.subTotalProduto=$utils.arredondar(m),t.totalProduto=$utils.arredondar(m)-$utils.arredondar(i),t.subTotal=$utils.arredondar(n),t.totalDocumento=$utils.arredondar(r),this.compra=t},limpaCampos(o){o.compra={},o.compraOriginal={},o.compraItens=[],o.compraItensOriginal=[],o.compraCondicoesDePagamento=[],o.compraCondicoesDePagamentoOriginal=[],o.compraTitulos=[],o.compraTitulosOriginal=[],o.compraMovimentacoes=[],o.compraMovimentacoesOriginal=[],o.compraDocumentoXml=[],o.compraDocumentoXmlOriginal=[]},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto;for(const o of this.compraItens)o.dataHoraFinalizado=this.compra.dataHoraFinalizado,o.status=this.compra.status;this.compra.id?await $db.hibrido.grava("documento",{atual:this.compra,original:this.compraOriginal}):this.compraOriginal.id&&await $db.hibrido.remove("documento",this.compraOriginal),await $db.hibrido.gravaLista("documentoItem",{atual:this.compraItens,original:this.compraItensOriginal}),await $db.hibrido.gravaLista("documentoCondicaoPagamento",{atual:this.compraCondicoesDePagamento,original:this.compraCondicoesDePagamentoOriginal}),await $db.hibrido.gravaLista("financeiroTitulo",{atual:this.compraTitulos,original:this.compraTitulosOriginal}),await $db.hibrido.gravaLista("financeiroMovimentacao",{atual:this.compraMovimentacoes,original:this.compraMovimentacoesOriginal}),await $db.hibrido.gravaLista("documentoXML",{atual:this.compraDocumentoXml,original:this.compraDocumentoXmlOriginal}),this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const o=$utils.logarIni("calculaKardex"),t=this.compraItens.map(({idItem:m})=>m).filter(Boolean);try{t.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:t}})}catch(m){console.error(`Erro ao calcular Kardex
`,m)}$utils.logarFim(o,t.length)},async reabrir_click(){!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${this.compra.naoGerarFinanceiro?"":"<strong>O Financeiro ser\xE1 apagado!</strong>"}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const o=this.compraTitulos.filter(({dataPagamento:t})=>t);$utils.verificarErro(o.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[])},async removerPagamento_click(o){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(t=>t.id!==o.id),this.compraCondicoesDePagamento.sort((t,m)=>{let n=new Date(t.dataVencimento),r=new Date(m.dataVencimento);return n-r}),await this.atualizaValorTotalPagamento({condicao:o,acao:"remover"})}catch(t){console.log(t.message)}},async gerarCondicoesDePagamento_click(){var o;try{let t=this.compra.id,m=this.compra.condicaoPagamento,n=(o=this.compra.notaNumero)!=null?o:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(t,m,n),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(t){console.log(t.message)}},async gerarParcelamento(o,t,m){var V;this.compraCondicoesDePagamento=[];const n=$utils.clonar(this.compra),r=t.split("/").length,i=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),f=(n==null?void 0:n.freteSeparado)||0;let l=$utils.arredondar(n==null?void 0:n.totalDocumento,2);const p=((n==null?void 0:n.valorFrete)||0)+((n==null?void 0:n.valorSeguro)||0);if(f&&(n==null?void 0:n.tipoFrete)==="FOB"&&p>0){let h={id:$utils.uuid(),idDocumento:n==null?void 0:n.id,dataVencimento:i,valor:p,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(h),l-=p}let g=0,c=l/r;for(let h in t.split("/")){let u=!!(n!=null&&n.dataCompra)&&(n==null?void 0:n.dataCompra)!==""?n.dataCompra:!!(n!=null&&n.dataHoraPrevisto)&&(n==null?void 0:n.dataHoraPrevisto)!==""?n.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof u=="string"&&(u=(V=new Date(u))!=null?V:$utils.dataAtual()),u.setDate(u.getDate()+parseInt(t.split("/")[h])||0);let F={id:$utils.uuid(),idDocumento:n==null?void 0:n.id,dataVencimento:R.formatDate(u),valor:c,observacao:""};this.compraCondicoesDePagamento.push(F),g+=c||0}l!==g&&(this.compraCondicoesDePagamento[0].valor+=(l||0)-(g||0)),this.valorTotalPagamento=f&&(n==null?void 0:n.tipoFrete)==="FOB"?l+p:l},async gerarFinanceiro(){var f,l;const o=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),t=[];for(const p of this.compraItens){if(p.idPlanoContaEstoque===o.id)continue;const g=(p.total||0)-(p.descontoTotalRateado||0),c=t.findIndex(({idPlanoContaEstoque:V})=>V===p.idPlanoContaEstoque);c!==-1?t[c].valor+=g:t.push({idPlanoContaEstoque:p.idPlanoContaEstoque,idPlanoContaDestino:"",valor:g,porcentagem:0})}for(const p of t)p.valor=$utils.arredondar(p.valor),p.porcentagem=$utils.arredondar(p.valor/this.compra.totalDocumento,4);const m=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),n=this.compraTitulos.filter(({dataPagamento:p})=>p);$utils.verificarErro(n.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const r=R.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const p in this.compraCondicoesDePagamento){const g=this.compraCondicoesDePagamento[p],c=[g.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),V={id:$utils.uuid(),dataEmissao:r,dataCompetencia:r,dataVencimento:R.formatDate(new Date(g.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:R.formatDate(new Date(g.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(g.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(p)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:c,formaDePagamento:this.compra.operacao!=="Pedido de Compra"?`Provis\xE3o Pedido - ${(f=this.compra.formaDePagamento)!=null?f:""}`:(l=this.compra.formaDePagamento)!=null?l:"",receberPagar:0,valorOriginal:$utils.arredondar(g.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(g.valor,2),valorARealizar:$utils.arredondar(g.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(g==null?void 0:g.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:g.observacao==="Valor Frete + Seguro"?m.id:o==null?void 0:o.id,documentoId:this.compra.id,idFinanceiroMovimentacaoAgrupamentoAutomatico:$utils.uuid(),cobrancaAtivo:1};this.compraTitulos.push(V)}const i=$utils.uuid();this.compraMovimentacoes=[];for(const p of t){const g={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:o.id,dataEmissao:r,valorCredito:this.compra.totalDocumento*p.porcentagem,valorDebito:0,descricao:o.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:r,dataVencimento:r,dataMovimento:r,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(g);const c=await $db.financeiroPlanoConta.leCache({id:p.idPlanoContaEstoque}),V={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:p.idPlanoContaEstoque,dataEmissao:r,valorCredito:0,valorDebito:this.compra.totalDocumento*p.porcentagem,descricao:c.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:r,dataVencimento:r,dataMovimento:r,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(V)}},async atualizaValorTotalPagamento({condicao:o,acao:t}){!o||t==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-o.valor)},async ajustarPrevisaoEntrega(o){o==="alterar"&&(this.alterarPrevisaoEntrega=!0),o==="salvar"&&(await $tryLoading(async()=>{const t=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;$utils.verificarErro(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega,"\xC9 necess\xE1rio preencher uma data em conjunto com a hora."),R.formatDate(t)!==R.formatDate(this.compra.dataHoraPrevisto)?(this.compra.dataHoraPrevisto=R.formatDate(t)||"",await this.salvar(),await this.atualizar(),$q.notifyPositive("A previs\xE3o foi salva com sucesso")):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")}),this.alterarPrevisaoEntrega=!1)}}},za={class:"row items-center"},Ma={class:"col-auto"},Ua={class:"col-auto"},Ba=q("span",{class:"q-px-xs"},"|",-1);function xa(o,t,m,n,r,i){const f=E("g-label"),l=E("g-col"),p=E("Badge"),g=E("BadgeCopiarUid"),c=E("g-row"),V=E("avatar"),h=E("campo"),u=E("ModalEditarProdutoCompras"),F=E("PromptItemV2");return I(),$(O,null,[a(oa,{modelValue:o.visivel,"onUpdate:modelValue":t[31]||(t[31]=s=>o.visivel=s),persistent:"",maximized:"",onKeyup:fa(i.fechar,["esc"])},{default:e(()=>[a(Z,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:e(()=>[a(W,null,{default:e(()=>[a(j,null,{default:e(()=>[a(S,{onClick:i.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),a(Q,null,{default:e(()=>[v(C(o.compra.operacao),1)]),_:1}),_(a(S,{onClick:i.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[B,o.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),a(Y,{class:"u-container"},{default:e(()=>[a(aa,null,{default:e(()=>[a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[a(l,{col:"12 sm12 md6"},{default:e(()=>[a(c,{items:"center",justify:"end",class:"hideondesktop",style:{border:"1px solid salmon"}},{default:e(()=>[a(l,{col:"xs-shrink",order:"1 sm0"},{default:e(()=>[_(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(o.compra.dataHoraEmissao)}`},{default:e(()=>[v(C(o.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[B,o.compra.dataHoraEmissao]])]),_:1}),a(l,{col:"xs-shrink",order:"1 sm0"},{default:e(()=>[_(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:e(()=>[v(C(o.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[B,o.compra.dataHoraFinalizado]])]),_:1}),a(l,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:e(()=>[a(p,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:e(()=>[v(C(o.compra.status),1)]),_:1},8,["cor","escuro"]),a(g,{id:o.compra.id,numero:o.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"])]),_:1})]),_:1}),a(c,null,{default:e(()=>[a(l,{col:"12 sm6"},{default:e(()=>[a(c,null,{default:e(()=>[a(l,{col:"xs-shrink"},{default:e(()=>{var s,d;return[a(V,{imagem:(s=o.contatos[o.compra.idContato])==null?void 0:s.imagem,rotulo:(d=o.contatos[o.compra.idContato])==null?void 0:d.apelido,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:1}),a(l,{col:"xs"},{default:e(()=>{var s;return[a(h,{modelValue:(s=o.contatos[o.compra.idContato])==null?void 0:s.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){i.abrirModalFornecedor()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1})]),_:1})]),_:1}),a(l,{col:"12 sm6"},{default:e(()=>{var s;return[a(h,{modelValue:(s=o.contatos[o.compra.idContatoVendedor])==null?void 0:s.apelido,"somente-leitura":"",disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),a(l,{col:"12 sm6"},{default:e(()=>{var s;return[a(h,{modelValue:(s=o.contatos[o.compra.idEmpresa])==null?void 0:s.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){i.abrirModalEmpresa()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1}),a(l,{col:"12 sm6"},{default:e(()=>{var s;return[a(h,{modelValue:(s=o.contatos[o.compra.idContatoComprador])==null?void 0:s.apelido,"somente-leitura":"",disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),a(l,{col:"12 sm6"},{default:e(()=>{var s;return[a(h,{modelValue:(s=o.contatos[o.compra.idContatoTransportadora])==null?void 0:s.apelido,"somente-leitura":"",disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),a(l,{col:"12 sm6"},{default:e(()=>[a(c,null,{default:e(()=>[a(l,{col:"7"},{default:e(()=>[a(da,{modelValue:o.dataPrevistaEntrega,"onUpdate:modelValue":t[0]||(t[0]=s=>o.dataPrevistaEntrega=s),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),a(l,{col:"5"},{default:e(()=>[a(da,{modelValue:o.horaPrevistaEntrega,"onUpdate:modelValue":t[1]||(t[1]=s=>o.horaPrevistaEntrega=s),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(l,{col:"12 sm12 md6"},{default:e(()=>[a(c,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(c,{justify:"end",items:"center"},{default:e(()=>[a(p,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o"},{default:e(()=>[v(C(o.compra.status),1)]),_:1},8,["cor","escuro"]),a(g,{id:o.compra.id,numero:o.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),a(S,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:e(()=>[a(J,null,{default:e(()=>[_((I(),D(x,{link:"",separator:""},{default:e(()=>[o.alterarPrevisaoEntrega?(I(),D(z,{key:1,clickable:"",onClick:t[3]||(t[3]=s=>i.ajustarPrevisaoEntrega("salvar"))},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"local_shipping"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Salvar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1})):(I(),D(z,{key:0,disable:o.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:t[2]||(t[2]=s=>i.ajustarPrevisaoEntrega("alterar"))},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"local_shipping"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Alterar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1},8,["disable"]))]),_:1})),[[A]])]),_:1})]),_:1})]),_:1})]),_:1}),a(l,{col:"shrink"},{default:e(()=>[_(a(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(o.compra.dataHoraEmissao)}`},{default:e(()=>[v(C(o.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[B,o.compra.dataHoraEmissao]])]),_:1}),a(l,{col:"shrink"},{default:e(()=>[_(a(f,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:e(()=>[v(C(o.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[B,o.compra.dataHoraFinalizado]])]),_:1})]),_:1}),a(c,null,{default:e(()=>[a(l,null,{default:e(()=>[a(h,{modelValue:o.compra.observacao,"onUpdate:modelValue":t[4]||(t[4]=s=>o.compra.observacao=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[o.exibeInfNota?(I(),D(Ia,{key:0,"default-opened":o.compra.notaNumero>0||o.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:e(()=>[a(P,null,{default:e(()=>[a(f,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:e(()=>[v("Nota de Entrada")]),_:1})]),_:1})]),default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(c,null,{default:e(()=>[a(l,{col:"12 sm6 md3"},{default:e(()=>[a(h,{modelValue:o.compra.notaNumero,"onUpdate:modelValue":t[5]||(t[5]=s=>o.compra.notaNumero=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:e(()=>[a(h,{modelValue:o.compra.notaSerie,"onUpdate:modelValue":t[6]||(t[6]=s=>o.compra.notaSerie=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:e(()=>[a(h,{modelValue:o.compra.naturezaOperacao,"onUpdate:modelValue":t[7]||(t[7]=s=>o.compra.naturezaOperacao=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:e(()=>[a(h,{modelValue:o.compra.dataCompra,"onUpdate:modelValue":t[8]||(t[8]=s=>o.compra.dataCompra=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12"},{default:e(()=>[a(h,{modelValue:o.compra.chaveAcesso,"onUpdate:modelValue":t[9]||(t[9]=s=>o.compra.chaveAcesso=s),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):w("",!0)]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:e(()=>[v("Carrinho "),a(S,{onClick:t[10]||(t[10]=s=>i.adicionarItem()),disable:o.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(I(!0),$(O,null,H(o.compraItens,(s,d)=>(I(),D(l,{col:"12",key:d},{default:e(()=>[a(x,{class:"full-width"},{default:e(()=>[a(z,{class:"q-px-none"},{default:e(()=>{var b;return[a(P,{avatar:"",class:"col-auto"},{default:e(()=>{var y;return[a(V,{imagem:(y=o.produtos[s.idItem])==null?void 0:y.imagem,rotulo:s.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:2},1024),a(P,{class:"q-px-none"},{default:e(()=>[a(T,null,{default:e(()=>[v(C(s.descricaoItem),1)]),_:2},1024),a(T,{caption:""},{default:e(()=>{var y,k;return[v(C((k=(y=o.produtos[s.idItem])==null?void 0:y.marca)!=null?k:""),1)]}),_:2},1024)]),_:2},1024),_(a(P,{avatar:""},{default:e(()=>[a(p,{denso:""},{default:e(()=>{var y,k;return[v(C((k=(y=o.produtos[s.idItem])==null?void 0:y.referencia)!=null?k:""),1)]}),_:2},1024)]),_:2},1536),[[B,(b=o.produtos[s.idItem])==null?void 0:b.referencia]]),a(P,{avatar:""},{default:e(()=>[q("div",za,[q("div",Ma,[a(S,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:y=>i.editarProduto(s),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),q("div",Ua,[a(S,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:y=>i.removerItem(s),disable:o.compra.status!=="Digita\xE7\xE3o"},{default:e(()=>[a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),a(c,null,{default:e(()=>[a(l,{col:"4 md"},{default:e(()=>[a(h,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:s.valorItem,"onUpdate:modelValue":b=>s.valorItem=b,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:b=>i.calcularTotaisItem(d,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),a(l,{col:"4 md"},{default:e(()=>[a(c,{items:"center"},{default:e(()=>[a(l,{col:"shrink"},{default:e(()=>[a(M,{name:"mdi-minus",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:s.descontoPercentualItem,"onUpdate:modelValue":b=>s.descontoPercentualItem=b,outlined:"",suffix:"%","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:b=>i.calcularTotaisItem(d,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"4 md"},{default:e(()=>[a(h,{dense:"",tipo:"decimal",modelValue:s.descontoItem,"onUpdate:modelValue":b=>s.descontoItem=b,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:b=>i.calcularTotaisItem(d,"descontoItem"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),a(l,{col:"6 md"},{default:e(()=>[a(c,{items:"center"},{default:e(()=>[a(l,{col:"shrink",class:"hideonmobile"},{default:e(()=>[a(M,{name:"mdi-equal",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:s.subTotal,"onUpdate:modelValue":b=>s.subTotal=b,onBlur:b=>i.calcularTotaisItem(d,"subTotal"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"6 md"},{default:e(()=>[a(c,{items:"center"},{default:e(()=>[a(l,{col:"shrink"},{default:e(()=>[a(M,{name:"mdi-close",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{dense:"",max:"100",min:"0",outlined:"",modelValue:s.quantidade,"onUpdate:modelValue":b=>s.quantidade=b,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:b=>i.calcularTotaisItem(d),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"12 md"},{default:e(()=>[a(c,{items:"center"},{default:e(()=>[a(l,{col:"shrink",class:"hideonmobile"},{default:e(()=>[a(M,{name:"mdi-equal",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":"",modelValue:s.total,"onUpdate:modelValue":b=>s.total=b,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),a(l,{col:"12"},{default:e(()=>[a(c,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:e(()=>[a(l,{col:"3 sm2 md-shrink",text:"bold"},{default:e(()=>[v(" Calcular ")]),_:1}),a(l,{col:"9 sm10 md"},{default:e(()=>[a(X,{modelValue:o.compra.calcularTributacao,"onUpdate:modelValue":[t[11]||(t[11]=s=>o.compra.calcularTributacao=s),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"6 md-shrink"},{default:e(()=>[v(" Base ICMS ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:e(()=>[a(h,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:o.compra.valorBaseIcms,"onUpdate:modelValue":t[12]||(t[12]=s=>o.compra.valorBaseIcms=s),"somente-leitura":!!o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:e(()=>[v(" Valor ICMS ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:e(()=>[a(h,{dense:"",outlined:"",modelValue:o.compra.valorIcms,"onUpdate:modelValue":t[13]||(t[13]=s=>o.compra.valorIcms=s),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:e(()=>[v(" Base ICMS ST ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:e(()=>[a(h,{dense:"",outlined:"",modelValue:o.compra.valorBaseIcmsSt,"onUpdate:modelValue":t[14]||(t[14]=s=>o.compra.valorBaseIcmsSt=s),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:e(()=>[v(" ICMS ST ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:e(()=>[a(h,{dense:"",outlined:"",modelValue:o.compra.valorIcmsSt,"onUpdate:modelValue":t[15]||(t[15]=s=>o.compra.valorIcmsSt=s),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1}),a(c,{mg:"lg-t",justify:"end"},{default:e(()=>[a(l,{col:"xs12 sm8 md4"},{default:e(()=>[a(c,{items:"center"},{default:e(()=>[a(l,{col:"3",text:"bold"},{default:e(()=>[v(" Subtotal ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:e(()=>[v(C(o.$filters.numero(o.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),a(la,{class:"q-mb-md q-mt-xs"}),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs3"},{default:e(()=>[v(" Desconto ")]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalPercentualDesconto,"onUpdate:modelValue":t[16]||(t[16]=s=>o.compra.totalPercentualDesconto=s),onBlur:t[17]||(t[17]=s=>i.calcularTotais("totalPercentualDesconto")),suffix:"%",error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalDesconto,"onUpdate:modelValue":t[18]||(t[18]=s=>o.compra.totalDesconto=s),onBlur:t[19]||(t[19]=s=>i.calcularTotais("totalDesconto")),error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs3"},{default:e(()=>[v(" Frete ")]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(ma,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[t[20]||(t[20]=s=>o.compra.tipoFrete=s),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),a(ma,{label:"FOB",val:"FOB",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[t[21]||(t[21]=s=>o.compra.tipoFrete=s),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorFrete,"onUpdate:modelValue":t[22]||(t[22]=s=>o.compra.valorFrete=s),onBlur:i.calcularTotais,error:o.erroFrete,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs3"},{default:e(()=>[v(" Seguro ")]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorSeguro,"onUpdate:modelValue":t[23]||(t[23]=s=>o.compra.valorSeguro=s),onBlur:i.calcularTotais,error:o.erroSeguro,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs5"},{default:e(()=>[v(" Outras despesas ")]),_:1}),a(l,{col:"xs"},{default:e(()=>[a(h,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorOutrasDespesas,"onUpdate:modelValue":t[24]||(t[24]=s=>o.compra.valorOutrasDespesas=s),onBlur:i.calcularTotais,error:o.erroOutrasDespesas,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(la,{class:"q-mt-md q-mb-xs"}),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs4",text:"bold"},{default:e(()=>[v(" Total ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:e(()=>[v(C(o.$filters.numero(o.compra.totalProduto,2)),1)]),_:1})]),_:1}),o.compra.totalComImposto?(I(),D(c,{key:0,items:"center"},{default:e(()=>[a(l,{col:"xs4",text:"bold"},{default:e(()=>[v(" Total IPI ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:e(()=>[v(C(o.$filters.numero(o.compra.valorIpi,2)),1)]),_:1})]),_:1})):w("",!0),a(c,{items:"center"},{default:e(()=>[a(l,{col:"xs5",text:"bold"},{default:e(()=>[v(" Total c/ Impostos ")]),_:1}),a(l,{col:"xs-shrink"},{default:e(()=>[a(X,{disable:o.compra.status!=="Digita\xE7\xE3o",modelValue:o.compra.totalComImposto,"onUpdate:modelValue":[t[25]||(t[25]=s=>o.compra.totalComImposto=s),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),a(l,{col:"xs",text:"right bold"},{default:e(()=>[v(C(o.$filters.numero(o.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:e(()=>[v("Faturar")]),_:1})]),_:1}),a(l,{col:"12"},{default:e(()=>[a(h,{modelValue:o.compra.observacaoFaturamento,"onUpdate:modelValue":t[26]||(t[26]=s=>o.compra.observacaoFaturamento=s),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),a(l,{col:"12"},{default:e(()=>[a(Ca,{ref:"formAdicionarPagamento"},{default:e(()=>[a(c,{mg:"md-y",items:"center"},{default:e(()=>[a(l,{col:"12 sm6 md"},{default:e(()=>[a(h,{modelValue:o.compra.formaDePagamento,"onUpdate:modelValue":t[27]||(t[27]=s=>o.compra.formaDePagamento=s),rules:o.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md"},{default:e(()=>[a(h,{modelValue:o.compra.condicaoPagamento,"onUpdate:modelValue":t[28]||(t[28]=s=>o.compra.condicaoPagamento=s),rules:o.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:e(()=>[v(" Frete Separado "),a(X,{modelValue:o.compra.freteSeparado,"onUpdate:modelValue":[t[29]||(t[29]=s=>o.compra.freteSeparado=s),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:e(()=>[v(" N\xE3o gerar financeiro "),a(X,{modelValue:o.compra.naoGerarFinanceiro,"onUpdate:modelValue":[t[30]||(t[30]=s=>o.compra.naoGerarFinanceiro=s),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"12 sm4 md",text:"center"},{default:e(()=>[a(S,{onClick:i.gerarCondicoesDePagamento_click,disable:o.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(l,{col:"12"},{default:e(()=>[_(a(f,{text:"sub1 medium"},{default:e(()=>[v("Condi\xE7\xF5es de pagamento")]),_:1},512),[[B,o.compraCondicoesDePagamento.length>0]]),(I(!0),$(O,null,H(o.compraCondicoesDePagamento,s=>(I(),D(x,{highlight:"",class:"q-pa-none",key:s.id},{default:e(()=>[a(c,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:e(()=>[a(l,{col:"xs6 md-shrink"},{default:e(()=>[a(h,{modelValue:s.dataVencimento,"onUpdate:modelValue":d=>s.dataVencimento=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs6 md2"},{default:e(()=>[a(h,{modelValue:s.valor,"onUpdate:modelValue":d=>s.valor=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs-grow"},{default:e(()=>[a(h,{modelValue:s.observacao,"onUpdate:modelValue":d=>s.observacao=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"||s.observacao==="Valor Frete + Seguro",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs-shrink",text:"right"},{default:e(()=>[a(S,{onClick:d=>i.removerPagamento_click(s),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),o.valorTotalPagamento>0?(I(),D(c,{key:0,mg:"sm-t"},{default:e(()=>[a(l,{col:"xs-shrink",text:"bold"},{default:e(()=>[v(" Valor total: "+C(o.$filters.numero(o.valorTotalPagamento,2)),1)]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),o.$db.usuario.desenvolvedor()?(I(),D(c,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:e(()=>[v("Contabilidade (apenas desenvolvedor)")]),_:1})]),_:1}),a(l,{col:"12"},{default:e(()=>[o.compraTitulos.length?(I(),D(f,{key:0,text:"sub1 medium"},{default:e(()=>[v("Titulos")]),_:1})):w("",!0),a(x,{highlight:"",class:"q-pa-none"},{default:e(()=>[(I(!0),$(O,null,H(o.compraTitulos,s=>(I(),D(c,{key:s.id,items:"center"},{default:e(()=>[a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.dataPagamento||"A pagar","somente-leitura":"",rotulo:"Data pagamento",tipo:s.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.parcela,"somente-leitura":"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.formaDePagamento,"somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:e(()=>[a(h,{modelValue:s.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(l,{col:"12"},{default:e(()=>[o.compraMovimentacoes.length?(I(),D(f,{key:0,text:"sub1 medium"},{default:e(()=>[v("Movimenta\xE7\xF4es")]),_:1})):w("",!0),a(x,{highlight:"",class:"q-pa-none"},{default:e(()=>[(I(!0),$(O,null,H(o.compraMovimentacoes,s=>(I(),D(c,{key:s.id,gutter:"sm",mg:"sm-y",items:"center"},{default:e(()=>[a(l,{col:"xs-grow"},{default:e(()=>[a(h,{modelValue:s.descricao,"somente-leitura":"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),s.valorCredito?(I(),D(l,{key:0,col:"xs6 md2"},{default:e(()=>[a(h,{modelValue:s.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):w("",!0),s.valorDebito?(I(),D(l,{key:1,col:"xs6 md2"},{default:e(()=>[a(h,{modelValue:s.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):w("",!0),a(l,{col:"xs6 md-shrink"},{default:e(()=>[a(h,{modelValue:s.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),a(l,{col:"xs-grow"},{default:e(()=>[a(h,{modelValue:s.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):w("",!0),o.$db.usuario.desenvolvedor()&&o.compraDocumentoXml.length?(I(),D(c,{key:1,gutter:"md",mg:"md",bg:"bg-yellow"},{default:e(()=>[a(l,{col:"12"},{default:e(()=>[a(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:e(()=>[v("XML importado (apenas desenvolvedor)")]),_:1})]),_:1}),a(l,{col:"12"},{default:e(()=>[a(x,{highlight:"",class:"q-pa-none"},{default:e(()=>[(I(!0),$(O,null,H(o.compraDocumentoXml,s=>(I(),D(c,{key:s.id},{default:e(()=>[q("pre",null,C(i.formatXml(s.xmlData)),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),a(ra,{class:"bg-light border-top"},{default:e(()=>[a(j,{class:"bg-light text-tertiary q-px-md u-container"},{default:e(()=>[a(Q,{class:"text-subtitle2"},{default:e(()=>[v(" Valor Total: "+C(o.$filters.numero(o.compra.totalDocumento,2))+" ",1),Ba,v(" SKU: "+C(i.skus),1)]),_:1}),a(ca),_(a(S,{onClick:i.excluir_click,type:"submit",class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir"},null,8,["onClick"]),[[B,o.compra.status==="Digita\xE7\xE3o"]]),_(a(S,{onClick:i.finalizar_click,type:"submit",class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar"},null,8,["onClick"]),[[B,o.compra.status==="Digita\xE7\xE3o"]]),_(a(S,{onClick:i.reabrir_click,color:"tertiary",flat:"",label:"Reabrir",type:"submit",class:"q-ml-sm"},null,8,["onClick"]),[[B,o.compra.status==="Finalizado"]]),_(a(S,{unelevated:"",onClick:i.transformarEmNotaDeEntrada_click,class:"q-ml-sm",color:"primary",label:"Transformar em Nota de Entrada",type:"submit"},null,8,["onClick"]),[[B,o.compra.status==="Finalizado"&&o.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(u,{ref:"ModalEditarProdutoCompras",onSalvar:i.fecharEdicaoProduto},null,8,["onSalvar"]),a(F,{modelValue:o.adicionar.modal.value,"onUpdate:modelValue":t[32]||(t[32]=s=>o.adicionar.modal.value=s),filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:i.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Oa=K($a,[["render",xa]]);const Aa={components:{PromptItemV2:pa},data(){return{mostrarItemModal:!1,idxItem:0,compra:{},compraItens:[],visivel:!1}},emits:["atualizar","concluirImportacao"],computed:{produtosNaoVinculados(){return this.compraItens.reduce((o,t)=>o+(t.vinculado?0:1),0)},quantProdutos(){return this.compraItens.reduce((o,t)=>o+1,0)}},methods:{async mostrar(o){for(const t of o.documentosItem)this.recalcularItem_blur(t);this.compra=o,this.compraItens=o.documentosItem,this.visivel=!0},async fechar(){this.visivel=!1},async selecionarItens(o){await $tryLoading(async()=>{var f;const t=(f=Object.values(o)[0])==null?void 0:f.item;$utils.verificarErro(!(t!=null&&t.id),"Produto inv\xE1lido"),this.compraItens[this.idxItem].item=t;const{documentoItem:m,item:n,nfeProd:r}=this.compraItens[this.idxItem];m.idItem=n.id,m.descricaoItem=n.descricao;const i={id:$utils.uuid(),idItem:m.idItem,idContato:this.compra.documento.idContato,referencia:r.cProd,descricao:r.xProd};this.compra.itensFornecedor.push(i),this.compraItens[this.idxItem].vinculado=!0,$q.notifyPositive(`Produto vinculado com sucesso: ${n.descricao}`)},{mensagem:"Vinculando produto..."}),this.mostrarItemModal=!1},async recalcularItem_blur(o){const{item:t,documentoItem:m,itemAnterior:n=$utils.clonarV2(o.item)}=o;o.valoresEdicao||(o.valoresEdicao={percentualIpi:m.percentualIpi||0,percentualIcmsSt:m.percentualIcmsSt||0,percentualDifal:0});const{percentualIpi:r,percentualIcmsSt:i,percentualDifal:f}=o.valoresEdicao,{valorCusto:l=0,percentualMarkup:p=0,valorVenda:g=0}=t,c=l*r/100,V=l*i/100,h=l*f/100;t.valorCustoReposicao=$utils.arredondar(l+c+V+h,2),g!==n.valorVenda?t.percentualMarkup=$utils.arredondar(100*(g-t.valorCustoReposicao)/g,2):t.valorVenda=$utils.arredondar(t.valorCustoReposicao/(1-p/100),2),o.itemAnterior=$utils.clonarV2(t)},async adicionarItem_click(o){o.buttonLoading=!0,await this.$nextTick(),await $tryLoading(async()=>{const t=await $db.hibrido.lista({table:"item",where:{referencia:o.item.referencia}});$utils.verificarErro(t.length,"Referencia j\xE1 utilizada por outro produto"),o.documentoItem.descricaoItem=o.item.descricao,o.item.descricaoConcatenada=o.item.descricao;const m=o.nfeProd,n={id:$utils.uuid(),idItem:o.item.id,idContato:this.compra.documento.idContato,referencia:m.cProd,descricao:m.xProd};this.compra.itens.push(o.item),this.compra.itensFornecedor.push(n),o.vinculado=!0,$q.notifyPositive(`Item criado com sucesso: ${o.item.descricao}`)},{mensagem:"Cadastrando produto..."}),o.buttonLoading=!1},async salvar_click(){this.compraItens.some(({vinculado:o})=>!o)?$q.notifyError("Verifique todos os itens n\xE3o vinculados!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$emit("concluirImportacao",this.compra))},async incluirTodos_click(){for(const o of this.compraItens)o.vinculado||await this.adicionarItem_click(o)}}},La={class:"layout-padding q-pa-none q-pb-md"},Ha=["id"],Ra={class:"col-12"},Xa={class:"col-4 col-md"},ja={class:"col-4 col-md"},Qa={class:"col-4 col-md"},Ga={class:"col-6 col-md"},Ja={class:"col-12 col-md"},Ka={class:"col-6 col-md"},Za={class:"col-12 col-md"},Wa={key:0,class:"col-12"},Ya={class:"col-12 col-md-4"},ao=q("div",{class:"col-12 col-md-auto"},"ou",-1),oo={class:"col-12 col-md-auto q-pl-none"},eo={key:1,class:"col-12 q-pt-md text-right text-bold"},to={class:"text-positive"};function lo(o,t,m,n,r,i){const f=E("ajuda"),l=E("campo"),p=E("row"),g=E("PromptItemV2");return I(),$(O,null,[a(oa,{modelValue:r.visivel,"onUpdate:modelValue":t[0]||(t[0]=c=>r.visivel=c),persistent:"",maximized:"",onKeyup:fa(i.fechar,["esc"])},{default:e(()=>[a(Z,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:e(()=>[a(W,null,{default:e(()=>[a(j,null,{default:e(()=>[a(S,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:i.fechar},null,8,["onClick"]),a(Q,null,{default:e(()=>[v("Importar XML x Cadastro")]),_:1}),a(f)]),_:1})]),_:1}),a(Y,null,{default:e(()=>[a(aa,null,{default:e(()=>[q("div",La,[a(Va,{items:r.compraItens,separator:"",style:{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%"}},{default:e(({item:c,index:V})=>[q("div",{class:"items-carrinho items-center row q-pa-md bg-white rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"},id:V},[a(x,{class:"full-width"},{default:e(()=>[a(z,{class:"q-px-none"},{default:e(()=>[a(P,{class:"q-px-none"},{default:e(()=>[a(T,null,{default:e(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Descri\xE7\xE3o Item",modelValue:c.item.descricao,"onUpdate:modelValue":h=>c.item.descricao=h,"somente-leitura":!!c.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Marca",modelValue:c.item.marca,"onUpdate:modelValue":h=>c.item.marca=h,"somente-leitura":!!c.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Referencia",modelValue:c.item.referencia,"onUpdate:modelValue":h=>c.item.referencia=h,"somente-leitura":!!c.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),q("div",Ra,[a(p,{class:"q-col-gutter-sm"},{default:e(()=>[q("div",Xa,[a(l,{modelValue:c.item.valorCusto,"onUpdate:modelValue":h=>c.item.valorCusto=h,rotulo:"Valor pr\xE9 custo",dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),q("div",ja,[a(l,{modelValue:c.valoresEdicao.percentualIpi,"onUpdate:modelValue":h=>c.valoresEdicao.percentualIpi=h,rotulo:"IPI",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!c.vinculado,outlined:"",onBlur:h=>i.recalcularItem_blur(c)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),q("div",Qa,[a(l,{modelValue:c.valoresEdicao.percentualIcmsSt,"onUpdate:modelValue":h=>c.valoresEdicao.percentualIcmsSt=h,rotulo:"ST",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!c.vinculado,outlined:"",onBlur:h=>i.recalcularItem_blur(c)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),q("div",Ga,[a(l,{modelValue:c.valoresEdicao.percentualDifal,"onUpdate:modelValue":h=>c.valoresEdicao.percentualDifal=h,rotulo:"DIFAL",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!c.vinculado,outlined:"",onBlur:h=>i.recalcularItem_blur(c)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),q("div",Ja,[a(l,{modelValue:c.item.valorCustoReposicao,"onUpdate:modelValue":h=>c.item.valorCustoReposicao=h,rotulo:"Custo de reposi\xE7\xE3o",dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),q("div",Ka,[a(l,{modelValue:c.item.percentualMarkup,"onUpdate:modelValue":h=>c.item.percentualMarkup=h,rotulo:"Margem de Lucro",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!c.vinculado,outlined:"",onBlur:h=>i.recalcularItem_blur(c)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),q("div",Za,[a(l,{modelValue:c.item.valorVenda,"onUpdate:modelValue":h=>c.item.valorVenda=h,rotulo:"Valor de Venda",dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":!!c.vinculado,onBlur:h=>i.recalcularItem_blur(c)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])])]),_:2},1024)]),c.vinculado?(I(),$("div",eo," Produto vinculado ")):(I(),$("div",Wa,[a(p,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:e(()=>[q("div",Ya,[a(S,{class:"q-ml-sm no-shadow",color:"primary",icon:"search",unelevated:"",label:"Vincular",onClick:()=>{r.mostrarItemModal=!r.mostrarItemModal,r.idxItem=V}},null,8,["onClick"])]),ao,q("div",oo,[a(S,{loading:c.buttonLoading,class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",onClick:h=>i.adicionarItem_click(c)},null,8,["loading","onClick"])])]),_:2},1024)]))],8,Ha)]),_:1},8,["items"])])]),_:1})]),_:1}),a(ra,{class:"bg-light"},{default:e(()=>[a(j,null,{default:e(()=>[a(Q,null,{default:e(()=>[q("span",to,"Produtos: "+C(i.quantProdutos)+" - N\xE3o vinculados: "+C(i.produtosNaoVinculados),1)]),_:1}),i.produtosNaoVinculados?(I(),D(S,{key:0,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Incluir Todos",onClick:i.incluirTodos_click,unelevated:""},null,8,["onClick"])):(I(),D(S,{key:1,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Salvar",onClick:i.salvar_click,unelevated:""},null,8,["onClick"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(g,{modelValue:r.mostrarItemModal,"onUpdate:modelValue":t[1]||(t[1]=c=>r.mostrarItemModal=c),habilitarQuantidade:!1,filtro:{ativo:!0,idEmpresa:r.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:i.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var ro=K(Aa,[["render",lo]]);const G={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""}}},io={components:{Lista:wa,ComprasFicha:Oa,ComprasImportacaoXML:ro},data(){return{lista:[],contatos:{},mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},resultado:{},busca:"",filtros:$utils.clonarV2(G.filtros),tabSelecionada:{valor:"Digita\xE7\xE3o"},tabs:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],tabSelecionada2:{valor:"Pedido de Compra"},tabs2:[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"}],paginacao:$utils.clonarV2(G.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},methods:{async atualizar(o){var m;const t=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{let{buscarDadosRecentes:n}=o!=null?o:{},r,i,f,l,p=["dataHoraFinalizado","dataHoraEmissao"],g=["desc","desc"];if(o!=null&&o.aba2&&(this.tabSelecionada2.valor=o.aba2),this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(G.filtros),this.paginacao=$utils.clonarV2(G.paginacao),this.busca="",n=!0),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,n&&(r=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),r!=null&&r._id&&(this.filtros=r.filtros,this.busca=r.termoBusca,this.paginacao.limite=r.limit,this.paginacao.atual=r.page,p=r.sort,g=r.dir)),o!=null&&o.aba&&(this.tabSelecionada.valor=o.aba),i=$utils.eliminarVazios(this.filtros),f=this.paginacao.limite,l=this.paginacao.atual,i.status=this.tabSelecionada.valor,i.operacao=this.tabSelecionada2.valor,i.termoBusca=this.busca,this.tabSelecionada.valor==="Todos"&&delete i.status,i.operacao==="Nota no SEFAZ"){let c=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe",situacao:i.status}});const V=[];c.forEach(u=>{const F={id:u.id,descricaoContato:u.xNomeEmitente,dataHoraEmissao:u.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:u.vNF,qtdeContatos:null,status:u.situacao};V.push(F)});const h=(l-1)*f;this.paginacao.total=V.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/f)||1,this.lista=V.splice(h,f),this.configuraImpressao(this.filtros.idEmpresa)}else{const c=await $db.compra.leListaCompleta({filtros:i,limit:f,page:l,sort:p,dir:g});this.paginacao.total=c.total,this.paginacao.maximo=c.totalPages,this.lista=c.data.compras}for(const{idContato:c}of this.lista)this.contatos[c]||(this.contatos[c]={});this.carregarImagensContatos(this.contatos),r={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(i),termoBusca:this.busca,limit:this.paginacao.limite,page:this.paginacao.atual,sort:p,dir:g},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:r}),this.configuraImpressao(this.filtros.idEmpresa)}),$utils.logarFim(t,((m=this.paginacao)==null?void 0:m.total)||1)},async carregarImagensContatos(o){const t=Object.keys(o);if(!!t.length){await $utils.dormir(200);try{const m=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:t}});for(const n of m)o[n.id].imagem=n.imagem||""}catch(m){console.error("Erro ao carregar imagens de contatos - ",m)}}},adicionarXml(o){this.xmlNotaEntrada.arquivo=o[0]},async concluirImportacao(o){await $tryLoading(async()=>{await $db.compra.grava({atual:o}),$q.notifyPositive("Importa\xE7\xE3o realizada com sucesso!"),this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabSelecionada2.valor="Nota de Entrada",await this.$refs.comprasFicha.mostrar({id:o.documento.id})},{mensagem:"Gravando importacao..."})},async importarXmlNotaDeEntrada(o){var n,r,i,f,l,p;let t,m;try{$utils.verificarErro(!this.xmlNotaEntrada.arquivo,"Adicione um arquivo XML antes de enviar!");const c=await(d=>new Promise((b,y)=>{const k=new FileReader;k.readAsBinaryString(d),k.onload=()=>b(k.result),k.onerror=N=>y(N)}))(this.xmlNotaEntrada.arquivo),V=new DOMParser,h=new XMLSerializer,u=V.parseFromString(c,"text/xml");m=h.serializeToString(u),$utils.verificarErro(u.documentElement.nodeName==="html","Arquivo inv\xE1lido ou corrompido");const F=new Da.Parser;let s;F.parseString(m,(d,b)=>{d&&console.log(d),s=b}),t=(p=(l=(f=(i=(r=(n=s==null?void 0:s.nfeProc)==null?void 0:n.protNFe)==null?void 0:r[0])==null?void 0:i.infProt)==null?void 0:f[0])==null?void 0:l.nProt)==null?void 0:p[0]}catch(g){return $q.notifyError("Ocorreu um erro na importa\xE7\xE3o",g),!1}if(!t&&!await $q.dialogSimNao({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",html:!0})){$q.notifyError("Opera\xE7\xE3o para importa\xE7\xE3o de XML n\xE3o realizada!",erro);return}await $tryLoading(async()=>{const g=(await $db.hibrido.lista({table:"documentoXML",whereFilter:{xmlAux:m}}))[0];$utils.verificarErro(g==null?void 0:g.id,"Esse xml j\xE1 foi importado!");const c=await $db.compra.importaXml({xmlString:m,xmlEstrangeiro:Boolean(this.xmlEstrangeiro)});c.documentosItem.find(({vinculado:V})=>!V)?this.$refs.comprasImportacaoXML.mostrar(c):await this.concluirImportacao(c)},{mensagem:"Importando..."}),delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(o){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&this.$refs.comprasFicha.mostrar({id:o})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},limparFiltrosClick(){this.filtros=$utils.clonarV2(G.filtros),this.atualizar()},async consultarSefazClick(){try{let o,t,m,n,r,i,f,l;if(t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(t.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(o=t[0],t.length>1){const y={ativo:!0,empresas:!0};if(o=await $g.promptContato.show({filtro:y,placeholder:"Selecione a empresa"}),!o){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $erp().empresa.where({idContato:o.id}).toArray())[0],!m){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}m&&(n=await $db.contatoEndereco.leEnderecoPrincipal(o.id),r=await $db.configuracoes.leValorComFiltroEmpresa("compras.sefaz.nsu",m.id),r||(r="0"));const p=m.numeroDocumentoNacional.match(/\d+/g).join("");for(;r.length<15;)r=`0${r}`;const g=`<?xml version="1.0" encoding="utf-8"?><distDFeInt versao="1.01" xmlns="http://www.portalfiscal.inf.br/nfe"><tpAmb>2</tpAmb><cUFAutor>${n.ufCod}</cUFAutor><CNPJ>${p}</CNPJ><distNSU><ultNSU>${r}</ultNSU></distNSU></distDFeInt>`,c={xml:g,cnpj:p,dataHora:new Date},h={id:$utils.uuid(),tipo:"DFe",situacao:"",tpAmb:1,dhEmi:new Date,dataHoraEmissao:new Date,dataHoraCriacao:new Date,cpfCnpjEmitente:p,xNomeEmitente:m.nome,json:JSON.stringify(c)}.json,u=new Headers;u.append("Content-Type","application/json; charset=utf-8"),f=await fetch("https://api.b15.com.br/integradorjs/dfe/consultar",{method:"POST",headers:u,body:JSON.stringify({xml:g})});const F=await f.json();if(!f.ok){let y="Erro desconhecido";/GError:.+/.test(F.error)&&(y=F.error.slice(7)),$q.notifyError(y);return}if(F.cStat!=="100"){$q.notifyError(F.xMotivo);return}const s=f.dfe.retDistDFeInt,d=f.err,b=f.arquivos;if(s!==""&&Number(s==null?void 0:s.ultNSU[0])>Number(r)){const y=await $db.configuracoes.atualizaPorNome("compras.sefaz.nsu",m.id,s.ultNSU[0])}if(b){let y=0;for(let k in b)try{const N=b[k],ia={id:$utils.uuid(),tipo:"DFe",situacao:"N\xE3o Importada",tpAmb:N.nfeProc.NFe[0].infNFe[0].ide[0].tpAmb[0],mod:N.nfeProc.NFe[0].infNFe[0].ide[0].mod[0],serie:N.nfeProc.NFe[0].infNFe[0].ide[0].serie[0],nNF:N.nfeProc.NFe[0].infNFe[0].ide[0].nNF[0],chNFe:N.nfeProc.protNFe[0].infProt[0].chNFe[0],vNF:N.nfeProc.NFe[0].infNFe[0].total[0].ICMSTot[0].vNF[0],dhEmi:N.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraEmissao:N.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraCriacao:null,dataHoraAlteracao:null,cpfCnpjEmitente:N.nfeProc.NFe[0].infNFe[0].emit[0].CNPJ[0],xNomeEmitente:N.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],xFantEmitente:N.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],cpfCnpjDestinatario:N.nfeProc.NFe[0].infNFe[0].dest[0].CNPJ[0],xNomeDestinatario:N.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],xFantDestinatario:N.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],json:JSON.stringify({xml:N.xml}),naturezaOperacao:N.nfeProc.NFe[0].infNFe[0].ide[0].natOp[0]};(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe"}})).some(ha=>ha.chNFe===ia.chNFe)||(await $db.documentoFiscalEletronico.grava({atual:ia,original:{}}),y++)}catch(N){console.log(N.message)}this.$q.notify(`Importa\xE7\xE3o via SEFAZ Finalizada, ${y} Notas Importadas`)}}catch(o){console.log(o.message)}},async configuraImpressao(o){const t=await $db.configuracoes.porNome("impressao.compra",o);this.configImpressao=[...t.length?t.map(m=>({texto:"Imprimir Compra",...m})):[{valor:"invoice",texto:"Compras e Estoque"}]]},setOpcoesTabs(o){o!=="Nota no SEFAZ"&&(this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabs=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]),o==="Nota no SEFAZ"&&(this.tabSelecionada.valor="N\xE3o Importada",this.tabs=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"}])},async downloadXmlDFe(o){const t=await $db.hibrido.le({table:"documentoFiscalEletronico",id:o}),m=JSON.parse(t.json).xml;if(m){const n=document.createElement("a"),r=new Blob([m],{type:"text/plain"});n.setAttribute("href",window.URL.createObjectURL(r)),n.setAttribute("download",`${t.chNFe}.xml`),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}m||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async importarXmlDFe(o){try{const t=await $db.hibrido.le({table:"documentoFiscalEletronico",id:o}),m=JSON.parse(t.json).xml;if(m){const n=new DOMParser,r=new XMLSerializer,i=n.parseFromString(m,"text/xml"),f=r.serializeToString(i),l=this;await $db.compra.importaXml({xmlString:f,tela:l});const p={original:$utils.clonarV2(t),atual:$utils.clonarV2(t)};p.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(p),$q.notify("XML Importado para Compras")}}catch(t){console.log(t.message),$q.notifyError("Erro ao importar XML",t)}}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0})}},so={id:"Compras"},no={class:"mw80 text-center"},mo={class:"row q-ma-md"},uo={key:0,class:"row q-ma-md"},co={class:"certificado-error-messages"};function po(o,t,m,n,r,i){const f=E("campo"),l=E("BadgeCopiarUid"),p=E("avatar"),g=E("badge"),c=E("g-label"),V=E("g-col"),h=E("g-row"),u=E("Lista"),F=E("ComprasFicha"),s=E("ComprasImportacaoXML");return I(),$("div",so,[a(u,{busca:r.busca,"onUpdate:busca":t[8]||(t[8]=d=>r.busca=d),onAtualizar:i.atualizar,onLimparFiltrosClick:i.limparFiltrosClick,onCriarClick:i.criarClick,onConsultarSefazClick:i.consultarSefazClick,lista:r.lista,tabSelecionada:r.tabSelecionada,tabs:r.tabs,tabSelecionada2:r.tabSelecionada2,tabs2:r.tabs2,paginacao:r.paginacao,mostrar:r.mostrar},{botaoNovo:e(()=>[a(S,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:e(()=>[a(J,null,{default:e(()=>[a(x,{link:"","no-border":"",separator:""},{default:e(()=>[_((I(),D(z,{onClick:i.criarClick,clickable:""},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"add"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]]),_((I(),D(z,{onClick:i.importarXmlClick,clickable:""},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"add"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]])]),_:1})]),_:1})]),_:1}),a(S,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:e(()=>[a(J,null,{default:e(()=>[a(x,{link:"","no-border":"",separator:""},{default:e(()=>[_((I(),D(z,{onClick:i.criarClick,clickable:""},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"add"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]]),_((I(),D(z,{onClick:i.importarXmlClick,clickable:""},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"add"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]])]),_:1})]),_:1})]),_:1})]),filtroCampos:e(()=>[a(f,{modelValue:r.filtros.numero,"onUpdate:modelValue":t[0]||(t[0]=d=>r.filtros.numero=d),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.numeroCompra,"onUpdate:modelValue":t[1]||(t[1]=d=>r.filtros.numeroCompra=d),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.fornecedor.nome,"onUpdate:modelValue":t[2]||(t[2]=d=>r.filtros.fornecedor.nome=d),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom q-mb-md"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.periodoEmissao.ini,"onUpdate:modelValue":t[3]||(t[3]=d=>r.filtros.periodoEmissao.ini=d),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-mb-x"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.periodoEmissao.fim,"onUpdate:modelValue":t[4]||(t[4]=d=>r.filtros.periodoEmissao.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.periodoFinalizado.ini,"onUpdate:modelValue":t[5]||(t[5]=d=>r.filtros.periodoFinalizado.ini=d),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-mb-xs"},null,8,["modelValue"]),a(f,{modelValue:r.filtros.periodoFinalizado.fim,"onUpdate:modelValue":t[6]||(t[6]=d=>r.filtros.periodoFinalizado.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),a(f,{modelValue:r.paginacao.limite,"onUpdate:modelValue":t[7]||(t[7]=d=>r.paginacao.limite=d),rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",min:"1",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:e(()=>[a(x,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:e(()=>[(I(!0),$(O,null,H(r.lista,d=>(I(),$("div",{key:d.id,class:"itemHover"},[a(z,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:e(()=>[a(P,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:e(()=>[q("div",no,[a(l,{id:d.id,numero:d.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),a(P,{class:"col-md col-lg col-xl no-margin"},{default:e(()=>[a(z,{class:"q-pa-none"},{default:e(()=>[a(P,{onClick:b=>i.abrir(d.id),class:"col-auto items-center"},{default:e(()=>[a(p,{imagem:(r.contatos[d.idContato]||{}).imagem,rotulo:d.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),a(P,{class:"col"},{default:e(()=>[a(T,{onClick:b=>i.abrir(d.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:e(()=>[v(C(d.descricaoContato)+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),a(z,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:e(()=>[d.notaNumero?(I(),D(g,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:e(()=>[v(C(d.notaNumero)+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),D(g,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:e(()=>[v(" S/N "),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(P,{class:"hideondesktop q-mt-sm"},{default:e(()=>[a(h,{mg:"xs-b"},{default:e(()=>[d.dataHoraEmissao?(I(),D(V,{key:0,col:"shrink"},{default:e(()=>[a(c,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(d.dataHoraEmissao)}`},{default:e(()=>[v(C(o.$filters.data(d.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):w("",!0),d.dataHoraFinalizado?(I(),D(V,{key:1,col:"shrink",class:"q-ml-sm"},{default:e(()=>[a(c,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(d.dataHoraFinalizado)}`},{default:e(()=>[v(C(o.$filters.data(d.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):w("",!0)]),_:2},1024),a(h,{mg:"xs-b"},{default:e(()=>[a(V,{col:"shrink"},{default:e(()=>[a(l,{id:d.id,numero:d.numero,cor:"positive",escuro:""},null,8,["id","numero"])]),_:2},1024),a(V,{col:"shrink",class:"q-ml-sm"},{default:e(()=>[d.notaNumero?(I(),D(g,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:e(()=>[v(C(d.notaNumero)+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),D(g,{key:1,cor:"warning",class:"mw50",escuro:""},{default:e(()=>[v(" S/N "),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(V,{col:"shrink",class:"q-ml-sm"},{default:e(()=>[a(g,{rotulo:d.status,cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),a(h,null,{default:e(()=>[a(V,{col:"shrink",text:"bold"},{default:e(()=>[v(C(o.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),_(a(V,{col:"grow",text:"center",class:"q-ml-sm"},{default:e(()=>[v(C(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[B,d.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(P,{onClick:b=>i.abrir(d.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:e(()=>[d.dataHoraEmissao?(I(),D(T,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(M,{name:"mdi-calendar-today"}),v(" "+C(o.$filters.data(d.dataHoraEmissao))+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v(" Emitido \xE1s "+C(o.$filters.hora(d.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):w("",!0),d.dataHoraFinalizado?(I(),D(T,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:e(()=>[a(M,{name:"mdi-calendar"}),v(" "+C(o.$filters.data(d.dataHoraFinalizado))+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v(" Finalizado \xE1s "+C(o.$filters.hora(d.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):w("",!0)]),_:2},1032,["onClick"]),a(P,{onClick:b=>i.abrir(d.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:e(()=>[a(g,{cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:e(()=>[v(C(d.status)+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v(" Status ")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),a(P,{onClick:b=>i.abrir(d.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:e(()=>[a(T,{class:"text-tertiary text-weight-bold text-right"},{default:e(()=>[v(C(o.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),_(a(T,{class:"text-tertiary text-right"},{default:e(()=>[v(C(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[B,d.qtdeContatos>0]])]),_:2},1032,["onClick"]),a(P,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:e(()=>[a(z,{class:"q-pa-none"},{default:e(()=>[r.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),D(P,{key:0,class:"q-pr-sm no-margin"},{default:e(()=>[a(S,{onClick:b=>i.abrir(d.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):w("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"&&r.tabSelecionada.valor==="N\xE3o Importada"?(I(),D(P,{key:1,class:"q-pr-sm no-margin"},{default:e(()=>[a(S,{onClick:b=>i.importarXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:e(()=>[a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):w("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),D(P,{key:2,class:"q-pr-sm no-margin"},{default:e(()=>[a(S,{onClick:b=>i.downloadXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:e(()=>[a(U,{anchor:"bottom middle",self:"center middle"},{default:e(()=>[v("Exportar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):w("",!0),a(P,{class:"no-margin"},{default:e(()=>[a(S,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:e(()=>[a(J,null,{default:e(()=>[_((I(),D(x,{link:"","no-border":"",separator:""},{default:e(()=>[(I(!0),$(O,null,H(r.configImpressao.filter(b=>b.valor),b=>(I(),D(z,{key:b.valor,onClick:y=>o.$imprimir(b.valor,(d==null?void 0:d.id)||"0"),clickable:""},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"print"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v(C(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(P,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:e(()=>[a(S,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:e(()=>[a(J,null,{default:e(()=>[_((I(),D(x,{link:"","no-border":"",separator:""},{default:e(()=>[r.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),D(z,{key:0,onClick:b=>i.abrir(d.id),clickable:"",class:"itemHover"},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"edit"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):w("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"&&r.tabSelecionada.valor==="N\xE3o Importada"?(I(),D(z,{key:1,onClick:b=>i.importarXmlDFe(d.id),clickable:"",class:"itemHover"},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"mdi-upload"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):w("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),D(z,{key:2,onClick:b=>i.downloadXmlDFe(d.id),clickable:"",class:"itemHover"},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"mdi-download"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v(" Exportar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):w("",!0),(I(!0),$(O,null,H(r.configImpressao.filter(b=>b.valor),b=>(I(),D(z,{key:b.valor,onClick:y=>o.$imprimir(b.valor,(d==null?void 0:d.id)||"0"),clickable:"",class:"itemHover"},{default:e(()=>[a(P,{avatar:""},{default:e(()=>[a(M,{name:"print"})]),_:1}),a(P,null,{default:e(()=>[a(T,null,{default:e(()=>[v(C(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(la)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","onConsultarSefazClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),a(F,{ref:"comprasFicha",onAtualizar:i.atualizar},null,8,["onAtualizar"]),a(s,{ref:"comprasImportacaoXML",onAtualizar:i.atualizar,onConcluirImportacao:i.concluirImportacao},null,8,["onAtualizar","onConcluirImportacao"]),a(oa,{modelValue:r.modalXMLNotaEntrada,"onUpdate:modelValue":t[12]||(t[12]=d=>r.modalXMLNotaEntrada=d),persistent:""},{default:e(()=>[a(Z,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:e(()=>[q("form",{onSubmit:t[11]||(t[11]=Pa((...d)=>i.importarXmlNotaDeEntrada&&i.importarXmlNotaDeEntrada(...d),["prevent"]))},[a(W,null,{default:e(()=>[a(j,null,{default:e(()=>[_(a(S,{onClick:i.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[A]]),a(Q,null,{default:e(()=>[v("Importar XML Nota de Entrada")]),_:1}),a(S,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),a(Y,{class:"u-container"},{default:e(()=>[a(aa,{style:{"min-height":"300px"}},{default:e(()=>{var d,b,y;return[q("div",mo,[a(ya,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:i.adicionarXml,filter:k=>k.filter(N=>N.type==="text/xml")},null,8,["factory","filter"]),a(ua,{modelValue:r.xmlDevolucao,"onUpdate:modelValue":t[9]||(t[9]=k=>r.xmlDevolucao=k),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),a(ua,{modelValue:r.xmlEstrangeiro,"onUpdate:modelValue":t[10]||(t[10]=k=>r.xmlEstrangeiro=k),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((y=(b=(d=r.xmlNotaEntrada.error)==null?void 0:d.data)==null?void 0:b.fields)!=null?y:{}).length?(I(),$("div",uo,[q("ul",co,[(I(!0),$(O,null,H(Object.keys(r.xmlNotaEntrada.error.data.fields),k=>(I(),$("li",{key:k},[q("span",null,C(k),1),q("span",null,C(r.xmlNotaEntrada.error.data.fields[k]),1)]))),128))])])):w("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var Co=K(io,[["render",po]]);export{Co as default};
