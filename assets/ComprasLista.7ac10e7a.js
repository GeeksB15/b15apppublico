import{_ as J,a5 as vo,r as w,o as I,d as _,w as t,f as o,M as K,G as Y,h as Q,i as W,k as g,t as V,m as B,e as S,H as x,Q as E,N as A,I as $,J as oo,p as U,b0 as bo,b1 as ao,b6 as Io,b7 as to,W as X,b8 as no,d6 as mo,d7 as H,K as io,aW as po,D as eo,bj as fo,at as j,b5 as M,s as lo,bg as G,P as O,S as z,T as y,j as T,U as N,A as Co,F as L,u as R,C as F,l as ro,aQ as co,E as Vo,bs as ho,d$ as _o,e0 as yo,av as Do,d8 as Po,aP as uo}from"./index.1b983e11.js";import{L as wo}from"./Lista.5ba90d95.js";import{S as Eo}from"./SeletorCfop.2975b683.js";import{C as So}from"./Campo.0a9c6588.js";import"./xlsx.f7bcfb26.js";const xo={components:{SeletorNcm:vo,SeletorCfop:Eo,Campo:So},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(r,a,d){var f,l,h,v,p,C,u,m,D,n;this.compra=d,this.documentoItem=$utils.clonarV2(r),this.item=$utils.clonarV2(a),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const s=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),e=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=s.concat(e).map(c=>({rotulo:c.numero.trim()+" - "+c.descr,valor:Number(c.numero)})).sort((c,b)=>Number(c.valor)-Number(b.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(c=>({rotulo:c.numero.trim()+" - "+c.descr,valor:Number(c.numero)})).sort((c,b)=>Number(c.valor)-Number(b.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(c=>({rotulo:c.numero.trim()+" - "+c.descr,valor:Number(c.numero)})).sort((c,b)=>Number(c.valor)-Number(b.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(c=>({rotulo:c.numero.trim()+" - "+c.descr,valor:Number(c.numero)})).sort((c,b)=>Number(c.valor)-Number(b.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(c=>{var b,P,k;return{rotulo:(k=(P=(b=c==null?void 0:c.descricao)!=null?b:" - "+(c==null?void 0:c.classificacao))!=null?P:" - "+(c==null?void 0:c.caminho))!=null?k:"",valor:c.id}}).sort((c,b)=>Number(c.valor)-Number(b.valor));let i;(f=this.documentoItem)!=null&&f.idCfop&&(i=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),i===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(l=i==null?void 0:i.cfop.toString())!=null?l:"",this.documentoItem.codigoCfop=(h=i==null?void 0:i.codigoCfop)!=null?h:null,this.documentoItem.idCfop=(v=i.id)!=null?v:null,this.documentoItem.valorBaseIcms=(C=(p=this.documentoItem.valorBaseIcms)!=null?p:this.documentoItem.total)!=null?C:0,this.documentoItem.valorBaseIpi=(m=(u=this.documentoItem.valorBaseIpi)!=null?u:this.documentoItem.total)!=null?m:0,this.documentoItem.valorBaseIcmsSt=(n=(D=this.documentoItem.valorBaseIcmsSt)!=null?D:this.documentoItem.total)!=null?n:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const r=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=r[0].codigoCfop,this.documentoItem.idCfop=r[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(r){$q.notifyError("Ocorreu um erro ao salvar o produto: ",r.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(r){var C,u,m,D,n,c,b,P,k,q;let a=(C=this.documentoItem.valorBaseIcms)!=null?C:0,d=(u=this.documentoItem.valorBaseIpi)!=null?u:0,s=(m=this.documentoItem.valorBaseIcmsSt)!=null?m:0,e=(D=this.documentoItem.percentualIcms)!=null?D:0,i=(n=this.documentoItem.percentualIpi)!=null?n:0,f=(c=this.documentoItem.percentualIVA)!=null?c:0,l=(b=this.documentoItem.percentualIcmsSt)!=null?b:0,h=(P=this.documentoItem.valorIcms)!=null?P:0,v=(k=this.documentoItem.valorIpi)!=null?k:0,p=(q=this.documentoItem.valorIcmsSt)!=null?q:0;["valorBaseIcms","percentualIcms"].includes(r)&&(h=a*e/100),r==="valorIcms"&&(e=h/a*100),["valorBaseIpi","percentualIpi"].includes(r)&&(v=d*i/100),r==="valorIpi"&&(i=v/d*100),r==="valorBaseIcmsSt"&&(f=0,s>0&&a>0&&s>=a&&(f=(s-a)/a*100),p=s*l/100-h),r==="percentualIVA"&&(s=a*(1+f/100),p=s*l/100-h),r==="percentualIcmsSt"&&(p=s*l/100-h),r==="valorIcmsSt"&&(l=p/s*100),this.documentoItem.valorBaseIcmsSt=parseFloat(s.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(e.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(l.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(i.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(f.toFixed(2)),this.documentoItem.valorIcms=parseFloat(h.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(p.toFixed(2)),this.documentoItem.valorIpi=parseFloat(v.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var d,s;const r=this.documentoItem.cfop,a=await $erp().cfop.where({cfop:Number(r)}).first();a===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(d=a==null?void 0:a.id)!=null?d:null,this.documentoItem.codigoCfop=(s=a==null?void 0:a.CodigoCFOP)!=null?s:null},async consultarHistoricoItem(r){const a={};(r==null?void 0:r.atual)&&Object.keys(r.atual).length>0&&(r=r.atual);const s=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:r.id}})).filter(e=>(e.operacao==="Compra"||e.operacao==="Compra de Mercadoria")&&e.status==="Finalizado"&&e.operacaoFator===1&&e.quantidade>0);for(const e of s){const i=await $db.hibrido.le({table:"documento",id:e.idDocumento}),f=await $db.hibrido.le({table:"contato",id:i.idContato});a[e.idItem]||(a[e.idItem]={fornecedores:[]}),a[e.idItem].fornecedores.push({fornecedor:f.apelido||"",dataCompra:i.dataCompra||"",quantidade:e.quantidade||"",valorCusto:e.valorItem||"",valorTotal:e.valorItem*e.quantidade||""})}Object.keys(a).length>0?(this.historicoItem=a,this.historicoItem[r.id].fornecedores.sort((e,i)=>{const f=new Date(e.dataCompra||"1900-01-01");return new Date(i.dataCompra||"1900-01-01")-f})):this.historicoItem[r.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(r){const a={};(r==null?void 0:r.atual)&&Object.keys(r.atual).length>0&&(r=r.atual);const d=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:r.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const s of d){const e=await $db.hibrido.le({table:"contato",id:s.idEmpresa});a[s.idItem]||(a[s.idItem]={estoques:[]}),a[s.idItem].estoques.push({empresa:e.apelido||"",tipoEstoque:s.tipoEstoque||"",lote:s.lote||"-",quantidade:s.saldo||""})}Object.keys(a).length>0?(this.estoqueItem=a,this.estoqueItem[r.id].estoques.sort((s,e)=>{const i=Number(s.quantidade||0);return Number(e.quantidade||0)-i})):this.estoqueItem[r.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},Fo=["src"],ko={key:0},qo={key:0};function No(r,a,d,s,e,i){const f=w("badge"),l=w("g-col"),h=w("g-row"),v=w("campo"),p=w("SeletorNcm"),C=w("SeletorCfop"),u=w("g-label");return I(),_(eo,{modelValue:e.visivel,"onUpdate:modelValue":a[36]||(a[36]=m=>e.visivel=m),persistent:""},{default:t(()=>[o(K,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:t(()=>[o(Y,{class:"bg-primary"},{default:t(()=>[o(Q,{class:"bg-primary text-white"},{default:t(()=>[o(W,null,{default:t(()=>[g(V(e.documentoItem.descricaoItem),1)]),_:1}),e.item.referencia?(I(),_(f,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:t(()=>[g(V(e.item.referencia)+" ",1),o(B,null,{default:t(()=>[g(" Refer\xEAncia ")]),_:1})]),_:1})):S("",!0),e.item.codigoItem?(I(),_(f,{key:1,cor:"positive",class:"q-mr-sm"},{default:t(()=>[g(" #"+V(e.item.codigoItem.toString().padStart(4,"0"))+" ",1),o(B,null,{default:t(()=>[g(" C\xF3digo Item ")]),_:1})]),_:1})):S("",!0),x(o(E,{onClick:i.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[A]])]),_:1})]),_:1}),o($,null,{default:t(()=>[o(oo,null,{default:t(()=>[o(h,{gutter:"md"},{default:t(()=>[o(l,null,{default:t(()=>[o(h,{class:"col-12 text-center"},{default:t(()=>[o(l,null,{default:t(()=>{var m,D,n,c,b,P;return[((m=e.item)==null?void 0:m.imagem)||((n=(D=e.item)==null?void 0:D.atual)==null?void 0:n.imagem)?(I(),U("img",{key:0,src:((c=e.item)==null?void 0:c.imagem)||((P=(b=e.item)==null?void 0:b.atual)==null?void 0:P.imagem),alt:"",style:{"max-width":"33%"}},null,8,Fo)):S("",!0)]}),_:1})]),_:1}),o(bo,{modelValue:e.abaSelecionada,"onUpdate:modelValue":a[0]||(a[0]=m=>e.abaSelecionada=m),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:t(()=>[o(ao,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),o(ao,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),o(ao,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),o(Io,{modelValue:e.abaSelecionada,"onUpdate:modelValue":a[35]||(a[35]=m=>e.abaSelecionada=m),animated:"",class:"text-tertiary"},{default:t(()=>[o(to,{name:"tab1",class:"q-px-sm"},{default:t(()=>[o(h,null,{default:t(()=>[o(l,null,{default:t(()=>[o(v,{modelValue:e.documentoItem.observacao,"onUpdate:modelValue":a[1]||(a[1]=m=>e.documentoItem.observacao=m),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),o(h,{mg:"lg-t"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(v,{modelValue:e.documentoItem.referenciaFornecedor,"onUpdate:modelValue":a[2]||(a[2]=m=>e.documentoItem.referenciaFornecedor=m),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),o(h,{mg:"lg-t"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(p,{modelValue:e.documentoItem.ncm,"onUpdate:modelValue":a[3]||(a[3]=m=>e.documentoItem.ncm=m),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),o(h,{mg:"lg-t"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(C,{modelValue:e.documentoItem.cfop,"onUpdate:modelValue":a[4]||(a[4]=m=>e.documentoItem.cfop=m),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),o(h,{mg:"lg-t"},{default:t(()=>[o(l,null,{default:t(()=>[o(u,{text:"sub1 medium"},{default:t(()=>[g("Estoque")]),_:1})]),_:1})]),_:1}),o(h,{items:"center"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(v,{modelValue:e.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":a[5]||(a[5]=m=>e.documentoItem.idPlanoContaEstoque=m),opcoes:e.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),o(h,{mg:"lg-t"},{default:t(()=>[o(l,null,{default:t(()=>[o(u,{text:"sub1 medium"},{default:t(()=>[g("Impostos")]),_:1})]),_:1})]),_:1}),o(h,null,{default:t(()=>[o(X,{label:"ICMS",modelValue:e.exibirIcms,"onUpdate:modelValue":a[6]||(a[6]=m=>e.exibirIcms=m)},null,8,["modelValue"])]),_:1}),e.exibirIcms?(I(),_(h,{key:0,items:"center"},{default:t(()=>[o(l,{col:"12 sm6"},{default:t(()=>[o(v,{modelValue:e.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":a[7]||(a[7]=m=>e.documentoItem.modalidadeBaseCalculo=m),opcoes:e.impostoIcmsModalidade,"somente-leitura":e.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(v,{modelValue:e.documentoItem.codigoCst,"onUpdate:modelValue":a[8]||(a[8]=m=>e.documentoItem.codigoCst=m),opcoes:e.impostoCstIcms,"somente-leitura":e.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorBaseIcms,"onUpdate:modelValue":a[9]||(a[9]=m=>e.documentoItem.valorBaseIcms=m),onBlur:a[10]||(a[10]=m=>i.calcularImpostos("valorBaseIcms")),"somente-leitura":e.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.percentualIcms,"onUpdate:modelValue":a[11]||(a[11]=m=>e.documentoItem.percentualIcms=m),onBlur:a[12]||(a[12]=m=>i.calcularImpostos("percentualIcms")),"somente-leitura":e.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorIcms,"onUpdate:modelValue":a[13]||(a[13]=m=>e.documentoItem.valorIcms=m),onBlur:a[14]||(a[14]=m=>i.calcularImpostos("valorIcms")),"somente-leitura":e.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):S("",!0),o(h,null,{default:t(()=>[o(X,{label:"ICMS ST",modelValue:e.exibirIcmsSt,"onUpdate:modelValue":a[15]||(a[15]=m=>e.exibirIcmsSt=m)},null,8,["modelValue"])]),_:1}),e.exibirIcmsSt?(I(),_(h,{key:1,items:"center"},{default:t(()=>[o(l,{col:"12 sm6"},{default:t(()=>[o(v,{modelValue:e.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":a[16]||(a[16]=m=>e.documentoItem.modalidadeBaseCalculoST=m),opcoes:e.impostoCstIcmsSt,"somente-leitura":e.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(v,{modelValue:e.documentoItem.percentualIVA,"onUpdate:modelValue":a[17]||(a[17]=m=>e.documentoItem.percentualIVA=m),onBlur:a[18]||(a[18]=m=>i.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":a[19]||(a[19]=m=>e.documentoItem.valorBaseIcmsSt=m),onBlur:a[20]||(a[20]=m=>i.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":e.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.percentualIcmsSt,"onUpdate:modelValue":a[21]||(a[21]=m=>e.documentoItem.percentualIcmsSt=m),onBlur:a[22]||(a[22]=m=>i.calcularImpostos("percentualIcmsSt")),"somente-leitura":e.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorIcmsSt,"onUpdate:modelValue":a[23]||(a[23]=m=>e.documentoItem.valorIcmsSt=m),onBlur:a[24]||(a[24]=m=>i.calcularImpostos("valorIcmsSt")),"somente-leitura":e.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):S("",!0),o(h,null,{default:t(()=>[o(X,{label:"IPI",modelValue:e.exibirIpi,"onUpdate:modelValue":a[25]||(a[25]=m=>e.exibirIpi=m)},null,8,["modelValue"])]),_:1}),e.exibirIpi?(I(),_(h,{key:2,items:"center"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(v,{modelValue:e.documentoItem.codigoCstIpi,"onUpdate:modelValue":a[26]||(a[26]=m=>e.documentoItem.codigoCstIpi=m),opcoes:e.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorBaseIpi,"onUpdate:modelValue":a[27]||(a[27]=m=>e.documentoItem.valorBaseIpi=m),onBlur:a[28]||(a[28]=m=>i.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.percentualIpi,"onUpdate:modelValue":a[29]||(a[29]=m=>e.documentoItem.percentualIpi=m),onBlur:a[30]||(a[30]=m=>i.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),o(l,{col:"12 sm4"},{default:t(()=>[o(v,{modelValue:e.documentoItem.valorIpi,"onUpdate:modelValue":a[31]||(a[31]=m=>e.documentoItem.valorIpi=m),onBlur:a[32]||(a[32]=m=>i.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):S("",!0)]),_:1}),o(to,{name:"tab2",class:"q-px-sm"},{default:t(()=>[e.exibirHistorico?(I(),_(no,{key:0,rows:e.historicoItem[e.documentoItem.idItem].fornecedores,columns:e.tabelaHistoricoItem.colunas,pagination:e.tabelaHistoricoItem.paginacao,"onUpdate:pagination":a[33]||(a[33]=m=>e.tabelaHistoricoItem.paginacao=m),"row-key":"index",class:"no-shadow text-left"},{body:t(m=>[o(mo,{props:m},{default:t(()=>[o(H,{key:"fornecedor",props:m},{default:t(()=>[g(V(m.row.fornecedor),1)]),_:2},1032,["props"]),o(H,{key:"dataCompra",props:m},{default:t(()=>[m.row.dataCompra!==""?(I(),U("span",ko,V(r.$filters.data(m.row.dataCompra)),1)):S("",!0)]),_:2},1032,["props"]),o(H,{key:"quantidade",props:m},{default:t(()=>[g(V(m.row.quantidade),1)]),_:2},1032,["props"]),o(H,{key:"valorCusto",props:m},{default:t(()=>[g(V(r.$filters.numero(m.row.valorCusto,2)),1)]),_:2},1032,["props"]),o(H,{key:"valorTotal",props:m},{default:t(()=>[g(V(r.$filters.numero(m.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):S("",!0)]),_:1}),o(to,{name:"tab3",class:"q-px-sm"},{default:t(()=>[e.exibirEstoque?(I(),_(no,{key:0,rows:e.estoqueItem[e.documentoItem.idItem].estoques,columns:e.tabelaEstoqueItem.colunas,pagination:e.tabelaEstoqueItem.paginacao,"onUpdate:pagination":a[34]||(a[34]=m=>e.tabelaEstoqueItem.paginacao=m),"row-key":"index",class:"no-shadow text-left"},{body:t(m=>[o(mo,{props:m},{default:t(()=>[o(H,{key:"empresa",props:m},{default:t(()=>[g(V(m.row.empresa),1)]),_:2},1032,["props"]),o(H,{key:"tipoEstoque",props:m},{default:t(()=>[g(V(m.row.tipoEstoque),1)]),_:2},1032,["props"]),o(H,{key:"lote",props:m},{default:t(()=>[m.row.lote!==""?(I(),U("span",qo,V(m.row.lote),1)):S("",!0)]),_:2},1032,["props"]),o(H,{key:"quantidade",props:m},{default:t(()=>[g(V(m.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):S("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(io,{class:"bg-light q-pa-sm",bordered:""},{default:t(()=>[o(Q,null,{default:t(()=>[o(po),x(o(E,{onClick:i.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[A]]),o(E,{onClick:i.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var To=J(xo,[["render",No]]);const zo={components:{ModalEditarProdutoCompras:To,PromptItemV2:fo},data(){return{ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},compra:{},compraItens:[],compraTitulos:[],compraMovimentacoes:[],compraCondicoesDePagamento:[],produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const r=this.compra.condicaoPagamento;return/^[\d/]*$/.test(r)}],formaPagamentoRules:[async()=>{const r=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(r)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,itensImagens:{},exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1}},emits:["atualizar"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(r){const a=this.produtos[r.idItem],d=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(r,a,d)},removerItem(r){this.compraItens=this.compraItens.filter(a=>a.id!==r.id),this.calcularTotais()},fecharEdicaoProduto(r){const a=this.compraItens.findIndex(d=>d.id===r.id);this.compraItens[a]=$utils.clonar(r),this.calcularTotaisItem(a)},async atualizar(){var a,d;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((s,e)=>new Date(s.dataHoraEmissao||0)-new Date(e.dataHoraEmissao||0)),this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((s,e)=>new Date(s.dataVencimento||0)-new Date(e.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(a=this.compra.calcularTributacao)!=null?a:!0,this.compra.naoGerarFinanceiro=(d=this.compra.naoGerarFinanceiro)!=null?d:!1;const r=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.contatos=(await $db.hibrido.lista({table:"contato",whereIn:{id:r}})).reduce((s,e)=>(s[e.id]=e,s),{}),this.compraItensImagens=$utils.clonar(this.compraItensOriginal),await this.processarImagem(this.compraItensImagens);for(let s in this.compraItens)this.produtos[this.compraItens[s].idItem]=await $db.item.leNew({id:this.compraItens[s].idItem});if(this.valorTotalPagamento===0)for(const s of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+s.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const r=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=j.formatDate(r)}await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Compra foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.operacao=this.compra.operacao,await $db.compra.remove(this.compra),await this.fechar(),$q.notifyPositive(`${this.operacao} foi excluido com sucesso!`)},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const r=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(r.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let a=r[0];if(r.length>1){const e={ativo:!0,empresas:!0};if(a=await $g.promptContato.show({filtro:e,placeholder:"Selecione a empresa"}),!a){this.ocultarModal(),this.$q.notifyError("Empresa n\xE3o selecionada");return}}const d=(await $db.hibrido.lista({table:"empresa",where:{idContato:a.id}}))[0];if(!d){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[a.id]||(this.contatos[a.id]=await $db.contato.le({id:a.id})),this.compraItensOriginal=[],this.compraItens=[],this.compraCondicoesDePagamentoOriginal=[],this.compraCondicoesDePagamento=[],this.compraTitulosOriginal=[],this.compraTitulos=[],this.compraMovimentacoesOriginal=[],this.compraMovimentacoes=[],this.compraOriginal={},this.compra={id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:d.codigoContato,descricaoEmpresa:d.nome,numeroDocumentoEmpresa:d.numeroDocumentoNacional,codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:d.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0},!await this.abrirModalFornecedor()){this.ocultarModal(),this.$q.notifyError("Fornecedor n\xE3o selecionado");return}this.documentoNovo=!0,this.exibeInfNota=!0}),this.visivel=!0},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const r=$utils.arredondar(this.compraCondicoesDePagamento.reduce((a,d)=>a+d.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==r,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(r){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",r),!1}},async finalizar_click(){if(!await this.validaCampos())return;let r=!1;this.compra.naoGerarFinanceiro||(r=await $q.dialogSimNao({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?"})),await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=r?1:void 0,await this.finalizarItens(),r&&await this.gerarFinanceiro(),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),r&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{memsagem:"Finalizando Compra..."})},finalizarItens(){var i,f;let r=1,a=0,d=0,s=!1;const e=this.compra;if(e.subTotalProduto>0&&(e.tipoFrete==="FOB"&&e.freteSeparado===0&&(a=e.valorFrete+e.valorSeguro),r=(e.subTotalProduto+e.valorOutrasDespesas-e.totalDesconto+a)/e.subTotalProduto),d=this.compraItens.reduce((l,h)=>l+h.valorIcmsSt,d),d!==e.valorIcmsSt&&(s=!0),e.operacao==="Nota de Entrada")for(const l of this.compraItens)l.dataCompra=$utils.dataAtual(),s&&(l.valorIcmsSt=e.valorIcmsSt*((l==null?void 0:l.total)||0)/(e.subTotalProduto>0?e.subTotalProduto:1)),l.valorFreteRateado=e.valorFrete*(((l==null?void 0:l.total)||0)/(e.subTotalProduto||1)),l.valorSeguroRateado=e.valorSeguro*(((l==null?void 0:l.total)||0)/(e.subTotalProduto||1)),l.valorOutrasDespesasRateado=(e.valorOutrasDespesas||0)*(((l==null?void 0:l.total)||0)/(e.subTotalProduto||1)),l.descontoTotalRateado=(e.totalDesconto||0)*(((l==null?void 0:l.total)||0)/(e.subTotalProduto||1)),(l==null?void 0:l.valorIcmsSt)-(l==null?void 0:l.valorIcms)>0&&((l==null?void 0:l.valorIcmsSt)||0)-((l==null?void 0:l.valorIcms)||0),l.valorRealTotal=((l==null?void 0:l.total)||0)*r+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcms)||0),l.valorRealTotalImpostos=((l==null?void 0:l.total)||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcmsSt)||0),l.valorReal=l.valorRealTotalImpostos/((l==null?void 0:l.quantidade)||1),l.valorCustoReposicao=((i=this.produtos[l.idItem])==null?void 0:i.valorCustoReposicao)||0;if(e.operacao==="Pedido de Compra")for(const l of this.compraItens){s&&(l.valorIcmsSt=$utils.arredondar(e.valorIcmsSt*(l.total||0)/(e.subTotalProduto>0?e.subTotalProduto:1))),l.valorFreteRateado=$utils.arredondar((e.valorFrete||0)*(l.total||0)/(e.subTotalProduto||1),4),l.valorSeguroRateado=$utils.arredondar((e.valorSeguro||0)*(l.total||0)/(e.subTotalProduto||1),4),l.valorOutrasDespesasRateado=$utils.arredondar((e.valorOutrasDespesas||0)*(l.total||0)/(e.subTotalProduto||1),4),l.descontoTotalRateado=$utils.arredondar((e.totalDesconto||0)*(l.total||0)/(e.subTotalProduto||1),4);let h=0;l.valorIcmsSt-l.valorIcms>0&&(h=$utils.arredondar((l.valorIcmsSt||0)-(l.valorIcms||0),2)),l.valorRealTotal=$utils.arredondar((l.total||0)*r+(l.valorIpi||0)+(h>0?h:0),2),l.valorRealTotalImpostos=$utils.arredondar((l.total||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+(l.valorIpi||0)+(l.valorIcmsSt||0),4),l.valorReal=$utils.arredondar(l.valorRealTotalImpostos/(l.quantidade||1),4),l.valorCustoReposicao=$utils.arredondar(((f=this.produtos[l.idItem])==null?void 0:f.valorCustoReposicao)||0,2)}},async transformarEmNotaCompra_click(){if(this.compra.operacao==="Pedido de Compra")try{$q.loading.show();const r=(await $db.itemFornecedor.ler()).filter(a=>a.idContato===this.compra.idContato);for(const a of this.compraItens)if(!r.map(d=>d.idItem).includes(a.idItem)){const d={id:$utils.uuid(),idItem:a.idItem,idContato:this.compra.idContato,referencia:"",descricao:a.descricaoItem};await $db.itemFornecedor.gravar({atual:d,original:{}})}this.compra.operacao="Nota de Entrada",await this.retornarParaDigitacao(),this.$emit("atualizar"),this.ocultarModal()}catch(r){$q.notifyError("Ocorreu um erro!",r)}finally{$q.loading.hide()}},async mostrar({id:r}){this.visivel=!0;const a=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=r,await this.atualizar()}),$utils.logarFim(a,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.compraOriginal={},this.produtos=[],this.compra={},this.compraItensOriginal=[],this.compraItens=[],this.compraCondicoesDePagamentoOriginal=[],this.compraCondicoesDePagamento=[],this.compraTitulosOriginal=[],this.compraTitulos=[],this.compraMovimentacoesOriginal=[],this.compraMovimentacoes=[],this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const r={ativo:!0,empresas:!0},a=await $g.promptContato.show({filtro:r,placeholder:"Selecione"});if(!a)return;let d=(await $db.hibrido.lista({table:"empresa",where:{idContato:a.id}}))[0];if(!d){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[a.id]||(this.contatos[a.id]=await $db.contato.le({id:a.id})),this.compra.descricaoEmpresa=d.nome,this.compra.idEmpresa=d.idContato,this.compra.codigoEmpresa=d.codigoContato,this.compra.numeroDocumentoEmpresa=d.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=d.InscricaoMunicipalEmpresa},async abrirModalComprador(){const r=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});r.id&&(this.compra.idContatoComprador=r.id),this.contatos[r.id]||(this.contatos[r.id]=await $db.contato.le({id:r.id}))},async abrirModalFornecedor(){const r={ativo:!0},a=await $g.promptContato.show({filtro:r,placeholder:"Selecione o fornecedor"});if(!a)return a;const d=await $db.contatoTelefone.le({idContato:a.id}),s=await $db.contatoEndereco.le({idContato:a.id}),e=d.find(l=>l.tipoTelefone==="Principal"||l.tipoTelefone==="WhatsApp")||d[0]||null,i=s.find(l=>l.grupo==="Principal")||s[0]||null;let f;return i&&Object.keys(i).length>0&&(f=`${i.logradouro}, ${i.numero} ${i.complemento} - ${i.bairro} - ${i.municipio}/${i.uf}`),a.id&&(this.compra.idContato=a.id,this.compra.codigoContato=a.codigoContato,this.compra.descricaoContato=a.nome,this.compra.numeroDocumentoContato=a.numeroDocumentoNacional,this.compra.emailContato=(a==null?void 0:a.email)||null,this.compra.regimeContato=(a==null?void 0:a.regime)||null,this.compra.telefoneContato=(e==null?void 0:e.telefone)||null,this.compra.descricaoContatoEndereco=f||null),this.contatos[a.id]||(this.contatos[a.id]=await $db.contato.le({id:a.id})),a},async abrirModalVendedor(){const r=(await $db.contato.leFilhos(this.compra.idContato)).map(d=>d.id),a=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:r}});a.id&&(this.compra.CodigoContatoVendedor=a.codigoContato,this.compra.idContatoVendedor=a.id),this.contatos[a.id]||(this.contatos[a.id]=await $db.contato.le({id:a.id}))},async abrirModalTransportador(){const r=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});r.id&&(this.compra.idContatoTransportadora=r.id),this.contatos[r.id]||(this.contatos[r.id]=await $db.contato.le({id:r.id}))},async selecionarContato(r){const{placeholder:a,filtro:d}={placeholder:"Selecione o contato",filtro:{ativo:!0},...r},s=await $g.promptContato.show({filtro:d,placeholder:a});if(!s)throw new Error("Contato n\xE3o selecionado");return s},async adicionarItem(){let r={},a=[];for(const d of a)r[d.idItem]={item:await $db.hibrido.le({table:"item",id:d.idItem}),quantidade:d.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(r){var a,d;for(const s in r){let e=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:s}});e=e[0];const i=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((a=i.find(m=>m.id))==null?void 0:a.valor);const f=r[s].item||{},l=((d=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:f.id}}))[0])==null?void 0:d.referencia)||null,h=r[s].quantidade||0,v=(f==null?void 0:f.valorCustoReposicao)||(e==null?void 0:e.valorCustoMedio)||0;let p=this.compraItens.find(m=>m.idItem===s);const C=(await $erp().cfop.where({cfop:5102}).toArray())[0],u=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(p)p.quantidade=$utils.arredondar(h,4),p.quantidadeRealizado=$utils.arredondar(h,4),p.subTotal=$utils.arredondar(v,2),p.total=$utils.arredondar(h*v,2);else{let m={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:f.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:f.id,codigoItem:f.codigoItem,referencia:f.referencia,referenciaFornecedor:l,ncm:f.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:C==null?void 0:C.id,idPlanoContaEstoque:u==null?void 0:u.id,quantidade:$utils.arredondar(h,4),quantidadeRealizado:$utils.arredondar(h,4),status:"Digita\xE7\xE3o",tipoItem:f.tipo,subTotal:$utils.arredondar(v,2),total:$utils.arredondar(h*v,2),unidade:f.unidade,valorCustoMedio:(e==null?void 0:e.valorCustoMedio)||0,valorItem:v,valorOriginal:v,observacao:""};this.produtos[f.id]=await $db.item.leCompleto({id:f.id}),this.compraItens.push(m),await this.processarImagem(this.compraItens)}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let m in this.compraItens)this.compra.subTotal+=this.compraItens[m].total,this.compra.subTotalProduto+=this.compraItens[m].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},calcularTotaisItem(r,a){const d=$utils.clonar(this.compraItens[r]),s=d.valorOriginal||0,e=d.quantidade||0;let i=d.valorItem||0,f=d.descontoPercentualItem||0,l=d.descontoItem||0,h=d.subTotal||0,v=d.total||0;a==="descontoPercentualItem"&&((f<0||f>100)&&(f=0),l=i*f/100,h=i-l),a==="descontoItem"&&((l<0||l>i)&&(l=0),f=l/i*100,h=i-l),a==="valorItem"&&(i<s&&(i=s),l>i&&(l=0,f=0),f=l/i*100,h=i-l),a==="subTotal"&&((h<0||h>i)&&(h=i),l=i-h,f=l/i*100),v=e*h,d.valorItem=i,d.descontoItem=l,d.descontoPercentualItem=f,d.subTotal=h,d.total=v,this.compraItens[r]=d,this.calcularTotais("totalDesconto")},calcularTotais(r){const a=$utils.clonar(this.compra);let d=0,s=0,e=0,i=a.totalDesconto||0,f=a.totalPercentualDesconto||0,l=a.valorFrete||0,h=a.valorSeguro||0,v=a.valorOutrasDespesas||0,p=0,C=0,u=0,m=0,D=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const n of this.compraItens)d+=n.total,p+=n.valorBaseIcms||0,C+=n.valorIcms||0,u+=n.valorBaseIcmsSt||0,m+=n.valorIcmsSt||0,D+=n.valorIpi||0;r==="totalPercentualDesconto"&&(this.erroDesconto=!1,(f<0||f>100)&&(this.erroDesconto=!0),i=d*f/100),r==="totalDesconto"&&(this.erroDesconto=!1,(i<0||i>d)&&(this.erroDesconto=!0),f=i/d*100),l<0&&(this.erroFrete=!0),l=a.tipoFrete==="FOB"?l:0,h<0&&(this.erroSeguro=!0),h=a.tipoFrete==="FOB"?h:0,v<0&&(this.erroOutrasDespesas=!0),a.calcularTributacao||(p=0,C=0,u=0,m=0),a.totalComImposto||(D=0),s=d-i+l+h+v,e=s+D,a.valorBaseIcms=$utils.arredondar(p,2),a.valorIcms=$utils.arredondar(C),a.valorBaseIcmsSt=$utils.arredondar(u),a.valorIcmsSt=$utils.arredondar(m),a.valorIpi=$utils.arredondar(D),a.totalDesconto=$utils.arredondar(i),a.totalPercentualDesconto=$utils.arredondar(f),a.subTotalProduto=$utils.arredondar(d),a.totalProduto=$utils.arredondar(d)-$utils.arredondar(i),a.subTotal=$utils.arredondar(s),a.totalDocumento=$utils.arredondar(e),this.compra=a},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto,await $db.hibrido.grava("documento",{atual:this.compra,original:this.compraOriginal});const r=this.compraItens,a=this.compraItensOriginal,d=a.filter(u=>!r.find(m=>m.id===u.id));await $db.hibrido.remove(d,"documentoItem");for(const u of r){u.dataHoraFinalizado=this.compra.dataHoraFinalizado,u.status=this.compra.status;const m=a.find(D=>D.id===u.id);await $db.hibrido.grava("documentoItem",{atual:u,original:m})}const s=this.compraCondicoesDePagamento,e=this.compraCondicoesDePagamentoOriginal,i=e.filter(u=>!s.find(m=>m.id===u.id));await $db.hibrido.remove(i,"documentoCondicaoPagamento");for(const u of s){const m=e.find(D=>D.id===u.id);await $db.hibrido.grava("documentoCondicaoPagamento",{atual:u,original:m})}const f=this.compraTitulos,l=this.compraTitulosOriginal,h=l.filter(u=>!f.find(m=>m.id===u.id));await $db.hibrido.remove(h,"financeiroTitulo");for(const u of f){const m=l.find(D=>D.id===u.id);await $db.hibrido.grava("financeiroTitulo",{atual:u,original:m})}const v=this.compraMovimentacoes,p=this.compraMovimentacoesOriginal,C=p.filter(u=>!v.find(m=>m.id===u.id));await $db.hibrido.remove(C,"financeiroMovimentacao");for(const u of v){const m=p.find(D=>D.id===u.id);await $db.hibrido.grava("financeiroMovimentacao",{atual:u,original:m})}this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const r=$utils.logarIni("calculaKardex"),a=this.compraItens.map(({idItem:d})=>d).filter(Boolean);try{a.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:a}})}catch(d){console.error(`Erro ao calcular Kardex
`,d)}$utils.logarFim(r,a.length)},async reabrir_click(){!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${this.compra.naoGerarFinanceiro?"":"<strong>O Financeiro ser\xE1 apagado!</strong>"}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const r=this.compraTitulos.filter(({dataPagamento:a})=>a);$utils.verificarErro(r.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[])},async removerPagamento_click(r){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(a=>a.id!==r.id),this.compraCondicoesDePagamento.sort((a,d)=>{let s=new Date(a.dataVencimento),e=new Date(d.dataVencimento);return s-e}),await this.atualizaValorTotalPagamento({condicao:r,acao:"remover"})}catch(a){console.log(a.message)}},async gerarCondicoesDePagamento_click(){var r;try{let a=this.compra.id,d=this.compra.codigoDocumento,s=this.compra.condicaoPagamento,e=(r=this.compra.notaNumero)!=null?r:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(a,s,e),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(a){console.log(a.message)}},async gerarParcelamento(r,a,d){var C;this.compraCondicoesDePagamento=[];const s=$utils.clonar(this.compra),e=a.split("/").length,i=!!(s!=null&&s.dataCompra)&&(s==null?void 0:s.dataCompra)!==""?s.dataCompra:!!(s!=null&&s.dataHoraPrevisto)&&(s==null?void 0:s.dataHoraPrevisto)!==""?s.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),f=(s==null?void 0:s.freteSeparado)||0;let l=$utils.arredondar(s==null?void 0:s.totalDocumento,2);const h=((s==null?void 0:s.valorFrete)||0)+((s==null?void 0:s.valorSeguro)||0);if(f&&(s==null?void 0:s.tipoFrete)==="FOB"&&h>0){let u={id:$utils.uuid(),codigoDocumento:s==null?void 0:s.codigoDocumento,idDocumento:s==null?void 0:s.id,dataVencimento:i,valor:h,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(u),l-=h}let v=0,p=l/e;for(let u in a.split("/")){let m=!!(s!=null&&s.dataCompra)&&(s==null?void 0:s.dataCompra)!==""?s.dataCompra:!!(s!=null&&s.dataHoraPrevisto)&&(s==null?void 0:s.dataHoraPrevisto)!==""?s.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof m=="string"&&(m=(C=new Date(m))!=null?C:$utils.dataAtual()),m.setDate(m.getDate()+parseInt(a.split("/")[u])||0);let D={id:$utils.uuid(),codigoDocumento:s==null?void 0:s.codigoDocumento,idDocumento:s==null?void 0:s.id,dataVencimento:j.formatDate(m),valor:p,observacao:""};this.compraCondicoesDePagamento.push(D),v+=p||0}l!==v&&(this.compraCondicoesDePagamento[0].valor+=(l||0)-(v||0)),this.valorTotalPagamento=f&&(s==null?void 0:s.tipoFrete)==="FOB"?l+h:l},async gerarFinanceiro(){var f;const r=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),a=[];for(const l of this.compraItens){if(l.idPlanoContaEstoque===r.id)continue;const h=(l.total||0)-(l.descontoTotalRateado||0),v=a.findIndex(({idPlanoContaEstoque:p})=>p===l.idPlanoContaEstoque);v!==-1?a[v].valor+=h:a.push({idPlanoContaEstoque:l.idPlanoContaEstoque,idPlanoContaDestino:"",valor:h,porcentagem:0})}for(const l of a)l.valor=$utils.arredondar(l.valor),l.porcentagem=$utils.arredondar(l.valor/this.compra.totalDocumento,4);const d=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),s=this.compraTitulos.filter(({dataPagamento:l})=>l);$utils.verificarErro(s.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const e=j.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const l in this.compraCondicoesDePagamento){const h=this.compraCondicoesDePagamento[l],v=[h.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),p={id:$utils.uuid(),dataEmissao:e,dataCompetencia:e,dataVencimento:j.formatDate(new Date(h.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:j.formatDate(new Date(h.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(h.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(l)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:v,formaDePagamento:`Provis\xE3o Pedido - ${(f=this.compra.formaDePagamento)!=null?f:""}`,receberPagar:0,valorOriginal:$utils.arredondar(h.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(h.valor,2),valorARealizar:$utils.arredondar(h.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(h==null?void 0:h.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:h.observacao==="Valor Frete + Seguro"?d.id:r==null?void 0:r.id,documentoId:this.compra.id,cobrancaAtivo:1};this.compraTitulos.push(p)}const i=$utils.uuid();this.compraMovimentacoes=[];for(const l of a){const h={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:r.id,dataEmissao:e,valorCredito:this.compra.totalDocumento*l.porcentagem,valorDebito:0,descricao:r.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:e,dataVencimento:e,dataMovimento:e,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(h);const v=await $db.financeiroPlanoConta.leCache({id:l.idPlanoContaEstoque}),p={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:l.idPlanoContaEstoque,dataEmissao:e,valorCredito:0,valorDebito:this.compra.totalDocumento*l.porcentagem,descricao:v.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:e,dataVencimento:e,dataMovimento:e,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(p)}},async processarImagem(r){if(!!r){for(const a of r)if(!this.itensImagens.hasOwnProperty(a.idItem)){const d=await $db.item.leCompleto({id:a.idItem});Object.keys(d.atual).length>0&&(d.atual.imagem===""||d.atual.imagem)?this.itensImagens[a.idItem]={imagem:d.atual.imagem}:Object.keys(d.original).length>0&&(d.original.imagem===""||d.original.imagem)&&(this.itensImagens[a.idItem]={imagem:d.original.imagem})}}},async atualizaValorTotalPagamento({condicao:r,acao:a}){!r||a==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-r.valor)},async ajustarPrevisaoEntrega(r){if(r==="alterar"&&(this.alterarPrevisaoEntrega=!0),r==="salvar"){const a=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;if(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega)return $q.notifyError("\xC9 necess\xE1rio preencher uma data em conjunto com a hora.");if(j.formatDate(a)!==j.formatDate(this.compra.dataHoraPrevisto)){try{this.compra.dataHoraPrevisto=j.formatDate(a)||"",await $db.documento.grava({original:this.compraOriginal,atual:this.compra})}catch{$q.notifyError("Erro ao gravar os dados da compra.")}$q.notifyPositive("Os dados da compra foram salvos com sucesso.")}else $q.notifyPositive("N\xE3o h\xE1 dados alterados.");this.alterarPrevisaoEntrega=!1}}}},Uo={class:"row items-center"},Mo={class:"col-auto"},Bo={class:"col-auto"},Oo=F("span",{class:"q-px-xs"},"|",-1);function Ao(r,a,d,s,e,i){const f=w("g-label"),l=w("g-col"),h=w("Badge"),v=w("BadgeCopiarUid"),p=w("g-row"),C=w("avatar"),u=w("campo"),m=w("ModalEditarProdutoCompras"),D=w("PromptItemV2");return I(),U(L,null,[o(eo,{modelValue:e.visivel,"onUpdate:modelValue":a[36]||(a[36]=n=>e.visivel=n),persistent:"",maximized:"",onKeyup:ho(i.fechar,["esc"])},{default:t(()=>[o(K,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:t(()=>[o(Y,null,{default:t(()=>[o(Q,null,{default:t(()=>[o(E,{onClick:i.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),o(W,null,{default:t(()=>[g(V(e.compra.operacao),1)]),_:1}),x(o(E,{onClick:i.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[M,e.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),o($,{class:"u-container"},{default:t(()=>[o(oo,null,{default:t(()=>[o(p,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o(l,{col:"12 sm12 md6"},{default:t(()=>[o(p,{items:"center",justify:"end",class:"hideondesktop",style:{border:"1px solid salmon"}},{default:t(()=>[o(l,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[x(o(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${r.$filters.hora(e.compra.dataHoraEmissao)}`},{default:t(()=>[g(V(r.$filters.data(e.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[M,e.compra.dataHoraEmissao]])]),_:1}),o(l,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[x(o(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${r.$filters.hora(e.compra.dataHoraFinalizado)}`},{default:t(()=>[g(V(r.$filters.data(e.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[M,e.compra.dataHoraFinalizado]])]),_:1}),o(l,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:t(()=>[o(h,{cor:e.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:e.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[g(V(e.compra.status),1)]),_:1},8,["cor","escuro"]),o(v,{id:e.compra.id,numero:e.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"])]),_:1})]),_:1}),o(p,null,{default:t(()=>[o(l,{col:"12 sm6"},{default:t(()=>[o(p,null,{default:t(()=>[o(l,{col:"xs-shrink"},{default:t(()=>[o(C,{imagem:(e.contatos[e.compra.idContato]||{}).imagem,rotulo:(e.contatos[e.compra.idContato]||{}).apelido,tamanho:"50"},null,8,["imagem","rotulo"])]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{modelValue:(e.contatos[e.compra.idContato]||{}).apelido,"onUpdate:modelValue":a[0]||(a[0]=n=>(e.contatos[e.compra.idContato]||{}).apelido=n),after:[{icon:"edit",handler(){i.abrirModalFornecedor()}}],disable:e.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1})]),_:1})]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(u,{modelValue:(e.contatos[e.compra.idContatoVendedor]||{}).apelido,"onUpdate:modelValue":a[1]||(a[1]=n=>(e.contatos[e.compra.idContatoVendedor]||{}).apelido=n),disable:e.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(u,{modelValue:(e.contatos[e.compra.idEmpresa]||{}).apelido,"onUpdate:modelValue":a[2]||(a[2]=n=>(e.contatos[e.compra.idEmpresa]||{}).apelido=n),after:[{icon:"edit",handler(){i.abrirModalEmpresa()}}],disable:e.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(u,{modelValue:(e.contatos[e.compra.idContatoComprador]||{}).apelido,"onUpdate:modelValue":a[3]||(a[3]=n=>(e.contatos[e.compra.idContatoComprador]||{}).apelido=n),disable:e.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(u,{modelValue:(e.contatos[e.compra.idContatoTransportadora]||{}).apelido,"onUpdate:modelValue":a[4]||(a[4]=n=>(e.contatos[e.compra.idContatoTransportadora]||{}).apelido=n),disable:e.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),o(l,{col:"12 sm6"},{default:t(()=>[o(p,null,{default:t(()=>[o(l,{col:"7"},{default:t(()=>[o(lo,{modelValue:e.dataPrevistaEntrega,"onUpdate:modelValue":a[5]||(a[5]=n=>e.dataPrevistaEntrega=n),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),o(l,{col:"5"},{default:t(()=>[o(lo,{modelValue:e.horaPrevistaEntrega,"onUpdate:modelValue":a[6]||(a[6]=n=>e.horaPrevistaEntrega=n),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(l,{col:"12 sm12 md6"},{default:t(()=>[o(p,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(p,{justify:"end",items:"center"},{default:t(()=>[o(h,{cor:e.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:e.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[g(V(e.compra.status),1)]),_:1},8,["cor","escuro"]),o(v,{id:e.compra.id,numero:e.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),o(E,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:t(()=>[o(G,null,{default:t(()=>[x((I(),_(O,{link:"",separator:""},{default:t(()=>[e.alterarPrevisaoEntrega?(I(),_(z,{key:1,clickable:"",onClick:a[8]||(a[8]=n=>i.ajustarPrevisaoEntrega("salvar"))},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"local_shipping"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Salvar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1})):(I(),_(z,{key:0,disable:e.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:a[7]||(a[7]=n=>i.ajustarPrevisaoEntrega("alterar"))},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"local_shipping"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Alterar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1},8,["disable"]))]),_:1})),[[A]])]),_:1})]),_:1})]),_:1})]),_:1}),o(l,{col:"shrink"},{default:t(()=>[x(o(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${r.$filters.hora(e.compra.dataHoraEmissao)}`},{default:t(()=>[g(V(r.$filters.data(e.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[M,e.compra.dataHoraEmissao]])]),_:1}),o(l,{col:"shrink"},{default:t(()=>[x(o(f,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${r.$filters.hora(e.compra.dataHoraFinalizado)}`},{default:t(()=>[g(V(r.$filters.data(e.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[M,e.compra.dataHoraFinalizado]])]),_:1})]),_:1}),o(p,null,{default:t(()=>[o(l,null,{default:t(()=>[o(u,{modelValue:e.compra.observacao,"onUpdate:modelValue":a[9]||(a[9]=n=>e.compra.observacao=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),o(p,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[e.exibeInfNota?(I(),_(Co,{key:0,"default-opened":e.compra.notaNumero>0||e.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:t(()=>[o(y,null,{default:t(()=>[o(f,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:t(()=>[g("Nota de Entrada")]),_:1})]),_:1})]),default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(p,null,{default:t(()=>[o(l,{col:"12 sm6 md3"},{default:t(()=>[o(u,{modelValue:e.compra.notaNumero,"onUpdate:modelValue":a[10]||(a[10]=n=>e.compra.notaNumero=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm6 md3"},{default:t(()=>[o(u,{modelValue:e.compra.notaSerie,"onUpdate:modelValue":a[11]||(a[11]=n=>e.compra.notaSerie=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm6 md3"},{default:t(()=>[o(u,{modelValue:e.compra.naturezaOperacao,"onUpdate:modelValue":a[12]||(a[12]=n=>e.compra.naturezaOperacao=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12 sm6 md3"},{default:t(()=>[o(u,{modelValue:e.compra.dataCompra,"onUpdate:modelValue":a[13]||(a[13]=n=>e.compra.dataCompra=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),o(l,{col:"12"},{default:t(()=>[o(u,{modelValue:e.compra.chaveAcesso,"onUpdate:modelValue":a[14]||(a[14]=n=>e.compra.chaveAcesso=n),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):S("",!0)]),_:1}),o(p,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(f,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:t(()=>[g("Carrinhos "),o(E,{onClick:a[15]||(a[15]=n=>i.adicionarItem()),disable:e.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(I(!0),U(L,null,R(e.compraItens,(n,c)=>(I(),_(l,{col:"12",key:c},{default:t(()=>[o(O,{class:"full-width"},{default:t(()=>[o(z,{class:"q-px-none"},{default:t(()=>{var b;return[o(y,{avatar:"",class:"col-auto"},{default:t(()=>[o(C,{imagem:(e.itensImagens[n.idItem]||{}).imagem,rotulo:n.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]),_:2},1024),o(y,{class:"q-px-none"},{default:t(()=>[o(N,null,{default:t(()=>[g(V(n.descricaoItem),1)]),_:2},1024),o(N,{caption:""},{default:t(()=>{var P,k;return[g(V((k=(P=e.produtos[n.idItem])==null?void 0:P.marca)!=null?k:""),1)]}),_:2},1024)]),_:2},1024),x(o(y,{avatar:""},{default:t(()=>[o(h,{denso:""},{default:t(()=>{var P,k;return[g(V((k=(P=e.produtos[n.idItem])==null?void 0:P.referencia)!=null?k:""),1)]}),_:2},1024)]),_:2},1536),[[M,(b=e.produtos[n.idItem])==null?void 0:b.referencia]]),o(y,{avatar:""},{default:t(()=>[F("div",Uo,[F("div",Mo,[o(E,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:P=>i.editarProduto(n),disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),F("div",Bo,[o(E,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:P=>i.removerItem(n),disable:e.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),o(p,null,{default:t(()=>[o(l,{col:"4 md"},{default:t(()=>[o(u,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:n.valorItem,"onUpdate:modelValue":b=>n.valorItem=b,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",onBlur:b=>i.calcularTotaisItem(c,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),o(l,{col:"4 md"},{default:t(()=>[o(p,{items:"center"},{default:t(()=>[o(l,{col:"shrink"},{default:t(()=>[o(T,{name:"mdi-minus",color:"primary"})]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:n.descontoPercentualItem,"onUpdate:modelValue":b=>n.descontoPercentualItem=b,outlined:"",suffix:"%","somente-leitura":e.compra.status!=="Digita\xE7\xE3o",onBlur:b=>i.calcularTotaisItem(c,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(l,{col:"4 md"},{default:t(()=>[o(u,{dense:"",tipo:"decimal",modelValue:n.descontoItem,"onUpdate:modelValue":b=>n.descontoItem=b,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:b=>i.calcularTotaisItem(c,"descontoItem"),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),o(l,{col:"6 md"},{default:t(()=>[o(p,{items:"center"},{default:t(()=>[o(l,{col:"shrink",class:"hideonmobile"},{default:t(()=>[o(T,{name:"mdi-equal",color:"primary"})]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:n.subTotal,"onUpdate:modelValue":b=>n.subTotal=b,onBlur:b=>i.calcularTotaisItem(c,"subTotal"),"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(l,{col:"6 md"},{default:t(()=>[o(p,{items:"center"},{default:t(()=>[o(l,{col:"shrink"},{default:t(()=>[o(T,{name:"mdi-close",color:"primary"})]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{dense:"",max:"100",min:"0",outlined:"",modelValue:n.quantidade,"onUpdate:modelValue":b=>n.quantidade=b,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:b=>i.calcularTotaisItem(c),disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),o(l,{col:"12 md"},{default:t(()=>[o(p,{items:"center"},{default:t(()=>[o(l,{col:"shrink",class:"hideonmobile"},{default:t(()=>[o(T,{name:"mdi-equal",color:"primary"})]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":!0,modelValue:n.total,"onUpdate:modelValue":b=>n.total=b,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),o(l,{col:"12"},{default:t(()=>[o(p,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:t(()=>[o(l,{col:"3 sm2 md-shrink",text:"bold"},{default:t(()=>[g(" Calcular ")]),_:1}),o(l,{col:"9 sm10 md"},{default:t(()=>[o(X,{modelValue:e.compra.calcularTributacao,"onUpdate:modelValue":[a[16]||(a[16]=n=>e.compra.calcularTributacao=n),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),o(l,{col:"6 md-shrink"},{default:t(()=>[g(" Base ICMS ")]),_:1}),o(l,{col:"6 md",text:"right"},{default:t(()=>[o(u,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:e.compra.valorBaseIcms,"onUpdate:modelValue":a[17]||(a[17]=n=>e.compra.valorBaseIcms=n),somenteLeitura:e.compra.calcularTributacao||e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),o(l,{col:"6 md-shrink"},{default:t(()=>[g(" Valor ICMS ")]),_:1}),o(l,{col:"6 md",text:"right"},{default:t(()=>[o(u,{dense:"",outlined:"",modelValue:e.compra.valorIcms,"onUpdate:modelValue":a[18]||(a[18]=n=>e.compra.valorIcms=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:e.compra.calcularTributacao||e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),o(l,{col:"6 md-shrink"},{default:t(()=>[g(" Base ICMS ST ")]),_:1}),o(l,{col:"6 md",text:"right"},{default:t(()=>[o(u,{dense:"",outlined:"",modelValue:e.compra.valorBaseIcmsSt,"onUpdate:modelValue":a[19]||(a[19]=n=>e.compra.valorBaseIcmsSt=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:e.compra.calcularTributacao||e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),o(l,{col:"6 md-shrink"},{default:t(()=>[g(" ICMS ST ")]),_:1}),o(l,{col:"6 md",text:"right"},{default:t(()=>[o(u,{dense:"",outlined:"",modelValue:e.compra.valorIcmsSt,"onUpdate:modelValue":a[20]||(a[20]=n=>e.compra.valorIcmsSt=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:e.compra.calcularTributacao||e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1})]),_:1}),o(p,{mg:"lg-t",justify:"end"},{default:t(()=>[o(l,{col:"xs12 sm8 md4"},{default:t(()=>[o(p,{items:"center"},{default:t(()=>[o(l,{col:"3",text:"bold"},{default:t(()=>[g(" Subtotal ")]),_:1}),o(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(r.$filters.numero(e.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),o(ro,{class:"q-mb-md q-mt-xs"}),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs3"},{default:t(()=>[g(" Desconto ")]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{tipo:"decimal",decimals:"2",modelValue:e.compra.totalPercentualDesconto,"onUpdate:modelValue":a[21]||(a[21]=n=>e.compra.totalPercentualDesconto=n),onBlur:a[22]||(a[22]=n=>i.calcularTotais("totalPercentualDesconto")),suffix:"%",error:e.erroDesconto,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{tipo:"decimal",decimals:"2",modelValue:e.compra.totalDesconto,"onUpdate:modelValue":a[23]||(a[23]=n=>e.compra.totalDesconto=n),onBlur:a[24]||(a[24]=n=>i.calcularTotais("totalDesconto")),error:e.erroDesconto,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs3"},{default:t(()=>[g(" Frete ")]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(co,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:e.compra.tipoFrete,"onUpdate:modelValue":[a[25]||(a[25]=n=>e.compra.tipoFrete=n),i.calcularTotais],dense:"",disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),o(co,{label:"FOB",val:"FOB",modelValue:e.compra.tipoFrete,"onUpdate:modelValue":[a[26]||(a[26]=n=>e.compra.tipoFrete=n),i.calcularTotais],dense:"",disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{tipo:"decimal",decimals:"2",modelValue:e.compra.valorFrete,"onUpdate:modelValue":a[27]||(a[27]=n=>e.compra.valorFrete=n),onBlur:i.calcularTotais,error:e.erroFrete,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs3"},{default:t(()=>[g(" Seguro ")]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{tipo:"decimal",decimals:"2",modelValue:e.compra.valorSeguro,"onUpdate:modelValue":a[28]||(a[28]=n=>e.compra.valorSeguro=n),onBlur:i.calcularTotais,error:e.erroSeguro,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs5"},{default:t(()=>[g(" Outras despesas ")]),_:1}),o(l,{col:"xs"},{default:t(()=>[o(u,{tipo:"decimal",decimals:"2",modelValue:e.compra.valorOutrasDespesas,"onUpdate:modelValue":a[29]||(a[29]=n=>e.compra.valorOutrasDespesas=n),onBlur:i.calcularTotais,error:e.erroOutrasDespesas,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),o(ro,{class:"q-mt-md q-mb-xs"}),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs4",text:"bold"},{default:t(()=>[g(" Total ")]),_:1}),o(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(r.$filters.numero(e.compra.totalProduto,2)),1)]),_:1})]),_:1}),e.compra.totalComImposto?(I(),_(p,{key:0,items:"center"},{default:t(()=>[o(l,{col:"xs4",text:"bold"},{default:t(()=>[g(" Total IPI ")]),_:1}),o(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(r.$filters.numero(e.compra.valorIpi,2)),1)]),_:1})]),_:1})):S("",!0),o(p,{items:"center"},{default:t(()=>[o(l,{col:"xs5",text:"bold"},{default:t(()=>[g(" Total c/ Impostos ")]),_:1}),o(l,{col:"xs-shrink"},{default:t(()=>[o(X,{disable:e.compra.status!=="Digita\xE7\xE3o",modelValue:e.compra.totalComImposto,"onUpdate:modelValue":[a[30]||(a[30]=n=>e.compra.totalComImposto=n),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),o(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(r.$filters.numero(e.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(p,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[g("Faturar")]),_:1})]),_:1}),o(l,{col:"12"},{default:t(()=>[o(u,{modelValue:e.compra.observacaoFaturamento,"onUpdate:modelValue":a[31]||(a[31]=n=>e.compra.observacaoFaturamento=n),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),o(l,{col:"12"},{default:t(()=>[o(Vo,{ref:"formAdicionarPagamento"},{default:t(()=>[o(p,{mg:"md-y",items:"center"},{default:t(()=>[o(l,{col:"12 sm6 md"},{default:t(()=>[o(u,{modelValue:e.compra.formaDePagamento,"onUpdate:modelValue":a[32]||(a[32]=n=>e.compra.formaDePagamento=n),rules:e.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento",tipo:"text"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),o(l,{col:"12 sm6 md"},{default:t(()=>[o(u,{modelValue:e.compra.condicaoPagamento,"onUpdate:modelValue":a[33]||(a[33]=n=>e.compra.condicaoPagamento=n),rules:e.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),o(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[g(" Frete Separado "),o(X,{modelValue:e.compra.freteSeparado,"onUpdate:modelValue":[a[34]||(a[34]=n=>e.compra.freteSeparado=n),i.calcularTotais],disable:e.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),o(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[g(" N\xE3o gerar financeiro "),o(X,{modelValue:e.compra.naoGerarFinanceiro,"onUpdate:modelValue":[a[35]||(a[35]=n=>e.compra.naoGerarFinanceiro=n),i.calcularTotais],disable:e.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),o(l,{col:"12 sm4 md",text:"center"},{default:t(()=>[o(E,{onClick:i.gerarCondicoesDePagamento_click,disable:e.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),o(l,{col:"12"},{default:t(()=>[x(o(f,{text:"sub1 medium"},{default:t(()=>[g("Condi\xE7\xF5es de pagamento")]),_:1},512),[[M,e.compraCondicoesDePagamento.length>0]]),(I(!0),U(L,null,R(e.compraCondicoesDePagamento,n=>(I(),_(O,{highlight:"",class:"q-pa-none",key:n.id},{default:t(()=>[o(p,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:t(()=>[o(l,{col:"xs6 md-shrink"},{default:t(()=>[o(u,{modelValue:n.dataVencimento,"onUpdate:modelValue":c=>n.dataVencimento=c,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),o(l,{col:"xs6 md2"},{default:t(()=>[o(u,{modelValue:n.valor,"onUpdate:modelValue":c=>n.valor=c,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),o(l,{col:"xs-grow"},{default:t(()=>[o(u,{modelValue:n.observacao,"onUpdate:modelValue":c=>n.observacao=c,"somente-leitura":e.compra.status!=="Digita\xE7\xE3o"||n.observacao==="Valor Frete + Seguro",tipo:"text",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),o(l,{col:"xs-shrink",text:"right"},{default:t(()=>[o(E,{onClick:c=>i.removerPagamento_click(n),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:e.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e.valorTotalPagamento>0?(I(),_(p,{key:0,mg:"sm-t"},{default:t(()=>[o(l,{col:"xs-shrink",text:"bold"},{default:t(()=>[g(" Valor total: "+V(r.$filters.numero(e.valorTotalPagamento,2)),1)]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}),r.$db.usuario.desenvolvedor()?(I(),_(p,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:t(()=>[o(l,{col:"12"},{default:t(()=>[o(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[g("Contabilidade (apenas desenvolvedor)")]),_:1})]),_:1}),o(l,{col:"12"},{default:t(()=>[x(o(f,{text:"sub1 medium"},{default:t(()=>[g("Titulos")]),_:1},512),[[M,e.compraTitulos.length]]),o(O,{highlight:"",class:"q-pa-none"},{default:t(()=>[(I(!0),U(L,null,R(e.compraTitulos,n=>(I(),_(p,{key:n.id,gutter:"sm",mg:"sm-y",items:"center"},{default:t(()=>[o(l,{col:"xs6 md-shrink"},{default:t(()=>[o(u,{modelValue:n.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),o(l,{col:"xs6 md-shrink"},{default:t(()=>[o(u,{modelValue:n.dataPagamento,"somente-leitura":"",rotulo:"Data pagamento",tipo:n.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),o(l,{col:"xs6 md2"},{default:t(()=>[o(u,{modelValue:n.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),o(l,{col:"xs-grow"},{default:t(()=>[o(u,{modelValue:n.observacao,"somente-leitura":"",tipo:"text",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),o(l,{col:"12"},{default:t(()=>[x(o(f,{text:"sub1 medium"},{default:t(()=>[g("Movimenta\xE7\xF4es")]),_:1},512),[[M,e.compraMovimentacoes.length]]),o(O,{highlight:"",class:"q-pa-none"},{default:t(()=>[(I(!0),U(L,null,R(e.compraMovimentacoes,n=>(I(),_(p,{key:n.id,gutter:"sm",mg:"sm-y",items:"center"},{default:t(()=>[o(l,{col:"xs-grow"},{default:t(()=>[o(u,{modelValue:n.descricao,"somente-leitura":"",tipo:"text",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),n.valorCredito?(I(),_(l,{key:0,col:"xs6 md2"},{default:t(()=>[o(u,{modelValue:n.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):S("",!0),n.valorDebito?(I(),_(l,{key:1,col:"xs6 md2"},{default:t(()=>[o(u,{modelValue:n.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):S("",!0),o(l,{col:"xs6 md-shrink"},{default:t(()=>[o(u,{modelValue:n.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),o(l,{col:"xs-grow"},{default:t(()=>[o(u,{modelValue:n.observacao,"somente-leitura":"",tipo:"text",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}),o(io,{class:"bg-light border-top"},{default:t(()=>[o(Q,{class:"bg-light text-tertiary q-px-md u-container"},{default:t(()=>[o(W,{class:"text-subtitle2"},{default:t(()=>[g(" Valor Total: "+V(r.$filters.numero(e.compra.totalDocumento,2))+" ",1),Oo,g(" SKU: "+V(i.skus),1)]),_:1}),o(po),x(o(E,{onClick:i.excluir_click,type:"submit",class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir"},null,8,["onClick"]),[[M,e.compra.status==="Digita\xE7\xE3o"]]),x(o(E,{onClick:i.finalizar_click,type:"submit",class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar"},null,8,["onClick"]),[[M,e.compra.status==="Digita\xE7\xE3o"]]),x(o(E,{onClick:i.reabrir_click,color:"tertiary",flat:"",label:"Reabrir",type:"submit",class:"q-ml-sm"},null,8,["onClick"]),[[M,e.compra.status==="Finalizado"]]),x(o(E,{unelevated:"",onClick:i.transformarEmNotaCompra_click,class:"q-ml-sm",color:"primary",label:"Transformar em Nota de Compra",type:"submit"},null,8,["onClick"]),[[M,e.compra.status==="Finalizado"&&e.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),o(m,{ref:"ModalEditarProdutoCompras",onSalvar:i.fecharEdicaoProduto},null,8,["onSalvar"]),o(D,{modelValue:e.adicionar.modal.value,"onUpdate:modelValue":a[37]||(a[37]=n=>e.adicionar.modal.value=n),filtro:{ativo:!0,idEmpresa:e.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:i.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Lo=J(zo,[["render",Ao]]);const Ho={components:{PromptItemV2:fo},data(){return{mostrarItemModal:!1,idxItem:0,compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!1,totalComImposto:!1,naoGerarFinanceiro:!1,freteSeparado:!1},compraItens:[],produtos:[],visivel:!1,somenteLeitura:!1,buttonLoading:[]}},emits:["atualizar"],methods:{editarProduto(r,a,d){r.referencia=this.produtos[r.idItem].referencia,this.$refs.ModalEditarProdutoCompras.mostrar(r,a,d)},async atualizar(r,a){try{this.$q.loading.show(),this.compraItens=a;for(const d in this.compraItens)this.buttonLoading[d]=!1;this.visivel=!0,$q.notify({type:"info",message:"Existe produtos da nota de entrada n\xE3o cadastrados no sistema."})}catch(d){console.log(d.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.compraOriginal,this.compra)},async mostrar(r,a){this.visivel=!0,r.id&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:r.id}),this.compra=$utils.clonarV2(this.compraOriginal)),await this.atualizar(r,a)},async fechar(){$q.dialog({title:"Voltar?",message:`Ainda existe <b>${this.compraItens.length}</b> produto(s) n\xE3o cadastrado(s).<br><br>
            Ao <b>Confirmar</b> para voltar, ser\xE1 necess\xE1rio incluir o XML novamente e cadastrar os itens que faltam.
          `,html:!0,cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Confirmar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async r=>{this.visivel=!1;try{$q.loading.show(),await $db.compra.remove(this.compra)}catch(a){console.error("Ocorreu um erro ao excluir a compra: ",a)}finally{$q.loading.hide(),this.$emit("atualizar")}}).onCancel(()=>{})},async selecionarItens(r){this.compraItens[this.idxItem].idItem=Object.keys(r)[0],this.compraItens[this.idxItem].itemAssociadoDescricao=r[Object.keys(r)[0]].item.descricao,this.compraItens[this.idxItem].itemCompra.idItem=Object.keys(r)[0];try{const a={id:$utils.uuid(),idItem:this.compraItens[this.idxItem].itemCompra.idItem,idContato:this.compra.idContato,referencia:this.compraItens[this.idxItem].referencia,descricao:this.compraItens[this.idxItem].descricaoItem};await $db.hibrido.grava("itemFornecedor",{original:{},atual:a}),await $db.hibrido.grava("documentoItem",{original:{},atual:this.compraItens[this.idxItem].itemCompra}),this.compraItens.splice(this.idxItem,1)}catch(a){console.log(a.error)}this.mostrarItemModal=!1},async recalcularItem(r){var f;let a=(f=this.compraItens[r].valorPreCusto)!=null?f:0,d=0,s=0,e=0,i=0;this.compraItens[r].ipi>0&&(d=$utils.arredondar(a*(this.compraItens[r].ipi/100),2)),this.compraItens[r].st>0&&(s=$utils.arredondar(a*(this.compraItens[r].st/100),2)),this.compraItens[r].difal>0&&(e=$utils.arredondar(a*(this.compraItens[r].difal/100),2)),this.compraItens[r].valorCustoReposicao=$utils.arredondar(a+d+s+e,2),this.compraItens[r].margemLucro>0&&(i=$utils.arredondar(this.compraItens[r].valorCustoReposicao*(this.compraItens[r].margemLucro/100),2)),this.compraItens[r].percentualMarkup=$utils.arredondar(this.compraItens[r].margemLucro,2),this.compraItens[r].valorVenda=$utils.arredondar(this.compraItens[r].valorCustoReposicao+i,2)},async addNovoItem(r,a){this.buttonLoading[a]=!0;const d={id:$utils.uuid(),descricao:r.descricaoItem,descricaoConcatenada:r.descricaoItem,referencia:r.referencia,marca:(r==null?void 0:r.marca)||null,codigoBarras:r.itemCompra.codigoBarrasItem,ncm:r.itemCompra.ncm,tipo:r.itemCompra.tipoItem,codigoNcm:r.itemCompra.codigoNcm,unidade:r.unidade,valorCustoReposicao:r.valorCustoReposicao,valorVenda:(r==null?void 0:r.valorVenda)||0,percentualMarkup:(r==null?void 0:r.percentualMarkup)||0,codigoOrigem:parseInt(r.codigoOrigem),unidade:r.unidade},s={id:$utils.uuid(),idItem:d.id,idContato:this.compra.idContato,referencia:r.referencia,descricao:r.descricaoItem};try{await $db.hibrido.grava("item",{original:{},atual:d}),await $db.hibrido.grava("itemFornecedor",{original:{},atual:s}),r.itemCompra.idItem=d.id,r.itemCompra.dataHoraEmissao=new Date(r.itemCompra.dataHoraEmissao).toISOString(),await $db.hibrido.grava("documentoItem",{original:{},atual:r.itemCompra}),this.compraItens.splice(a,1),$q.notifyPositive(`Item criado com sucesso: ${d.descricao}`)}catch(e){console.log(e.message),$q.notifyError(`Erro ao cadastrar novo produto: ${e.message}`)}this.buttonLoading[a]=!1},async finalizar_click(){console.log(this.compraItens.length),this.compraItens.length>0?$q.notifyError("Antes de continuar verifique todos os itens!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$router.replace({params:{id:this.compra.id}}),this.$refs.fichaCompra.mostrar({id:this.compra.id}))},async addNovoItemAutomatico(r,a){r.id&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:r.id}),this.compra=$utils.clonarV2(this.compraOriginal)),this.compraItens=a;for(const d in this.compraItens)this.buttonLoading[d]=!1;for(let d=0;d<this.compraItens.length;d++)await this.addNovoItem(this.compraItens[d],d)}}},jo={class:"layout-padding q-pa-none q-pb-md"},Ro=["id"],Xo={class:"col-12"},Qo={class:"col-4 col-md"},Go={class:"col-4 col-md"},Wo={class:"col-4 col-md"},Zo={class:"col-6 col-md"},Jo={class:"col-12 col-md"},Ko={class:"col-6 col-md"},Yo={class:"col-12 col-md"},$o={class:"col-12"},oe={class:"col-12 col-md-4"},ee=F("div",{class:"col-12 col-md-auto"},"ou",-1),ae={class:"col-12 col-md-auto q-pl-none"},te={class:"u-container relative-position"};function le(r,a,d,s,e,i){const f=w("ajuda"),l=w("campo"),h=w("row"),v=w("PromptItemV2");return I(),U(L,null,[o(eo,{modelValue:e.visivel,"onUpdate:modelValue":a[0]||(a[0]=p=>e.visivel=p),persistent:"",maximized:"",onKeyup:ho(i.fechar,["esc"])},{default:t(()=>[o(K,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:t(()=>[o(Y,null,{default:t(()=>[o(Q,null,{default:t(()=>[o(E,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:i.fechar},null,8,["onClick"]),o(W,null,{default:t(()=>[g("Importar XML x Cadastro")]),_:1}),o(f)]),_:1})]),_:1}),o($,null,{default:t(()=>[o(oo,null,{default:t(()=>[F("div",jo,[o(_o,{style:{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%"},items:e.compraItens,separator:""},{default:t(({item:p,index:C})=>[F("div",{class:"items-carrinho items-center row q-pa-md bg-white rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"},id:C},[o(O,{class:"full-width"},{default:t(()=>[o(z,{class:"q-px-none"},{default:t(()=>[o(y,{class:"q-px-none"},{default:t(()=>[o(N,null,{default:t(()=>[o(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Descri\xE7\xE3o Item",modelValue:p.descricaoItem,"onUpdate:modelValue":u=>p.descricaoItem=u},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[o(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Marca",modelValue:p.marca,"onUpdate:modelValue":u=>p.marca=u},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[o(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Referencia",modelValue:p.referencia,"onUpdate:modelValue":u=>p.referencia=u},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),F("div",Xo,[o(h,{class:"q-col-gutter-sm"},{default:t(()=>[F("div",Qo,[o(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor pr\xE9 custo",modelValue:p.valorPreCusto,"onUpdate:modelValue":u=>p.valorPreCusto=u},null,8,["modelValue","onUpdate:modelValue"])]),F("div",Go,[o(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"IPI",modelValue:p.ipi,"onUpdate:modelValue":u=>p.ipi=u,outlined:"",suffix:"%",onBlur:u=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),F("div",Wo,[o(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"ST",modelValue:p.st,"onUpdate:modelValue":u=>p.st=u,outlined:"",suffix:"%",onBlur:u=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),F("div",Zo,[o(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"DIFAL",modelValue:p.difal,"onUpdate:modelValue":u=>p.difal=u,outlined:"",suffix:"%",onBlur:u=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),F("div",Jo,[o(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Custo de reposi\xE7\xE3o",modelValue:p.valorCustoReposicao,"onUpdate:modelValue":u=>p.valorCustoReposicao=u},null,8,["modelValue","onUpdate:modelValue"])]),F("div",Ko,[o(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"Margem de Lucro",modelValue:p.margemLucro,"onUpdate:modelValue":u=>p.margemLucro=u,outlined:"",suffix:"%",onBlur:u=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),F("div",Yo,[o(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor de Venda",modelValue:p.valorVenda,"onUpdate:modelValue":u=>p.valorVenda=u},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),F("div",$o,[o(h,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:t(()=>[F("div",oe,[o(lo,{debounce:500,modelValue:p.itemAssociadoDescricao,"onUpdate:modelValue":u=>p.itemAssociadoDescricao=u,placeholder:"Vincular produto",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close",class:"items-center"},{append:t(()=>[o(T,{name:"search",onClick:()=>{e.mostrarItemModal=!e.mostrarItemModal,e.idxItem=C},class:"cursor-pointer text-tertiary"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),ee,F("div",ae,[o(E,{loading:e.buttonLoading[C],class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",type:"submit",onClick:u=>i.addNovoItem(p,C)},null,8,["loading","onClick"])])]),_:2},1024)])],8,Ro)]),_:1},8,["items"])])]),_:1})]),_:1}),o(io,{class:"bg-light no-shadow q-pa-sm text-right u-bordaCima"},{default:t(()=>[F("div",te,[o(E,{class:"q-ml-sm no-shadow",color:"primary",icon:"send",unelevated:"",label:"Continuar",type:"submit",onClick:i.finalizar_click},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),o(v,{modelValue:e.mostrarItemModal,"onUpdate:modelValue":a[1]||(a[1]=p=>e.mostrarItemModal=p),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:e.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:i.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var re=J(Ho,[["render",le]]);const Z={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""}}},ie={components:{Lista:wo,ComprasFicha:Lo,ComprasImportacaoXML:re},data(){return{lista:[],mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},resultado:{},busca:"",filtros:$utils.clonarV2(Z.filtros),tabSelecionada:{valor:"Digita\xE7\xE3o"},tabs:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],tabSelecionada2:{valor:"Pedido de Compra"},tabs2:[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"}],paginacao:$utils.clonarV2(Z.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},methods:{async atualizar(r){var d;const a=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{let{buscarDadosRecentes:s}=r!=null?r:{},e,i,f,l,h,v=["dataFinalizacao","dataHoraEmissao"],p=["desc","desc"];if(this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(Z.filtros),this.paginacao=$utils.clonarV2(Z.paginacao),this.busca="",s=!0),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,s&&(e=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),e!=null&&e._id&&(this.filtros=e.filtros,this.busca=e.termoBusca,this.paginacao.limite=e.limit,this.paginacao.atual=e.page,v=e.sort,p=e.dir)),r!=null&&r.aba&&(this.tabSelecionada.valor=r.aba),i=$utils.eliminarVazios(this.filtros),f=this.busca,l=this.paginacao.limite,h=this.paginacao.atual,i.status=this.tabSelecionada.valor,i.operacao=this.tabSelecionada2.valor,this.tabSelecionada.valor==="Todos"&&delete i.status,i.operacao==="Nota no SEFAZ"){let C=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe",situacao:i.status}});const u=[];C.forEach(D=>{const n={id:D.id,descricaoContato:D.xNomeEmitente,dataHoraEmissao:D.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:D.vNF,qtdeContatos:null,status:D.situacao};u.push(n)});let m=(h-1)*l;this.paginacao.total=u.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/l)||1,this.lista=u.splice(m,l),this.configuraImpressao(this.filtros.idEmpresa)}if(i.operacao!=="Nota no SEFAZ"){let C=await $db.compra.le({filtros:i,termoBusca:f,limit:l,page:h,sort:v,dir:p});this.paginacao.total=C.total,this.paginacao.maximo=C.totalPages,this.lista=C.data}for(let C in this.lista)this.lista.hasOwnProperty(C)&&(this.lista[C].contato=await $db.contato.le({id:this.lista[C].idContato}));e={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(i),termoBusca:this.busca,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataFinalizacao","dataHoraEmissao"],dir:["desc","desc"]},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:e}),this.configuraImpressao(this.filtros.idEmpresa)}),$utils.logarFim(a,((d=this.paginacao)==null?void 0:d.total)||1)},adicionarXml(r){this.xmlNotaEntrada.arquivo=r[0]},async dialogProtocoloSefaz(){return new Promise(r=>{$q.dialog({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},persistent:!0}).onOk(()=>{r(!0)}).onCancel(()=>{r(!1)})})},async importarXmlNotaDeEntrada(r){if(!this.xmlNotaEntrada.arquivo)return this.$q.notify({type:"warning",message:"Adicione um arquivo XML antes de enviar!"});try{$q.loading.show();const d=await(u=>new Promise((m,D)=>{const n=new FileReader;n.readAsBinaryString(u),n.onload=()=>m(n.result),n.onerror=c=>D(c)}))(this.xmlNotaEntrada.arquivo),s=new DOMParser,e=new XMLSerializer,i=s.parseFromString(d,"text/xml"),f=e.serializeToString(i),l=this;if(i.documentElement.nodeName==="html")throw new Error("Arquivo inv\xE1lido ou corrompido");const h=new yo.Parser;let v;h.parseString(f,(u,m)=>{u&&console.log(u),v=m});let p=null,C=!0;v&&v.nfeProc&&v.nfeProc.protNFe?p=v.nfeProc.protNFe[0].infProt[0].nProt[0]:p||(C=await this.dialogProtocoloSefaz()),C?(await $db.compra.importaXml({xmlString:f,tela:l,xmlEstrangeiro:!!this.xmlEstrangeiro}),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso!"})):this.$q.notify({type:"warning",message:"Opera\xE7\xE3o para importa\xE7\xE3o de XML cancelada!"})}catch(a){this.$q.notifyError(a.message),console.error(a)}finally{delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1,await this.atualizar(),$q.loading.hide()}},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(r){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&this.$refs.comprasFicha.mostrar({id:r})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},limparFiltrosClick(){this.filtros.numero="",this.filtros.termoBusca="",this.filtros.numeroCompra="",this.filtros.periodoEmissao.ini="",this.filtros.periodoEmissao.fim="",this.filtros.periodoFinalizado.ini="",this.filtros.periodoFinalizado.fim="",this.filtros.fornecedor.id=null,this.filtros.fornecedor.nome="",this.atualizar()},async consultarSefazClick(){try{let r,a,d,s,e,i,f,l;if(a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(a.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(r=a[0],a.length>1){const P={ativo:!0,empresas:!0};if(r=await $g.promptContato.show({filtro:P,placeholder:"Selecione a empresa"}),!r){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(d=(await $erp().empresa.where({idContato:r.id}).toArray())[0],!d){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}d&&(s=await $db.contatoEndereco.leEnderecoPrincipal(r.id),e=await $db.configuracoes.leValorComFiltroEmpresa("compras.sefaz.nsu",d.id),e||(e="0"));const h=d.numeroDocumentoNacional.match(/\d+/g).join("");for(;e.length<15;)e=`0${e}`;const v=`<?xml version="1.0" encoding="utf-8"?><distDFeInt versao="1.01" xmlns="http://www.portalfiscal.inf.br/nfe"><tpAmb>2</tpAmb><cUFAutor>${s.ufCod}</cUFAutor><CNPJ>${h}</CNPJ><distNSU><ultNSU>${e}</ultNSU></distNSU></distDFeInt>`,p={xml:v,cnpj:h,dataHora:new Date},u={id:$utils.uuid(),tipo:"DFe",situacao:"",tpAmb:1,dhEmi:new Date,dataHoraEmissao:new Date,dataHoraCriacao:new Date,cpfCnpjEmitente:h,xNomeEmitente:d.nome,json:JSON.stringify(p)}.json,m=new Headers;m.append("Content-Type","application/json; charset=utf-8"),f=await fetch("https://api.b15.com.br/integradorjs/dfe/consultar",{method:"POST",headers:m,body:JSON.stringify({xml:v})});const D=await f.json();if(!f.ok){let P="Erro desconhecido";/GError:.+/.test(D.error)&&(P=D.error.slice(7)),$q.notifyError(P);return}if(D.cStat!=="100"){$q.notifyError(D.xMotivo);return}const n=f.dfe.retDistDFeInt,c=f.err,b=f.arquivos;if(n!==""&&Number(n==null?void 0:n.ultNSU[0])>Number(e)){const P=await $db.configuracoes.atualizaPorNome("compras.sefaz.nsu",d.id,n.ultNSU[0])}if(b){let P=0;for(let k in b)try{const q=b[k],so={id:$utils.uuid(),tipo:"DFe",situacao:"N\xE3o Importada",tpAmb:q.nfeProc.NFe[0].infNFe[0].ide[0].tpAmb[0],mod:q.nfeProc.NFe[0].infNFe[0].ide[0].mod[0],serie:q.nfeProc.NFe[0].infNFe[0].ide[0].serie[0],nNF:q.nfeProc.NFe[0].infNFe[0].ide[0].nNF[0],chNFe:q.nfeProc.protNFe[0].infProt[0].chNFe[0],vNF:q.nfeProc.NFe[0].infNFe[0].total[0].ICMSTot[0].vNF[0],dhEmi:q.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraEmissao:q.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraCriacao:null,dataHoraAlteracao:null,cpfCnpjEmitente:q.nfeProc.NFe[0].infNFe[0].emit[0].CNPJ[0],xNomeEmitente:q.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],xFantEmitente:q.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],cpfCnpjDestinatario:q.nfeProc.NFe[0].infNFe[0].dest[0].CNPJ[0],xNomeDestinatario:q.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],xFantDestinatario:q.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],json:JSON.stringify({xml:q.xml}),naturezaOperacao:q.nfeProc.NFe[0].infNFe[0].ide[0].natOp[0]};(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe"}})).some(go=>go.chNFe===so.chNFe)||(await $db.documentoFiscalEletronico.grava({atual:so,original:{}}),P++)}catch(q){console.log(q.message)}this.$q.notify(`Importa\xE7\xE3o via SEFAZ Finalizada, ${P} Notas Importadas`)}}catch(r){console.log(r.message)}},async configuraImpressao(r){const a=await $db.configuracoes.porNome("impressao.compra",r);this.configImpressao=[...a.length?a.map(d=>({texto:"Imprimir Compra",...d})):[{valor:"invoice",texto:"Compras e Estoque"}]]},setOpcoesTabs(r){r!=="Nota no SEFAZ"&&(this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabs=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]),r==="Nota no SEFAZ"&&(this.tabSelecionada.valor="N\xE3o Importada",this.tabs=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"}])},async downloadXmlDFe(r){const a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:r}),d=JSON.parse(a.json).xml;if(d){const s=document.createElement("a"),e=new Blob([d],{type:"text/plain"});s.setAttribute("href",window.URL.createObjectURL(e)),s.setAttribute("download",`${a.chNFe}.xml`),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()}d||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async importarXmlDFe(r){try{const a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:r}),d=JSON.parse(a.json).xml;if(d){const s=new DOMParser,e=new XMLSerializer,i=s.parseFromString(d,"text/xml"),f=e.serializeToString(i),l=this;await $db.compra.importaXml({xmlString:f,tela:l});const h={original:$utils.clonarV2(a),atual:$utils.clonarV2(a)};h.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(h),$q.notify("XML Importado para Compras")}}catch(a){console.log(a.message),$q.notifyError("Erro ao importar XML",a)}}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0})}},se={id:"Compras"},ne={class:"mw80 text-center"},de={class:"row q-ma-md"},me={key:0,class:"row q-ma-md"},ce={class:"certificado-error-messages"};function ue(r,a,d,s,e,i){const f=w("campo"),l=w("BadgeCopiarUid"),h=w("avatar"),v=w("badge"),p=w("g-label"),C=w("g-col"),u=w("g-row"),m=w("Lista"),D=w("ComprasFicha"),n=w("ComprasImportacaoXML");return I(),U("div",se,[o(m,{busca:e.busca,"onUpdate:busca":a[9]||(a[9]=c=>e.busca=c),onAtualizar:i.atualizar,onLimparFiltrosClick:i.limparFiltrosClick,onCriarClick:i.criarClick,onConsultarSefazClick:i.consultarSefazClick,lista:e.lista,tabSelecionada:e.tabSelecionada,tabs:e.tabs,tabSelecionada2:e.tabSelecionada2,tabs2:e.tabs2,paginacao:e.paginacao,mostrar:e.mostrar},{botaoNovo:t(()=>[o(E,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:t(()=>[o(G,null,{default:t(()=>[o(O,{link:"","no-border":"",separator:""},{default:t(()=>[x((I(),_(z,{onClick:i.criarClick,clickable:""},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"add"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]]),x((I(),_(z,{onClick:i.importarXmlClick,clickable:""},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"add"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]])]),_:1})]),_:1})]),_:1}),o(E,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:t(()=>[o(G,null,{default:t(()=>[o(O,{link:"","no-border":"",separator:""},{default:t(()=>[x((I(),_(z,{onClick:i.criarClick,clickable:""},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"add"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]]),x((I(),_(z,{onClick:i.importarXmlClick,clickable:""},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"add"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[A]])]),_:1})]),_:1})]),_:1})]),filtroCampos:t(()=>[o(f,{modelValue:e.filtros.numero,"onUpdate:modelValue":a[0]||(a[0]=c=>e.filtros.numero=c),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.termoBusca,"onUpdate:modelValue":a[1]||(a[1]=c=>e.filtros.termoBusca=c),rotulo:"Palavra Chave",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.numeroCompra,"onUpdate:modelValue":a[2]||(a[2]=c=>e.filtros.numeroCompra=c),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.fornecedor.nome,"onUpdate:modelValue":a[3]||(a[3]=c=>e.filtros.fornecedor.nome=c),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom q-mb-md"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.periodoEmissao.ini,"onUpdate:modelValue":a[4]||(a[4]=c=>e.filtros.periodoEmissao.ini=c),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-mb-x"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.periodoEmissao.fim,"onUpdate:modelValue":a[5]||(a[5]=c=>e.filtros.periodoEmissao.fim=c),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.periodoFinalizado.ini,"onUpdate:modelValue":a[6]||(a[6]=c=>e.filtros.periodoFinalizado.ini=c),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-mb-xs"},null,8,["modelValue"]),o(f,{modelValue:e.filtros.periodoFinalizado.fim,"onUpdate:modelValue":a[7]||(a[7]=c=>e.filtros.periodoFinalizado.fim=c),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),o(f,{modelValue:e.paginacao.limite,"onUpdate:modelValue":a[8]||(a[8]=c=>e.paginacao.limite=c),rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",min:"1",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:t(()=>[o(O,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:t(()=>[(I(!0),U(L,null,R(e.lista,c=>(I(),U("div",{key:c.id,class:"itemHover"},[o(z,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[o(y,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:t(()=>[F("div",ne,[o(l,{id:c.id,numero:c.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),o(y,{class:"col-md col-lg col-xl no-margin"},{default:t(()=>[o(z,{class:"q-pa-none"},{default:t(()=>[o(y,{onClick:b=>i.abrir(c.id),class:"col-auto items-center"},{default:t(()=>[o(h,{imagem:c.imagem,rotulo:c.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),o(y,{class:"col"},{default:t(()=>[o(N,{onClick:b=>i.abrir(c.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[g(V(c.descricaoContato)+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),o(z,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:t(()=>[c.notaNumero?(I(),_(v,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:t(()=>[g(V(c.notaNumero)+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),_(v,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:t(()=>[g(" S/N "),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),o(y,{class:"hideondesktop q-mt-sm"},{default:t(()=>[o(u,{mg:"xs-b"},{default:t(()=>[c.dataHoraEmissao?(I(),_(C,{key:0,col:"shrink"},{default:t(()=>[o(p,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${r.$filters.hora(c.dataHoraEmissao)}`},{default:t(()=>[g(V(r.$filters.data(c.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):S("",!0),c.dataHoraFinalizado?(I(),_(C,{key:1,col:"shrink",class:"q-ml-sm"},{default:t(()=>[o(p,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${r.$filters.hora(c.dataHoraFinalizado)}`},{default:t(()=>[g(V(r.$filters.data(c.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):S("",!0)]),_:2},1024),o(u,{mg:"xs-b"},{default:t(()=>[c.numero?(I(),_(C,{key:0,col:"shrink"},{default:t(()=>[o(v,{rotulo:`#${c.numero.toString().padStart(6,"0")}`,cor:"positive",escuro:""},null,8,["rotulo"])]),_:2},1024)):(I(),_(C,{key:1,col:"shrink"},{default:t(()=>[o(l,{id:c.id,numero:c.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])]),_:2},1024)),o(C,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[c.notaNumero?(I(),_(v,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:t(()=>[g(V(c.notaNumero)+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),_(v,{key:1,cor:"warning",class:"mw50",escuro:""},{default:t(()=>[g(" S/N "),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),o(C,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[o(v,{rotulo:c.status,cor:c.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:c.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),o(u,null,{default:t(()=>[o(C,{col:"shrink",text:"bold"},{default:t(()=>[g(V(r.$filters.numero(c.totalDocumento,2)),1)]),_:2},1024),x(o(C,{col:"grow",text:"center",class:"q-ml-sm"},{default:t(()=>[g(V(c.qtdeContatos)+" Itens ",1)]),_:2},1536),[[M,c.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(y,{onClick:b=>i.abrir(c.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[c.dataHoraEmissao?(I(),_(N,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[o(T,{name:"mdi-calendar-today"}),g(" "+V(r.$filters.data(c.dataHoraEmissao))+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Emitido \xE1s "+V(r.$filters.hora(c.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):S("",!0),c.dataHoraFinalizado?(I(),_(N,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[o(T,{name:"mdi-calendar"}),g(" "+V(r.$filters.data(c.dataHoraFinalizado))+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Finalizado \xE1s "+V(r.$filters.hora(c.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):S("",!0)]),_:2},1032,["onClick"]),o(y,{onClick:b=>i.abrir(c.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:t(()=>[o(v,{cor:c.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:c.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:t(()=>[g(V(c.status)+" ",1),o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Status ")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),o(y,{onClick:b=>i.abrir(c.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>[o(N,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[g(V(r.$filters.numero(c.totalDocumento,2)),1)]),_:2},1024),x(o(N,{class:"text-tertiary text-right"},{default:t(()=>[g(V(c.qtdeContatos)+" Itens ",1)]),_:2},1536),[[M,c.qtdeContatos>0]])]),_:2},1032,["onClick"]),o(y,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:t(()=>[o(z,{class:"q-pa-none"},{default:t(()=>[e.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),_(y,{key:0,class:"q-pr-sm no-margin"},{default:t(()=>[o(E,{onClick:b=>i.abrir(c.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):S("",!0),e.tabSelecionada2.valor==="Nota no SEFAZ"&&e.tabSelecionada.valor==="N\xE3o Importada"?(I(),_(y,{key:1,class:"q-pr-sm no-margin"},{default:t(()=>[o(E,{onClick:b=>i.importarXmlDFe(c.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:t(()=>[o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),e.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),_(y,{key:2,class:"q-pr-sm no-margin"},{default:t(()=>[o(E,{onClick:b=>i.downloadXmlDFe(c.id),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:t(()=>[o(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Exportar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),o(y,{class:"no-margin"},{default:t(()=>[o(E,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[o(G,null,{default:t(()=>[x((I(),_(O,{link:"","no-border":"",separator:""},{default:t(()=>[(I(!0),U(L,null,R(e.configImpressao.filter(b=>b.valor),b=>(I(),_(z,{key:b.valor,onClick:P=>r.$imprimir(b.valor,(c==null?void 0:c.id)||"0"),clickable:""},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"print"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g(V(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(y,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:t(()=>[o(E,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[o(G,null,{default:t(()=>[x((I(),_(O,{link:"","no-border":"",separator:""},{default:t(()=>[e.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),_(z,{key:0,onClick:b=>i.abrir(c.id),clickable:"",class:"itemHover"},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"edit"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),e.tabSelecionada2.valor==="Nota no SEFAZ"&&e.tabSelecionada.valor==="N\xE3o Importada"?(I(),_(z,{key:1,onClick:b=>i.importarXmlDFe(c.id),clickable:"",class:"itemHover"},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"mdi-upload"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),e.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),_(z,{key:2,onClick:b=>i.downloadXmlDFe(c.id),clickable:"",class:"itemHover"},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"mdi-download"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g(" Exportar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),(I(!0),U(L,null,R(e.configImpressao.filter(b=>b.valor),b=>(I(),_(z,{key:b.valor,onClick:P=>r.$imprimir(b.valor,(c==null?void 0:c.id)||"0"),clickable:"",class:"itemHover"},{default:t(()=>[o(y,{avatar:""},{default:t(()=>[o(T,{name:"print"})]),_:1}),o(y,null,{default:t(()=>[o(N,null,{default:t(()=>[g(V(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[A]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),o(ro)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","onConsultarSefazClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),o(D,{ref:"comprasFicha",onAtualizar:i.atualizar},null,8,["onAtualizar"]),o(n,{ref:"comprasImportacaoXML",onAtualizar:i.atualizar},null,8,["onAtualizar"]),o(eo,{modelValue:e.modalXMLNotaEntrada,"onUpdate:modelValue":a[13]||(a[13]=c=>e.modalXMLNotaEntrada=c),persistent:""},{default:t(()=>[o(K,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:t(()=>[F("form",{onSubmit:a[12]||(a[12]=Do((...c)=>i.importarXmlNotaDeEntrada&&i.importarXmlNotaDeEntrada(...c),["prevent"]))},[o(Y,null,{default:t(()=>[o(Q,null,{default:t(()=>[x(o(E,{onClick:i.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[A]]),o(W,null,{default:t(()=>[g("Importar XML Nota de Entrada")]),_:1}),o(E,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),o($,{class:"u-container"},{default:t(()=>[o(oo,{style:{"min-height":"300px"}},{default:t(()=>{var c,b,P;return[F("div",de,[o(Po,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:i.adicionarXml,filter:k=>k.filter(q=>q.type==="text/xml")},null,8,["factory","filter"]),o(uo,{modelValue:e.xmlDevolucao,"onUpdate:modelValue":a[10]||(a[10]=k=>e.xmlDevolucao=k),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),o(uo,{modelValue:e.xmlEstrangeiro,"onUpdate:modelValue":a[11]||(a[11]=k=>e.xmlEstrangeiro=k),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((P=(b=(c=e.xmlNotaEntrada.error)==null?void 0:c.data)==null?void 0:b.fields)!=null?P:{}).length?(I(),U("div",me,[F("ul",ce,[(I(!0),U(L,null,R(Object.keys(e.xmlNotaEntrada.error.data.fields),k=>(I(),U("li",{key:k},[F("span",null,V(k),1),F("span",null,V(e.xmlNotaEntrada.error.data.fields[k]),1)]))),128))])])):S("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var Ie=J(ie,[["render",ue]]);export{Ie as default};
