import{_ as q,Y as A,r as k,o as i,d as u,w as e,f as l,M as D,G as C,h as M,i as S,k as p,H as N,Q as T,N as E,I as V,J as B,C as b,P as F,p as x,F as v,x as w,l as I,e as f,S as L,T as Q,U as _,t as m,j as H,D as P}from"./index.4d366331.js";const z={components:{Avatar:A},computed:{dadosEncontrados(){return(this.dados.status||[]).length},observacaoEstruturada(){return c=>{var o;const t=((o=c.observacao)==null?void 0:o.trim())||"";if(!t.startsWith("Altera\xE7\xE3o manual realizada por:"))return{isManual:!1};const h=t.split(/;\s*|\n+/).map(s=>s.trim()).filter(Boolean),y=h[0].replace("Altera\xE7\xE3o manual realizada por:","").trim(),r=[];for(const s of h.slice(1)){const n=s.match(/^(.*?):\s*(.*?)\s*>\s*(.*)$/);n?r.push({label:n[1],de:n[2],para:n[3]}):r.push({texto:s})}return{isManual:!0,nome:y,detalhes:r}}}},data(){return{dados:{status:[],contatos:{}},visivel:!1}},methods:{isAlteracaoManual(c){var t;return(t=c.observacao)==null?void 0:t.trim().startsWith("Altera\xE7\xE3o manual realizada por:")},async exibirHistorico(c){var h,y,r;let t;try{t=setTimeout(()=>{$q.loading.show({message:"Carregando informa\xE7\xF5es...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})},500);const o=await $db.documentoStatus.leHistoricoOnline(c);for(const s of o){const n=[];let a,g,d;!(s.cpfUsuario||((h=s.cpfUsuario)==null?void 0:h.replace(/\D/g,"")))||this.dados.contatos[s.cpfUsuario]||this.dados.contatos[(y=s.cpfUsuario)==null?void 0:y.replace(/\D/g,"")]||(a=s.cpfUsuario,g=await $erp().contato.where({numeroDocumentoNacional:$utils.formatarCPF(a)}).toArray(),Array.prototype.push.apply(n,g),a=(r=s.cpfUsuario)==null?void 0:r.replace(/\D/g,""),a&&a!==s.cpfUsuario&&(g=await $erp().contato.where({numeroDocumentoNacional:a}).toArray(),Array.prototype.push.apply(n,g)),d=n[0],d&&(this.dados.contatos[s.cpfUsuario]={nome:d.nome,imagem:d.imagem}))}this.dados.status=o}catch(o){this.$q.notify({type:"negative",message:o.message})}finally{clearTimeout(t),$q.loading.hide()}},async mostrar(c){const{idDocumento:t}=c;if(await this.exibirHistorico(t),!(this.dados.status||[]).length){this.$q.notify({type:"warning",message:"N\xE3o h\xE1 hist\xF3rico dispon\xEDvel."});return}this.visivel=!0},onHide(){this.dados={status:[],contatos:{}}}}},O={class:"layout-padding",container:""},W={class:"q-mr-sm"},j={class:"q-mr-md"};function G(c,t,h,y,r,o){const s=k("avatar"),n=k("g-label");return i(),u(P,{modelValue:r.visivel,"onUpdate:modelValue":t[0]||(t[0]=a=>r.visivel=a),onHide:o.onHide},{default:e(()=>[l(D,{view:"hHh LpR fFf",container:"",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:e(()=>[l(C,null,{default:e(()=>[l(M,null,{default:e(()=>[l(S,null,{default:e(()=>t[1]||(t[1]=[p("Hist\xF3rico do Status")])),_:1}),N(l(T,{dense:"",flat:"",icon:"close",round:""},null,512),[[E]])]),_:1})]),_:1}),l(V,null,{default:e(()=>[l(B,null,{default:e(()=>[b("div",O,[o.dadosEncontrados?(i(),u(F,{key:0,"no-border":"",dense:"",class:"q-my-md"},{default:e(()=>[(i(!0),x(v,null,w(r.dados.status,(a,g)=>(i(),x(v,{key:a.codigoDocumentoStatus},[g?(i(),u(I,{key:0})):f("",!0),l(L,{class:"item-center q-my-sm"},{default:e(()=>[l(Q,{avatar:""},{default:e(()=>[l(s,{imagem:(r.dados.contatos[a.cpfUsuario]||{}).imagem,rotulo:(r.dados.contatos[a.cpfUsuario]||{}).nome,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),l(Q,null,{default:e(()=>[(r.dados.contatos[a.cpfUsuario]||{}).nome?(i(),u(_,{key:0,caption:"",class:"q-pb-xs text-weight-medium"},{default:e(()=>[p(m((r.dados.contatos[a.cpfUsuario]||{}).nome),1)]),_:2},1024)):f("",!0),o.isAlteracaoManual(a)?(i(),u(_,{key:1,caption:"",class:"q-pb-xs text-body2 text-weight-light text-dark"},{default:e(()=>[(i(!0),x(v,null,w(o.observacaoEstruturada(a).detalhes,(d,U)=>(i(),u(n,{key:U},{default:e(()=>[d.de?(i(),x(v,{key:0},[l(n,{inline:""},{default:e(()=>[p(m(d.label)+":",1)]),_:2},1024),p(" "+m(d.de)+" ",1),l(H,{name:"east",color:"primary",class:"q-mx-sm"}),p(" "+m(d.para),1)],64)):f("",!0)]),_:2},1024))),128))]),_:2},1024)):f("",!0),!o.isAlteracaoManual(a)&&a.observacao?(i(),u(_,{key:2,class:"text-body1 text-weight-regular text-black q-pb-sm"},{default:e(()=>[p(m(a.observacao),1)]),_:2},1024)):f("",!0),a.statusOriginal&&!o.isAlteracaoManual(a)?(i(),u(_,{key:3,class:"text-body2 text-weight-light text-black"},{default:e(()=>[b("span",W,m(a.statusOriginal),1),b("span",null,[l(H,{name:"east",color:"primary",class:"q-mr-sm"}),p(m(a.statusFinalizado),1)])]),_:2},1024)):f("",!0),o.isAlteracaoManual(a)?f("",!0):(i(),u(_,{key:4,class:"text-body2"},{default:e(()=>[b("span",j,m(c.$filters.data(a.dataHoraEmissao)),1),p(m(c.$filters.hora(a.dataHoraEmissao)),1)]),_:2},1024))]),_:2},1024)]),_:2},1024)],64))),128))]),_:1})):f("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])}var R=q(z,[["render",G]]);export{R as M};
