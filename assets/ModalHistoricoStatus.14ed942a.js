import{_ as q,Y as U,r as k,o as l,d as m,w as e,f as r,M as D,G as C,h as M,i as S,k as p,H as E,Q as N,N as T,I as V,J as B,C as y,P as F,p as b,F as v,x as w,l as I,e as f,S as L,T as Q,U as x,t as d,j as A,D as P}from"./index.f7e7bbce.js";const z={components:{Avatar:U},computed:{dadosEncontrados(){return(this.dados.status||[]).length},observacaoEstruturada(){return c=>{var o;const t=((o=c.observacao)==null?void 0:o.trim())||"";if(!t.startsWith("Altera\xE7\xE3o manual realizada por:"))return{isManual:!1};const h=t.split(/;\s*|\n+/).map(s=>s.trim()).filter(Boolean),_=h[0].replace("Altera\xE7\xE3o manual realizada por:","").trim(),i=[];for(const s of h.slice(1)){const n=s.match(/^(.*?):\s*(.*?)\s*>\s*(.*)$/);n?i.push({label:n[1],de:n[2],para:n[3]}):i.push({texto:s})}return{isManual:!0,nome:_,detalhes:i}}}},data(){return{dados:{status:[],contatos:{}},visivel:!1}},methods:{isAlteracaoManual(c){var t;return(t=c.observacao)==null?void 0:t.trim().startsWith("Altera\xE7\xE3o manual realizada por:")},async exibirHistorico(c){var h,_,i;let t;try{t=setTimeout(()=>{$q.loading.show({message:"Carregando informa\xE7\xF5es...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})},500);const o=await $db.documentoStatus.leHistoricoOnline(c);for(const s of o){const n=[];let a,g,u;!(s.cpfUsuario||((h=s.cpfUsuario)==null?void 0:h.replace(/\D/g,"")))||this.dados.contatos[s.cpfUsuario]||this.dados.contatos[(_=s.cpfUsuario)==null?void 0:_.replace(/\D/g,"")]||(a=s.cpfUsuario,g=await $erp().contato.where({numeroDocumentoNacional:$utils.formatarCPF(a)}).toArray(),Array.prototype.push.apply(n,g),a=(i=s.cpfUsuario)==null?void 0:i.replace(/\D/g,""),a&&a!==s.cpfUsuario&&(g=await $erp().contato.where({numeroDocumentoNacional:a}).toArray(),Array.prototype.push.apply(n,g)),u=n[0],u&&(this.dados.contatos[s.cpfUsuario]={nome:u.nome,imagem:u.imagem}))}this.dados.status=o}catch(o){this.$q.notify({type:"negative",message:o.message})}finally{clearTimeout(t),$q.loading.hide()}},async mostrar(c){const{idDocumento:t}=c;if(await this.exibirHistorico(t),!(this.dados.status||[]).length){this.$q.notify({type:"warning",message:"N\xE3o h\xE1 hist\xF3rico dispon\xEDvel."});return}this.visivel=!0},onHide(){this.dados={status:[],contatos:{}}}}},O={class:"layout-padding",container:""},W={class:"q-mr-sm"},j={class:"q-mr-md"};function G(c,t,h,_,i,o){const s=k("avatar"),n=k("g-label");return l(),m(P,{modelValue:i.visivel,"onUpdate:modelValue":t[0]||(t[0]=a=>i.visivel=a),onHide:o.onHide},{default:e(()=>[r(D,{view:"hHh LpR fFf",container:"",class:"bg-white rounded-borders",style:{height:"100%","max-height":"500px"}},{default:e(()=>[r(C,null,{default:e(()=>[r(M,null,{default:e(()=>[r(S,null,{default:e(()=>t[1]||(t[1]=[p("Hist\xF3rico do Status")])),_:1}),E(r(N,{dense:"",flat:"",icon:"close",round:""},null,512),[[T]])]),_:1})]),_:1}),r(V,null,{default:e(()=>[r(B,null,{default:e(()=>[y("div",O,[o.dadosEncontrados?(l(),m(F,{key:0,"no-border":"",dense:"",class:"q-my-md"},{default:e(()=>[(l(!0),b(v,null,w(i.dados.status,(a,g)=>(l(),b(v,{key:a.codigoDocumentoStatus},[g?(l(),m(I,{key:0})):f("",!0),r(L,{class:"item-center q-my-sm"},{default:e(()=>[r(Q,{avatar:""},{default:e(()=>[r(s,{imagem:(i.dados.contatos[a.cpfUsuario]||{}).imagem,rotulo:(i.dados.contatos[a.cpfUsuario]||{}).nome,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1024),r(Q,null,{default:e(()=>[r(x,{class:"q-pb-xs text-weight-medium"},{default:e(()=>[o.observacaoEstruturada(a).nome?(l(),b(v,{key:0},[y("div",null,d(o.observacaoEstruturada(a).nome),1),t[2]||(t[2]=y("div",{class:"text-caption text-grey-7"},"Altera\xE7\xE3o de dados sens\xEDveis",-1))],64)):(l(),b(v,{key:1},[p(d((i.dados.contatos[a.cpfUsuario]||{}).nome),1)],64))]),_:2},1024),o.isAlteracaoManual(a)?(l(),m(x,{key:0,caption:"",class:"q-pb-xs text-body2 text-weight-light text-dark"},{default:e(()=>[(l(!0),b(v,null,w(o.observacaoEstruturada(a).detalhes,(u,H)=>(l(),m(n,{key:H},{default:e(()=>[u.de?(l(),b(v,{key:0},[r(n,{inline:""},{default:e(()=>[p(d(u.label)+":",1)]),_:2},1024),p(" "+d(u.de)+" ",1),r(A,{name:"east",color:"primary",class:"q-mx-sm"}),p(" "+d(u.para),1)],64)):f("",!0)]),_:2},1024))),128))]),_:2},1024)):f("",!0),!o.isAlteracaoManual(a)&&a.observacao?(l(),m(x,{key:1,class:"text-body1 text-weight-regular text-black q-pb-sm"},{default:e(()=>[p(d(a.observacao),1)]),_:2},1024)):f("",!0),a.statusOriginal&&!o.isAlteracaoManual(a)?(l(),m(x,{key:2,class:"text-body2 text-weight-light text-black"},{default:e(()=>[y("span",W,d(a.statusOriginal),1),y("span",null,[r(A,{name:"east",color:"primary",class:"q-mr-sm"}),p(d(a.statusFinalizado),1)])]),_:2},1024)):f("",!0),o.isAlteracaoManual(a)?f("",!0):(l(),m(x,{key:3,class:"text-body2"},{default:e(()=>[y("span",j,d(c.$filters.data(a.dataHoraEmissao)),1),p(d(c.$filters.hora(a.dataHoraEmissao)),1)]),_:2},1024))]),_:2},1024)]),_:2},1024)],64))),128))]),_:1})):f("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onHide"])}var R=q(z,[["render",G]]);export{R as M};
